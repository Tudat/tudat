

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Settings classes &mdash; TU Delft Astrodynamic Toolbox  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="TU Delft Astrodynamic Toolbox  documentation" href="../../index.html"/>
        <link rel="up" title="Extending the JSON Interface" href="index.html"/>
        <link rel="next" title="Other types" href="otherTypes.html"/>
        <link rel="prev" title="Enumerations" href="enumerations.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> TU Delft Astrodynamic Toolbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Start Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials and Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ/index.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../githubBasics/githubBasics.html">Github Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../updatingTudat/updatingTudat.html">Updating Tudat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../addingFeatures/addFeatures.html">Adding Features to Tudat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qtBasics/qtBasics.html">Qt Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../applicationCMakeLists/applicationCMakeLists.html">Application CMakelists</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Extending the JSON Interface</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="valueConversions.html">Value conversions</a></li>
<li class="toctree-l3"><a class="reference internal" href="enhancedDeserialization.html">Enhanced deserialisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="enhancedValueAccess.html">Enhanced value access</a></li>
<li class="toctree-l3"><a class="reference internal" href="enhancedValueSet.html">Enhanced value set</a></li>
<li class="toctree-l3"><a class="reference internal" href="validation.html">Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="enumerations.html">Enumerations</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Settings classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#definition-of-keys">Definition of keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-from-json-functions">Writing <code class="docutils literal"><span class="pre">from_json</span></code> functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#writing-to-json-functions">Writing <code class="docutils literal"><span class="pre">to_json</span></code> functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="otherTypes.html">Other types</a></li>
<li class="toctree-l3"><a class="reference internal" href="unitTesting.html">Unit testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../extendingMATLAB/index.html">Extending the MATLAB Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howToWriteTheWiki/howToWriteTheWiki.html">How to Write the Wiki</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TU Delft Astrodynamic Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Developer Guide</a> &raquo;</li>
        
          <li><a href="index.html">Extending the JSON Interface</a> &raquo;</li>
        
      <li>Settings classes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/developerGuide/extendingJSON/settingsClasses.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="settings-classes">
<span id="extendingjson-settingsclasses"></span><h1>Settings classes<a class="headerlink" href="#settings-classes" title="Permalink to this headline">¶</a></h1>
<p>Almost all classes containing settings for Tudat simulations are used in the form of shared pointers. Currently, <code class="xref py py-class docutils literal"><span class="pre">boost::shared_ptr</span></code> is being used. Support for converting shared pointers to and from <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> could be added just by writing:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">boost</span>
<span class="p">{</span>

<span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">to_json</span><span class="p">(</span> <span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="k">const</span> <span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">T</span> <span class="o">&gt;&amp;</span> <span class="n">sharedPointer</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">sharedPointer</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">jsonObject</span> <span class="o">=</span> <span class="o">*</span><span class="n">sharedPointer</span><span class="p">;</span>                    <span class="c1">// T&#39;s to_json called</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">from_json</span><span class="p">(</span> <span class="k">const</span> <span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">T</span> <span class="o">&gt;&amp;</span> <span class="n">sharedPointer</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="n">jsonObject</span><span class="p">.</span><span class="n">is_null</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">T</span> <span class="n">object</span> <span class="o">=</span> <span class="n">jsonObject</span><span class="p">;</span>                          <span class="c1">// T&#39;s from_json called</span>
        <span class="n">sharedPointer</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">T</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">object</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Then, if class <code class="xref py py-class docutils literal"><span class="pre">T</span></code> is convertible to/from <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code>, <code class="docutils literal"><span class="pre">boost::shared_ptr&lt;</span> <span class="pre">T</span> <span class="pre">&gt;</span></code> would also be. However, this approach has some drawbacks, namely:</p>
<blockquote>
<div><ul class="simple">
<li><code class="xref py py-class docutils literal"><span class="pre">T</span></code> must be default-constructible for the code to compile.</li>
<li>Separate <code class="docutils literal"><span class="pre">to_json</span></code> and <code class="docutils literal"><span class="pre">from_json</span></code> functions have to be written for each derived class of <code class="xref py py-class docutils literal"><span class="pre">T</span></code>, potentially leading to the duplication of code.</li>
</ul>
</div></blockquote>
<p>Thus, given that the settings classes used throughout Tudat are always used as shared pointers, rather than providing <code class="docutils literal"><span class="pre">to_json</span></code> and <code class="docutils literal"><span class="pre">from_json</span></code> functions for these classes, these functions have been written for shared pointers of these classes. Before introducing the best-practices to be followed when writing these functions, the way in which the keys to be used in these functions are defined in the JSON Interface library is described.</p>
<div class="section" id="definition-of-keys">
<h2>Definition of keys<a class="headerlink" href="#definition-of-keys" title="Permalink to this headline">¶</a></h2>
<p>In all the example <code class="docutils literal"><span class="pre">to_json</span></code> and <code class="docutils literal"><span class="pre">from_json</span></code> functions presented so far, the keys were hard-coded, i.e. literal strings were used when using the <code class="docutils literal"><span class="pre">[]</span></code> operator of a <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> object, calling the <code class="docutils literal"><span class="pre">getValue</span></code> function or constructing a key path (by concatenating several strings). However, this approach makes code-updating very complex. Image that, in the future, we want to update a key called <code class="docutils literal"><span class="pre">initialTime</span></code> to <code class="docutils literal"><span class="pre">initialEpoch</span></code>. Although a global search could do the trick, this may result in modifying parts of the code that should not be modified. If we want to update the name of the key <span class="jsonkey">type</span> to <code class="docutils literal"><span class="pre">modelType</span></code>, but only for rotation model settings, the only option is doing it manually to avoid changing also the <code class="docutils literal"><span class="pre">type</span></code> keys of other objects.</p>
<p>Thus, in the JSON Interface library, literal strings are never used inside <code class="docutils literal"><span class="pre">to_json</span></code> and <code class="docutils literal"><span class="pre">from_json</span></code> functions. Instead, all the keys that are recognised by the JSON Interface are declared in <code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Support/keys.h</span></code>, and their string-value is defined in <code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Support/keys.cpp</span></code>. This is done using a struct called <code class="xref py py-class docutils literal"><span class="pre">Keys</span></code> containing several nested structs for each level. For instance:</p>
<div class="literal-block-wrapper docutils container" id="keys-h">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Support/keys.h</span></code></span><a class="headerlink" href="#keys-h" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">tudat</span>
<span class="p">{</span>

<span class="k">namespace</span> <span class="n">json_interface</span>
<span class="p">{</span>

<span class="k">struct</span> <span class="n">Keys</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">initialEpoch</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">finalEpoch</span><span class="p">;</span>

    <span class="p">...</span>

    <span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">bodies</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">Body</span>
    <span class="p">{</span>
        <span class="p">...</span>

        <span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">rotationModel</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">RotationModel</span>
        <span class="p">{</span>
            <span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">type</span><span class="p">;</span>
            <span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">originalFrame</span><span class="p">;</span>
            <span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">targetFrame</span><span class="p">;</span>
            <span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">initialOrientation</span><span class="p">;</span>
            <span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">initialTime</span><span class="p">;</span>
            <span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">rotationRate</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="p">...</span>
    <span class="p">};</span>

    <span class="p">...</span>
<span class="p">};</span>

<span class="p">}</span>  <span class="c1">// namespace json_interface</span>

<span class="p">}</span>  <span class="c1">// namespace tudat</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="keys-cpp">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Support/keys.cpp</span></code></span><a class="headerlink" href="#keys-cpp" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">tudat</span>
<span class="p">{</span>

<span class="k">namespace</span> <span class="n">json_interface</span>
<span class="p">{</span>

<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Keys</span><span class="o">::</span><span class="n">initialEpoch</span> <span class="o">=</span> <span class="s">&quot;initialEpoch&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Keys</span><span class="o">::</span><span class="n">finalEpoch</span> <span class="o">=</span> <span class="s">&quot;finalEpoch&quot;</span><span class="p">;</span>

<span class="p">...</span>

<span class="c1">//  Body</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Keys</span><span class="o">::</span><span class="n">bodies</span> <span class="o">=</span> <span class="s">&quot;bodies&quot;</span><span class="p">;</span>

<span class="p">...</span>

<span class="c1">// //  Body::RotationModel</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Keys</span><span class="o">::</span><span class="n">Body</span><span class="o">::</span><span class="n">rotationModel</span> <span class="o">=</span> <span class="s">&quot;rotationModel&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Keys</span><span class="o">::</span><span class="n">Body</span><span class="o">::</span><span class="n">RotationModel</span><span class="o">::</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;type&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Keys</span><span class="o">::</span><span class="n">Body</span><span class="o">::</span><span class="n">RotationModel</span><span class="o">::</span><span class="n">originalFrame</span> <span class="o">=</span> <span class="s">&quot;originalFrame&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Keys</span><span class="o">::</span><span class="n">Body</span><span class="o">::</span><span class="n">RotationModel</span><span class="o">::</span><span class="n">targetFrame</span> <span class="o">=</span> <span class="s">&quot;targetFrame&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Keys</span><span class="o">::</span><span class="n">Body</span><span class="o">::</span><span class="n">RotationModel</span><span class="o">::</span><span class="n">initialOrientation</span> <span class="o">=</span> <span class="s">&quot;initialOrientation&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Keys</span><span class="o">::</span><span class="n">Body</span><span class="o">::</span><span class="n">RotationModel</span><span class="o">::</span><span class="n">initialTime</span> <span class="o">=</span> <span class="s">&quot;initialTime&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Keys</span><span class="o">::</span><span class="n">Body</span><span class="o">::</span><span class="n">RotationModel</span><span class="o">::</span><span class="n">rotationRate</span> <span class="o">=</span> <span class="s">&quot;rotationRate&quot;</span><span class="p">;</span>

<span class="p">...</span>

<span class="p">}</span>  <span class="c1">// namespace json_interface</span>

<span class="p">}</span>  <span class="c1">// namespace tudat</span>
</pre></div>
</div>
</div>
<p>Note that the keys for the different derived classes of <a class="reference internal" href="../../tutorials/tudatFeatures/environmentSetup/availableSettings.html#RotationModelSettings" title="RotationModelSettings"><code class="xref py py-class docutils literal"><span class="pre">RotationModelSettings</span></code></a> are all defined at the same level (i.e. a different struct is not created for each derived class). When going through a settings class and defining its keys, it is good practice to define also the keys for the derived classes that will not supported by the JSON Interface (initially), and commenting them out.</p>
<p>When one wants to modify a key, changing its string value in <code class="xref py py-class docutils literal"><span class="pre">keys.cpp</span></code> should suffice. However, it is good practice to keep the name of the keys and the values of the keys consistent, so “Rename Symbol Under Cursor” should be used as well to replace all the occurrences of the key.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p>When debugging an <code class="xref py py-class docutils literal"><span class="pre">UndefinedKeyError</span></code>, the following situation can arise when parsing, for instance, the following JSON file (only relevant section shown):</p>
<div class="highlight-json"><div class="highlight"><pre><span></span>&quot;bodies&quot;: {
  &quot;Earth&quot;: {
    &quot;rotationModel&quot;: {
      &quot;type&quot;: &quot;simple&quot;,
      &quot;originalFrame&quot;: &quot;ECLIPJ2000&quot;,
      &quot;targetFrame&quot;: &quot;IAU_Earth&quot;,
      &quot;initialTime&quot;: 0,
      &quot;rotationRate&quot;: 7e-05
    }
  }
}
</pre></div>
</div>
<div class="highlight-txt"><div class="highlight"><pre><span></span>libc++abi.dylib: terminating with uncaught exception of type tudat::json_interface::UndefinedKeyError:
Undefined key: bodies.Earth.rotationModel.initialOrientation
</pre></div>
</div>
<p>The key <span class="jsonkey">initialOrientation</span> stores a defaultable-property, i.e. if not provided the value can be inferred from the keys <code class="docutils literal"><span class="pre">originalFrame</span></code>, <code class="docutils literal"><span class="pre">targetFrame</span></code> and <code class="docutils literal"><span class="pre">initialTime</span></code>. Thus, the error should not be generated if the key is not defined. One would probably tend to start by looking at the <code class="docutils literal"><span class="pre">from_json</span></code> function of <a class="reference internal" href="../../tutorials/tudatFeatures/environmentSetup/availableSettings.html#EphemerisSettings" title="EphemerisSettings"><code class="xref py py-class docutils literal"><span class="pre">EphemerisSettings</span></code></a> when debugging this issue. However, the source of the problem can be in the <code class="xref py py-class docutils literal"><span class="pre">keys.cpp</span></code>. Even if the <code class="docutils literal"><span class="pre">from_json</span></code> function is completely correct, the previous error would be printed if, in the <code class="xref py py-class docutils literal"><span class="pre">keys.cpp</span></code>, we had:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Keys</span><span class="o">::</span><span class="n">Body</span><span class="o">::</span><span class="n">RotationModel</span><span class="o">::</span><span class="n">initialOrientation</span> <span class="o">=</span> <span class="s">&quot;initialOrientation&quot;</span><span class="p">;</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Keys</span><span class="o">::</span><span class="n">Body</span><span class="o">::</span><span class="n">RotationModel</span><span class="o">::</span><span class="n">initialTime</span> <span class="o">=</span> <span class="s">&quot;initialOrientation&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p class="last">which can happen easily when copy-pasting. Thus, what is actually happening is that, when retrieving the value for <code class="docutils literal"><span class="pre">initialTime</span></code> (non-defaultable property), the key <span class="jsonkey">initialOrientation</span> is mistakenly accessed (and not found). To prevent these issues, a search for any given key inside the <code class="xref py py-class docutils literal"><span class="pre">keys.cpp</span></code> file should always result in an even number of occurrences. In this way, we also make sure that e.g. the value stored at the key <span class="jsonkey">rotationRate</span> does not end up being used for the property <code class="docutils literal"><span class="pre">initialTime</span></code> of our <a class="reference internal" href="../../tutorials/tudatFeatures/environmentSetup/availableSettings.html#RotationModelSettings" title="RotationModelSettings"><code class="xref py py-class docutils literal"><span class="pre">RotationModelSettings</span></code></a>, in which case no error or warning would be generated during conversion to <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> as both as non-defaultable properties and store values of the same type (<code class="xref py py-class docutils literal"><span class="pre">double</span></code>).</p>
</div>
</div>
<div class="section" id="writing-from-json-functions">
<h2>Writing <code class="docutils literal"><span class="pre">from_json</span></code> functions<a class="headerlink" href="#writing-from-json-functions" title="Permalink to this headline">¶</a></h2>
<p>Generally, the settings classes used in Tudat are not default-constructible. By providing <code class="docutils literal"><span class="pre">from_json</span></code> functions for their shared pointers, rather than for the class itself, we can get the code to compile without the need to provide default constructors because a shared pointer is default-constructible (it is <code class="docutils literal"><span class="pre">NULL</span></code> by default).</p>
<p>To illustrate the structure of a <code class="docutils literal"><span class="pre">from_json</span></code> function for a shared pointer to a settings class, the <a class="reference internal" href="../../tutorials/tudatFeatures/environmentSetup/availableSettings.html#RotationModelSettings" title="RotationModelSettings"><code class="xref py py-class docutils literal"><span class="pre">RotationModelSettings</span></code></a> example is described here:</p>
<div class="literal-block-wrapper docutils container" id="rotationmodel-h">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Environment/rotationModel.h</span></code></span><a class="headerlink" href="#rotationmodel-h" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;Tudat/SimulationSetup/EnvironmentSetup/createRotationModel.h&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;Tudat/JsonInterface/Support/valueAccess.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;Tudat/JsonInterface/Support/valueConversions.h&quot;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">tudat</span>
<span class="p">{</span>

<span class="k">namespace</span> <span class="n">simulation_setup</span>
<span class="p">{</span>

<span class="c1">//! Map of `RotationModelType`s string representations.</span>
<span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="n">RotationModelType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&gt;</span> <span class="n">rotationModelTypes</span> <span class="o">=</span>
<span class="p">{</span>
    <span class="p">{</span> <span class="n">simple_rotation_model</span><span class="p">,</span> <span class="s">&quot;simple&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="n">spice_rotation_model</span><span class="p">,</span> <span class="s">&quot;spice&quot;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="c1">//! `RotationModelType`s not supported by `json_interface`.</span>
<span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">RotationModelType</span> <span class="o">&gt;</span> <span class="n">unsupportedRotationModelTypes</span> <span class="o">=</span> <span class="p">{</span> <span class="p">};</span>

<span class="c1">//! Convert `RotationModelType` to `nlohmann::json`.</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">to_json</span><span class="p">(</span> <span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="k">const</span> <span class="n">RotationModelType</span><span class="o">&amp;</span> <span class="n">rotationModelType</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">jsonObject</span> <span class="o">=</span> <span class="n">json_interface</span><span class="o">::</span><span class="n">stringFromEnum</span><span class="p">(</span> <span class="n">rotationModelType</span><span class="p">,</span> <span class="n">rotationModelTypes</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//! Convert `nlohmann::json` to `RotationModelType`.</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">from_json</span><span class="p">(</span> <span class="k">const</span> <span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">RotationModelType</span><span class="o">&amp;</span> <span class="n">rotationModelType</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">rotationModelType</span> <span class="o">=</span> <span class="n">json_interface</span><span class="o">::</span><span class="n">enumFromString</span><span class="p">(</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">rotationModelTypes</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">//! Create a `nlohmann::json` object from a shared pointer to a `RotationModelSettings` object.</span>
<span class="kt">void</span> <span class="nf">to_json</span><span class="p">(</span> <span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="k">const</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">RotationModelSettings</span> <span class="o">&gt;&amp;</span> <span class="n">rotationModelSettings</span> <span class="p">);</span>

<span class="c1">//! Create a shared pointer to a `RotationModelSettings` object from a `nlohmann::json` object.</span>
<span class="kt">void</span> <span class="nf">from_json</span><span class="p">(</span> <span class="k">const</span> <span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">RotationModelSettings</span> <span class="o">&gt;&amp;</span> <span class="n">rotationModelSettings</span> <span class="p">);</span>

<span class="p">}</span> <span class="c1">// namespace simulation_setup</span>

<span class="p">}</span> <span class="c1">// namespace tudat</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper docutils container" id="rotationmodel-cpp-from-json">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Environment/rotationModel.cpp</span></code></span><a class="headerlink" href="#rotationmodel-cpp-from-json" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">tudat</span>
<span class="p">{</span>

<span class="k">namespace</span> <span class="n">simulation_setup</span>
<span class="p">{</span>

<span class="p">...</span>

<span class="c1">//! Create a shared pointer to a `RotationModelSettings` object from a `nlohmann::json` object.</span>
<span class="kt">void</span> <span class="n">from_json</span><span class="p">(</span> <span class="k">const</span> <span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">RotationModelSettings</span> <span class="o">&gt;&amp;</span> <span class="n">rotationModelSettings</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">json_interface</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">K</span> <span class="o">=</span> <span class="n">Keys</span><span class="o">::</span><span class="n">Body</span><span class="o">::</span><span class="n">RotationModel</span><span class="p">;</span>

    <span class="c1">// Base class settings</span>
    <span class="k">const</span> <span class="n">RotationModelType</span> <span class="n">rotationModelType</span> <span class="o">=</span> <span class="n">getValue</span><span class="o">&lt;</span> <span class="n">RotationModelType</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">K</span><span class="o">::</span><span class="n">type</span> <span class="p">);</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">originalFrame</span> <span class="o">=</span> <span class="n">getValue</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">K</span><span class="o">::</span><span class="n">originalFrame</span> <span class="p">);</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">targetFrame</span> <span class="o">=</span> <span class="n">getValue</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">K</span><span class="o">::</span><span class="n">targetFrame</span> <span class="p">);</span>

    <span class="k">switch</span> <span class="p">(</span> <span class="n">rotationModelType</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nl">simple_rotation_model</span><span class="p">:</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="kt">double</span> <span class="n">initialTime</span> <span class="o">=</span> <span class="n">getValue</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">K</span><span class="o">::</span><span class="n">initialTime</span> <span class="p">);</span>

        <span class="c1">// Get JSON object for initialOrientation (or create it if not defined)</span>
        <span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span> <span class="n">jsonInitialOrientation</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">isDefined</span><span class="p">(</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">K</span><span class="o">::</span><span class="n">initialOrientation</span> <span class="p">)</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">jsonInitialOrientation</span> <span class="o">=</span> <span class="n">getValue</span><span class="o">&lt;</span> <span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">K</span><span class="o">::</span><span class="n">initialOrientation</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">jsonInitialOrientation</span><span class="p">[</span> <span class="n">K</span><span class="o">::</span><span class="n">originalFrame</span> <span class="p">]</span> <span class="o">=</span> <span class="n">originalFrame</span><span class="p">;</span>
            <span class="n">jsonInitialOrientation</span><span class="p">[</span> <span class="n">K</span><span class="o">::</span><span class="n">targetFrame</span> <span class="p">]</span> <span class="o">=</span> <span class="n">targetFrame</span><span class="p">;</span>
            <span class="n">jsonInitialOrientation</span><span class="p">[</span> <span class="n">K</span><span class="o">::</span><span class="n">initialTime</span> <span class="p">]</span> <span class="o">=</span> <span class="n">initialTime</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">rotationModelSettings</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">SimpleRotationModelSettings</span> <span class="o">&gt;</span><span class="p">(</span>
                    <span class="n">originalFrame</span><span class="p">,</span>
                    <span class="n">targetFrame</span><span class="p">,</span>
                    <span class="n">getAs</span><span class="o">&lt;</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Quaterniond</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">jsonInitialOrientation</span> <span class="p">),</span>
                    <span class="n">initialTime</span><span class="p">,</span>
                    <span class="n">getValue</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">K</span><span class="o">::</span><span class="n">rotationRate</span> <span class="p">)</span> <span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">case</span> <span class="nl">spice_rotation_model</span><span class="p">:</span>
    <span class="p">{</span>
        <span class="n">rotationModelSettings</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">RotationModelSettings</span> <span class="o">&gt;</span><span class="p">(</span>
                    <span class="n">rotationModelType</span><span class="p">,</span> <span class="n">originalFrame</span><span class="p">,</span> <span class="n">targetFrame</span> <span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="n">handleUnimplementedEnumValue</span><span class="p">(</span> <span class="n">rotationModelType</span><span class="p">,</span> <span class="n">rotationModelTypes</span><span class="p">,</span> <span class="n">unsupportedRotationModelTypes</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">}</span> <span class="c1">// namespace simulation_setup</span>

<span class="p">}</span> <span class="c1">// namespace tudat</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Note that the files <code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Support/valueAccess.h</span></code> and <code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Support/valueConversions.h</span></code> are always included. The former includes enhaced value access functions (<code class="docutils literal"><span class="pre">getValue</span></code>) and the latter overrides (and defines) <code class="docutils literal"><span class="pre">to_json</span></code> and <code class="docutils literal"><span class="pre">from_json</span></code> functions for frequently-used types, such as <code class="xref py py-class docutils literal"><span class="pre">std::vector</span></code> or <code class="xref py py-class docutils literal"><span class="pre">Eigen::Matrix</span></code>. The file <code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Support/valueAccess.h</span></code> includes <code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Support/keys.h</span></code>, so all the keys available in the JSON Interface are readily accessible.</p>
<p>Typically, the first lines of a <code class="docutils literal"><span class="pre">from_json</span></code> function are (for our example):</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">json_interface</span><span class="p">;</span>
<span class="k">using</span> <span class="n">K</span> <span class="o">=</span> <span class="n">Keys</span><span class="o">::</span><span class="n">Body</span><span class="o">::</span><span class="n">RotationModel</span><span class="p">;</span>
</pre></div>
</div>
<p>Generally, when creating a shared pointer to a settings class, only the keys for that class are needed (unless some keys of the root <code class="docutils literal"><span class="pre">mainJson</span></code> object have to be accessed). Thus we can use a shorter-name such as <code class="docutils literal"><span class="pre">K</span></code>. The other keys can still be accessed using the full name <code class="docutils literal"><span class="pre">Keys::...</span></code>. Do not write <code class="docutils literal"><span class="pre">using</span> <span class="pre">Keys</span> <span class="pre">=</span> <span class="pre">Keys::...</span></code>, as this would result in all the other keys being unaccessible.</p>
<p>Although it may be convenient to make the check on whether the provided <code class="docutils literal"><span class="pre">jsonObject</span></code> object is <code class="docutils literal"><span class="pre">null</span></code>, and return immediately a <code class="docutils literal"><span class="pre">NULL</span></code> shared pointer if it is, this situation will generally not happen in practice. When the user does not want to provide a rotation model, rather than writing <code class="docutils literal"><span class="pre">&quot;rotationModel&quot;:</span> <span class="pre">null</span></code>, they leave the key <span class="jsonkey">rotationModel</span> undefined. The <code class="docutils literal"><span class="pre">from_json</span></code> function of <a class="reference internal" href="../../tutorials/tudatFeatures/environmentSetup/setup.html#BodySettings" title="BodySettings"><code class="xref py py-class docutils literal"><span class="pre">BodySettings</span></code></a> is responsible for only calling the <code class="docutils literal"><span class="pre">from_json</span></code> function of <a class="reference internal" href="../../tutorials/tudatFeatures/environmentSetup/availableSettings.html#RotationModelSettings" title="RotationModelSettings"><code class="xref py py-class docutils literal"><span class="pre">RotationModelSettings</span></code></a> if the key <span class="jsonkey">rotationModel</span> is defined. If the user does provide <code class="docutils literal"><span class="pre">null</span></code> manually in their input file, this will result in an <code class="docutils literal"><span class="pre">UndefinedKeyError</span></code> for key <span class="jsonkey">bodies.Earth.rotationModel.type</span> (the first key to be accessed in the <code class="docutils literal"><span class="pre">from_json</span></code> function) will be thrown.</p>
<p>The settings classes used in Tudat typically have a type property that can be used to determine which derived class should be used when creating the shared pointer object. This is retrieved in line 15. Then, the settings for the base class (shared by all the derived classes) are retrieved in lines 16 and 17. The next step is to write a <code class="xref py py-class docutils literal"><span class="pre">switch</span></code> that modifies (re-constructs) the <code class="docutils literal"><span class="pre">rotationModelSettings</span></code> (passed by reference) depending on the <code class="docutils literal"><span class="pre">rotationModelType</span></code>. Generally, a <code class="docutils literal"><span class="pre">return</span></code> is added at the end of each switch case.</p>
<p>Finally, the default case of the switch always calls the <code class="docutils literal"><span class="pre">handleUnimplementedEnumValue</span></code> function, with the first argument the type converted from JSON, the second argument the map of string representations for the enumeration, and the third argument the list of enumeration values not supported by the JSON interface. This will throw an <code class="docutils literal"><span class="pre">UnsupportedEnumError</span></code>, suggesting the user to write their own JSON-based C++ application, or an <code class="docutils literal"><span class="pre">UnimplementedEnumError</span></code>, if the provided enum value is not marked as unsupported, but we (the coders) forgot to write its implementation, printing a warning in which the user is kindly asked to open an issue on GitHub.</p>
<p>In most cases, the defaultable properties use the default value defined in the setting class constructors. For instance, consider the following constructor:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">BasicSolidBodyGravityFieldVariationSettings</span><span class="p">(</span>
        <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&gt;</span> <span class="n">deformingBodies</span><span class="p">,</span>
        <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">loveNumbers</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">double</span> <span class="n">bodyReferenceRadius</span><span class="p">,</span>
        <span class="k">const</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">InterpolatorSettings</span> <span class="o">&gt;</span> <span class="n">interpolatorSettings</span> <span class="o">=</span> <span class="nb">NULL</span> <span class="p">)</span><span class="o">:</span>
</pre></div>
</div>
<p>If the user does not provide the key <span class="jsonkey">interpolator</span>, the same default value defined in the constructor (<code class="docutils literal"><span class="pre">NULL</span></code>) should be used to create the settings object from the <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> object. To keep the behaviour of C++ Tudat applications and JSON-based Tudat applications consistent, if in the future the default interpolator settings are changed from <code class="docutils literal"><span class="pre">NULL</span></code> to e.g. <code class="docutils literal"><span class="pre">boost::make_shared&lt;</span> <span class="pre">LagrangeInterpolatorSettings</span> <span class="pre">&gt;(</span> <span class="pre">6</span> <span class="pre">)</span></code> in the constructor, this change should also be reflected in the JSON Interface. To make this happen automatically, the default values are not hard-coded in the <code class="docutils literal"><span class="pre">from_json</span></code> functions. Instead, an instance constructed only with the mandatory properties is used to create the actual shared pointer:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">BasicSolidBodyGravityFieldVariationSettings</span> <span class="nf">defaults</span><span class="p">(</span> <span class="p">{</span> <span class="p">},</span> <span class="p">{</span> <span class="p">},</span> <span class="n">TUDAT_NAN</span> <span class="p">);</span>
<span class="n">gravityFieldVariationSettings</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">BasicSolidBodyGravityFieldVariationSettings</span> <span class="o">&gt;</span><span class="p">(</span>
            <span class="n">getValue</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">K</span><span class="o">::</span><span class="n">deformingBodies</span> <span class="p">),</span>
            <span class="n">getValue</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">K</span><span class="o">::</span><span class="n">loveNumbers</span> <span class="p">),</span>
            <span class="n">getValue</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">K</span><span class="o">::</span><span class="n">referenceRadius</span> <span class="p">),</span>
            <span class="n">getValue</span><span class="p">(</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="n">K</span><span class="o">::</span><span class="n">interpolator</span><span class="p">,</span> <span class="n">defaults</span><span class="p">.</span><span class="n">getInterpolatorSettings</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>Since the settings classes are only used to store information, their constructors are generally empty, so in most cases the temporary object from which the default properties is retrieved can be constructed with values such as <code class="docutils literal"><span class="pre">{</span> <span class="pre">}</span></code>, <code class="docutils literal"><span class="pre">&quot;&quot;</span></code> or <code class="docutils literal"><span class="pre">TUDAT_NAN</span></code> for the mandatory properties.</p>
</div>
<div class="section" id="writing-to-json-functions">
<h2>Writing <code class="docutils literal"><span class="pre">to_json</span></code> functions<a class="headerlink" href="#writing-to-json-functions" title="Permalink to this headline">¶</a></h2>
<p>An example of a <code class="docutils literal"><span class="pre">to_json</span></code> function is provided below:</p>
<div class="literal-block-wrapper docutils container" id="rotationmodel-cpp-to-json">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Environment/rotationModel.cpp</span></code></span><a class="headerlink" href="#rotationmodel-cpp-to-json" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">tudat</span>
<span class="p">{</span>

<span class="k">namespace</span> <span class="n">simulation_setup</span>
<span class="p">{</span>

<span class="c1">//! Create a `nlohmann::json` object from a shared pointer to a `RotationModelSettings` object.</span>
<span class="kt">void</span> <span class="n">to_json</span><span class="p">(</span> <span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span> <span class="n">jsonObject</span><span class="p">,</span> <span class="k">const</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">RotationModelSettings</span> <span class="o">&gt;&amp;</span> <span class="n">rotationModelSettings</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="n">rotationModelSettings</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">json_interface</span><span class="p">;</span>
    <span class="k">using</span> <span class="n">K</span> <span class="o">=</span> <span class="n">Keys</span><span class="o">::</span><span class="n">Body</span><span class="o">::</span><span class="n">RotationModel</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">RotationModelType</span> <span class="n">rotationModelType</span> <span class="o">=</span> <span class="n">rotationModelSettings</span><span class="o">-&gt;</span><span class="n">getRotationType</span><span class="p">(</span> <span class="p">);</span>
    <span class="n">jsonObject</span><span class="p">[</span> <span class="n">K</span><span class="o">::</span><span class="n">type</span> <span class="p">]</span> <span class="o">=</span> <span class="n">rotationModelType</span><span class="p">;</span>
    <span class="n">jsonObject</span><span class="p">[</span> <span class="n">K</span><span class="o">::</span><span class="n">originalFrame</span> <span class="p">]</span> <span class="o">=</span> <span class="n">rotationModelSettings</span><span class="o">-&gt;</span><span class="n">getOriginalFrame</span><span class="p">(</span> <span class="p">);</span>
    <span class="n">jsonObject</span><span class="p">[</span> <span class="n">K</span><span class="o">::</span><span class="n">targetFrame</span> <span class="p">]</span> <span class="o">=</span> <span class="n">rotationModelSettings</span><span class="o">-&gt;</span><span class="n">getTargetFrame</span><span class="p">(</span> <span class="p">);</span>

    <span class="k">switch</span> <span class="p">(</span> <span class="n">rotationModelType</span> <span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="nl">simple_rotation_model</span><span class="p">:</span>
    <span class="p">{</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">SimpleRotationModelSettings</span> <span class="o">&gt;</span> <span class="n">simpleRotationModelSettings</span> <span class="o">=</span>
                <span class="n">boost</span><span class="o">::</span><span class="n">dynamic_pointer_cast</span><span class="o">&lt;</span> <span class="n">SimpleRotationModelSettings</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">rotationModelSettings</span> <span class="p">);</span>
        <span class="n">assertNonNullPointer</span><span class="p">(</span> <span class="n">simpleRotationModelSettings</span> <span class="p">);</span>
        <span class="n">jsonObject</span><span class="p">[</span> <span class="n">K</span><span class="o">::</span><span class="n">initialOrientation</span> <span class="p">]</span> <span class="o">=</span> <span class="n">simpleRotationModelSettings</span><span class="o">-&gt;</span><span class="n">getInitialOrientation</span><span class="p">(</span> <span class="p">);</span>
        <span class="n">jsonObject</span><span class="p">[</span> <span class="n">K</span><span class="o">::</span><span class="n">initialTime</span> <span class="p">]</span> <span class="o">=</span> <span class="n">simpleRotationModelSettings</span><span class="o">-&gt;</span><span class="n">getInitialTime</span><span class="p">(</span> <span class="p">);</span>
        <span class="n">jsonObject</span><span class="p">[</span> <span class="n">K</span><span class="o">::</span><span class="n">rotationRate</span> <span class="p">]</span> <span class="o">=</span> <span class="n">simpleRotationModelSettings</span><span class="o">-&gt;</span><span class="n">getRotationRate</span><span class="p">(</span> <span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">case</span> <span class="nl">spice_rotation_model</span><span class="p">:</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="n">handleUnimplementedEnumValue</span><span class="p">(</span> <span class="n">rotationModelType</span><span class="p">,</span> <span class="n">rotationModelTypes</span><span class="p">,</span> <span class="n">unsupportedRotationModelTypes</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="p">}</span>  <span class="c1">// namespace simulation_setup</span>

<span class="p">}</span>  <span class="c1">// namespace tudat</span>
</pre></div>
</td></tr></table></div>
</div>
<p>First, a check on the nullity of the shared pointer is done. If it is <code class="docutils literal"><span class="pre">NULL</span></code>, the null <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> object won’t be modified. Otherwise, the settings object will be used to define the keys of the <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> object.</p>
<p>The structure is similar to the one for <code class="docutils literal"><span class="pre">from_json</span></code> functions. The main difference is that the <code class="docutils literal"><span class="pre">[]</span></code> mutator operator is used to modify the <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> object, instead of using the <code class="docutils literal"><span class="pre">getValue</span></code> function to access it. Additionally, in every switch case the original shared pointer has to be dynamically casted to the corresponding derived class. Then, the function <code class="docutils literal"><span class="pre">assertNonNullPointer</span></code> is called. This throws an <code class="docutils literal"><span class="pre">NullPointerError</span></code> when the settings derived class and the value of its type property do not match.</p>
<p>Some switch cases, such as <code class="docutils literal"><span class="pre">spice_rotation_model</span></code>, are empty because they do not contain additional information other than that of the original base class. Thus, the only needed statement is <code class="docutils literal"><span class="pre">return;</span></code>.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="otherTypes.html" class="btn btn-neutral float-right" title="Other types" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="enumerations.html" class="btn btn-neutral" title="Enumerations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Delft University of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header .arrow").click(function() {
            $(this).closest('.toggle').children().not(".header").toggle(400);
            $(this).toggleClass("open");
            // $(this).html() == "More" ? $(this).html('Less') : $(this).html('More');
        });
        $(".showall").click(function() {
            $(".toggle > *").show(400);
            $(".toggle .header .arrow").addClass("open");
        });
        $(".hideall").click(function() {
            $(".toggle > *").hide(400);
            $(".toggle .header").show(400);
            $(".toggle .header .arrow").removeClass("open");
        });
    });
</script>


</body>
</html>