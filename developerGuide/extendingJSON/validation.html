

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Validation &mdash; TU Delft Astrodynamic Toolbox  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="TU Delft Astrodynamic Toolbox  documentation" href="../../index.html"/>
        <link rel="up" title="Extending the JSON Interface" href="index.html"/>
        <link rel="next" title="Enumerations" href="enumerations.html"/>
        <link rel="prev" title="Enhanced value set" href="enhancedValueSet.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> TU Delft Astrodynamic Toolbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Start Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials and Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ/index.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../githubBasics/githubBasics.html">Github Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../updatingTudat/updatingTudat.html">Updating Tudat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../addingFeatures/addFeatures.html">Adding Features to Tudat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qtBasics/qtBasics.html">Qt Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../applicationCMakeLists/applicationCMakeLists.html">Application CMakelists</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Extending the JSON Interface</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="valueConversions.html">Value conversions</a></li>
<li class="toctree-l3"><a class="reference internal" href="enhancedDeserialization.html">Enhanced deserialisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="enhancedValueAccess.html">Enhanced value access</a></li>
<li class="toctree-l3"><a class="reference internal" href="enhancedValueSet.html">Enhanced value set</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Validation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#validator-options">Validator options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#access-history">Access history</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="enumerations.html">Enumerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="settingsClasses.html">Settings classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="otherTypes.html">Other types</a></li>
<li class="toctree-l3"><a class="reference internal" href="unitTesting.html">Unit testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../extendingMATLAB/index.html">Extending the MATLAB Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howToWriteTheWiki/howToWriteTheWiki.html">How to Write the Wiki</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TU Delft Astrodynamic Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Developer Guide</a> &raquo;</li>
        
          <li><a href="index.html">Extending the JSON Interface</a> &raquo;</li>
        
      <li>Validation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/developerGuide/extendingJSON/validation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="validation">
<span id="extendingjson-validation"></span><h1>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h1>
<p>The validation of the JSON input files provided by the user is made possible by the <code class="docutils literal"><span class="pre">getValue&lt;</span> <span class="pre">ExpectedType</span> <span class="pre">&gt;</span></code> function and special keys and <code class="xref py py-class docutils literal"><span class="pre">KeyPath</span></code> s, as explained in <a class="reference internal" href="enhancedValueAccess.html#extendingjson-enhancedvalueaccess"><span class="std std-ref">Enhanced value access</span></a>. This validator is customisable, i.e. the user can define a set of keys in their input file that will determine the behaviour of the validator under certain circumstances.</p>
<div class="section" id="validator-options">
<h2>Validator options<a class="headerlink" href="#validator-options" title="Permalink to this headline">¶</a></h2>
<p>The following keys of the <code class="docutils literal"><span class="pre">mainJson</span></code> object can be defined to customise the behaviour of the validator:</p>
<blockquote>
<div><ul class="simple">
<li><span class="jsonkey">options.defaultValueUsedForMissingKey</span>: determines the behaviour of the validator when the <code class="docutils literal"><span class="pre">getValue(</span> <span class="pre">const</span> <span class="pre">nlohmann::json&amp;</span> <span class="pre">j,</span> <span class="pre">const</span> <span class="pre">KeyPath&amp;</span> <span class="pre">keyPath,</span> <span class="pre">const</span> <span class="pre">ValueType&amp;</span> <span class="pre">defaultValue</span> <span class="pre">)</span></code> function is called and <code class="docutils literal"><span class="pre">keyPath</span></code> is undefined. By default, <code class="docutils literal"><span class="pre">defaultValue</span></code> is used without informing the user.</li>
<li><span class="jsonkey">options.unusedKey</span>: determines the behaviour of the validator when the <code class="docutils literal"><span class="pre">void</span> <span class="pre">checkUnusedKeys(</span> <span class="pre">const</span> <span class="pre">nlohmann::json&amp;</span> <span class="pre">mainJson,</span> <span class="pre">...</span> <span class="pre">)</span></code> function is called and some of the keys defined in <code class="docutils literal"><span class="pre">mainJson</span></code> have not been accessed. This function is called by the <code class="docutils literal"><span class="pre">json_interface</span></code> application right before integrating the equations of motion, when all the settings objects have been created. By default, a warning is printed for each unused key.</li>
</ul>
</div></blockquote>
<p>These three options are converted to a value of the enum <code class="xref py py-class docutils literal"><span class="pre">ExceptionResponseType</span></code> defined in <code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Support/errorHandling.h</span></code>. The three possible values are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">continueSilently</span></code>: allow this validator feature and do not inform the user.</li>
<li><code class="docutils literal"><span class="pre">printWarning</span></code>: allow this validator feature but print a warning when using it.</li>
<li><code class="docutils literal"><span class="pre">throwError</span></code>: do not allow this validator feature and terminate throwing an error when trying to use this feature. For <span class="jsonkey">defaultValueUsedForMissingKey</span>, an <code class="xref py py-class docutils literal"><span class="pre">UndefinedKeyError</span></code> will be thrown (i.e. the behaviour of the <code class="docutils literal"><span class="pre">getValue</span></code> function with and without third default value argument will be equivalent). For <span class="jsonkey">unusedKey</span>, the error message <code class="docutils literal"><span class="pre">Validation</span> <span class="pre">failed</span> <span class="pre">because</span> <span class="pre">there</span> <span class="pre">are</span> <span class="pre">unused</span> <span class="pre">keys.</span></code> will be printed after providing the list of unused keys.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="access-history">
<h2>Access history<a class="headerlink" href="#access-history" title="Permalink to this headline">¶</a></h2>
<p>The validator feature to check the keys that have not been used is useful to inform the user about the existence of redundant information in their input file, the use of old key identifiers that are not used anymore in the current version of Tudat, or the detection of typos in optional keys when manually writing the input file. Consider the following:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span> <span class="n">j</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span> <span class="s">&quot;tyep&quot;</span><span class="p">,</span> <span class="s">&quot;euler&quot;</span> <span class="p">},</span> <span class="p">{</span> <span class="s">&quot;stepSize&quot;</span><span class="o">:</span> <span class="mi">20</span> <span class="p">}</span> <span class="p">};</span>  <span class="c1">// not typo in key &quot;tyep&quot;</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">type</span> <span class="o">=</span> <span class="n">getValue</span><span class="p">(</span> <span class="n">j</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="s">&quot;rungeKutta4&quot;</span> <span class="p">);</span>
</pre></div>
</div>
<p>This would result in the integrator being used to be of the default type <code class="docutils literal"><span class="pre">rungeKutta4</span></code> even though the intention of the user was to use of type <code class="docutils literal"><span class="pre">euler</span></code>. However, the user will not know about this unless they have configured the validator to warn about the use of default values (which is off by default). Thus, before integrating the equations of motion, when all the required information has been retrieved from the <code class="docutils literal"><span class="pre">mainJson</span></code> object, the call to <code class="docutils literal"><span class="pre">checkUnusedKeys</span></code> will print the following warning (by default):</p>
<div class="highlight-txt"><div class="highlight"><pre><span></span>Unused key: integrator.tyep
</pre></div>
</div>
<p>allowing the user to quickly identify and fix the problem. The validator can also be configured not to print a warning (this is highly discouraged) or to terminate in case that there are unused keys.</p>
<p>In order to make this feature possible, the <code class="docutils literal"><span class="pre">json_interface</span></code> has to keep track of all the key paths of <code class="docutils literal"><span class="pre">mainJson</span></code> that have been accessed, and then iterate over all its keys to check whether any of them has not been used. Keeping track of the accessed key paths is done by calling the <code class="docutils literal"><span class="pre">getValue</span></code> function (i.e. using the default value access methods will not keep track of the used keys). The original implementation proposal consisted in defining a special key, e.g. <code class="docutils literal"><span class="pre">#accessedKeyPaths</span></code>, for the <code class="docutils literal"><span class="pre">mainJson</span></code> object, in which an array of <code class="xref py py-class docutils literal"><span class="pre">KeyPath</span></code> s would be stored. However, the <code class="docutils literal"><span class="pre">mainJson</span></code> object is not always accessible in the <code class="docutils literal"><span class="pre">from_json</span></code> functions. For instance, in the following code it <em>is</em> accessible:</p>
<div class="literal-block-wrapper docutils container" id="simulation-h">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal"><span class="pre">simulation.h</span></code></span><a class="headerlink" href="#simulation-h" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;integrator.h&quot;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">from_json</span><span class="p">(</span> <span class="k">const</span> <span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span> <span class="n">mainJson</span><span class="p">,</span> <span class="n">Simulation</span><span class="o">&amp;</span> <span class="n">simulation</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">simulation</span><span class="p">.</span><span class="n">integrator</span> <span class="o">=</span>
      <span class="n">getValue</span><span class="o">&lt;</span> <span class="n">Integrator</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">mainJson</span><span class="p">,</span> <span class="s">&quot;integrator&quot;</span> <span class="p">);</span>  <span class="c1">// integrators::from_json called</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>so the <code class="docutils literal"><span class="pre">getValue</span></code> function could potentially modify <code class="docutils literal"><span class="pre">mainJson</span></code> to add <code class="docutils literal"><span class="pre">integrator</span></code> as an accessed key, but here the <code class="docutils literal"><span class="pre">mainJson</span></code> object is not accessible:</p>
<div class="literal-block-wrapper docutils container" id="integrator-h">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal"><span class="pre">integrator.h</span></code></span><a class="headerlink" href="#integrator-h" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">integrators</span>
<span class="p">{</span>
    <span class="kt">void</span> <span class="n">from_json</span><span class="p">(</span> <span class="k">const</span> <span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span> <span class="n">jsonIntegrator</span><span class="p">,</span> <span class="n">Integrator</span><span class="o">&amp;</span> <span class="n">integrator</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">integrator</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">getValue</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">jsonIntegrator</span><span class="p">,</span> <span class="s">&quot;type&quot;</span> <span class="p">);</span>
        <span class="n">integrator</span><span class="p">.</span><span class="n">stepSize</span> <span class="o">=</span> <span class="n">getValue</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">jsonIntegrator</span><span class="p">,</span> <span class="s">&quot;stepSize&quot;</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>and thus is is not possible for the <code class="docutils literal"><span class="pre">getValue</span></code> to add the <code class="docutils literal"><span class="pre">integrator.type</span></code> and <code class="docutils literal"><span class="pre">integrator.stepSize</span></code> key paths to the <code class="docutils literal"><span class="pre">mainObject</span></code>’s <code class="docutils literal"><span class="pre">#accessedKeyPaths</span></code> special key.</p>
<p>A possible walk-around this issue could consist in defining the <code class="docutils literal"><span class="pre">#accessedKeyPaths</span></code> for each <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> object, and not only for the <code class="docutils literal"><span class="pre">mainJson</span></code>. However, the updated sub-<code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> objects would still have to be passed back to the <code class="docutils literal"><span class="pre">mainJson</span></code> somehow. Even if this was possible, the definition of the <code class="docutils literal"><span class="pre">from_json</span></code> function, with the first argument as a <code class="docutils literal"><span class="pre">const</span> <span class="pre">nlohmann::json&amp;</span></code> makes this approach unfeasible, as the <code class="docutils literal"><span class="pre">getValue</span></code> function would not be capable of updating it (it will not be possible to update its <code class="docutils literal"><span class="pre">#accessedKeyPaths</span></code> because it is a constant object). Thus, a completely different approach had to be followed, making use of a global variable. This global variable is declared in <code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Support/valueAccess.h</span></code>:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="k">extern</span> <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span> <span class="n">KeyPath</span> <span class="o">&gt;</span> <span class="n">accessedKeyPaths</span><span class="p">;</span>
</pre></div>
</div>
<p>This variable is automatically updated when calling the <code class="docutils literal"><span class="pre">getValue</span></code> function. In order to clear the contents of this variable, the function <code class="docutils literal"><span class="pre">clearAccessHistory</span></code> must be called. In the <code class="docutils literal"><span class="pre">json_interface</span></code> application, this is done after reading the input JSON file and just before starting to use the read <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> object to update the settings objects.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The current implementation has one limitation: it is not possible to keep track of the accessed keys of multiple <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> objects simultaneously. Currently, this is not done anywhere in the JSON Interface library, but if in the feature this is required, it will be necessary to create a derived class of <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> (e.g. <code class="xref py py-class docutils literal"><span class="pre">EnhancedJSON</span></code>) with the <code class="docutils literal"><span class="pre">accessedKeyPaths</span></code> as property and the functions <code class="docutils literal"><span class="pre">getValue</span></code> and <code class="docutils literal"><span class="pre">checkUnusedKeys</span></code> as methods (probably other global functions declared in <code class="xref py py-class docutils literal"><span class="pre">Tudat/JsonInterface/Support/valueAccess.h</span></code> would also have to be moved to this class). The <code class="docutils literal"><span class="pre">to_json</span></code> and <code class="docutils literal"><span class="pre">from_json</span></code> methods would have to be updated to take objects of this class as first argument instead of the basic <code class="xref py py-class docutils literal"><span class="pre">nlohmann::json</span></code> objects. An attempt to implement this was done at one point during the development of the <code class="docutils literal"><span class="pre">json_interface</span></code>, but it was unsuccessful due to the existence of an <a class="reference external" href="https://github.com/nlohmann/json/issues/608">inheritance bug</a> in the JSON library.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="enumerations.html" class="btn btn-neutral float-right" title="Enumerations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="enhancedValueSet.html" class="btn btn-neutral" title="Enhanced value set" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Delft University of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header .arrow").click(function() {
            $(this).closest('.toggle').children().not(".header").toggle(400);
            $(this).toggleClass("open");
            // $(this).html() == "More" ? $(this).html('Less') : $(this).html('More');
        });
        $(".showall").click(function() {
            $(".toggle > *").show(400);
            $(".toggle .header .arrow").addClass("open");
        });
        $(".hideall").click(function() {
            $(".toggle > *").hide(400);
            $(".toggle .header").show(400);
            $(".toggle .header .arrow").removeClass("open");
        });
    });
</script>


</body>
</html>