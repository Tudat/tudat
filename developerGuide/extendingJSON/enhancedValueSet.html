

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Enhanced value set &mdash; TU Delft Astrodynamic Toolbox  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="TU Delft Astrodynamic Toolbox  documentation" href="../../index.html"/>
        <link rel="up" title="Extending the JSON Interface" href="index.html"/>
        <link rel="next" title="Validation" href="validation.html"/>
        <link rel="prev" title="Enhanced value access" href="enhancedValueAccess.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> TU Delft Astrodynamic Toolbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Start Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials and Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ/index.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../githubBasics/githubBasics.html">Github Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../updatingTudat/updatingTudat.html">Updating Tudat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../addingFeatures/index.html">Adding Features to Tudat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qtBasics/qtBasics.html">Qt Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../applicationCMakeLists/applicationCMakeLists.html">Application CMakelists</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Extending the JSON Interface</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="valueConversions.html">Value conversions</a></li>
<li class="toctree-l3"><a class="reference internal" href="enhancedDeserialization.html">Enhanced deserialisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="enhancedValueAccess.html">Enhanced value access</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Enhanced value set</a></li>
<li class="toctree-l3"><a class="reference internal" href="validation.html">Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="enumerations.html">Enumerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="settingsClasses.html">Settings classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="otherTypes.html">Other types</a></li>
<li class="toctree-l3"><a class="reference internal" href="unitTesting.html">Unit testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../extendingMATLAB/index.html">Extending the MATLAB Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howToWriteTheWiki/howToWriteTheWiki.html">How to Write the Wiki</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TU Delft Astrodynamic Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Developer Guide</a> &raquo;</li>
        
          <li><a href="index.html">Extending the JSON Interface</a> &raquo;</li>
        
      <li>Enhanced value set</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/developerGuide/extendingJSON/enhancedValueSet.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="enhanced-value-set">
<span id="extendingjson-enhancedvalueset"></span><h1>Enhanced value set<a class="headerlink" href="#enhanced-value-set" title="Permalink to this headline">¶</a></h1>
<p>In the previous section, the enhanced value access functionality has been introduced. This functionality allows the user to easily validate their input JSON files by providing comprehensible error messages in case non-defaultable properties are missing or the provided values are not convertible to the expected type. This was achieved by using <code class="xref py py-class docutils literal notranslate"><span class="pre">KeyPath</span></code> s, special keys and the <code class="docutils literal notranslate"><span class="pre">getValue</span></code> function.</p>
<p>However, there is nothing like a <code class="docutils literal notranslate"><span class="pre">setValue</span></code> function, and <code class="xref py py-class docutils literal notranslate"><span class="pre">KeyPath</span></code> s are not used in <code class="docutils literal notranslate"><span class="pre">to_json</span></code> functions. This is so because there is no need for validation when converting Tudat objects to JSON. If the process is not successful, it will be the developer’s fault and not the user’s. Additionally, although it is not always possible to access an arbitrary key, since it may be undefined, it is always possible to define any arbitrary key for a <code class="xref py py-class docutils literal notranslate"><span class="pre">nlohmann::json</span></code> object.</p>
<p>Nonetheless, there are a few functions provided by the <code class="docutils literal notranslate"><span class="pre">json_interface</span></code> that can make the writing of <code class="docutils literal notranslate"><span class="pre">to_json</span></code> functions easier, namely:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">assignIfNotNaN(</span> <span class="pre">nlohmann::json&amp;</span> <span class="pre">j,</span> <span class="pre">const</span> <span class="pre">std::string&amp;</span> <span class="pre">key,</span> <span class="pre">const</span> <span class="pre">EquatableType&amp;</span> <span class="pre">value</span> <span class="pre">)</span></code>: updates or defines <code class="docutils literal notranslate"><span class="pre">j[</span> <span class="pre">key</span> <span class="pre">]</span></code> only if <code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">==</span> <span class="pre">value</span></code> (this comparison returns <code class="docutils literal notranslate"><span class="pre">false</span></code> for <code class="docutils literal notranslate"><span class="pre">TUDAT_NAN</span></code>). Can only be used when the comparison operator is defined for <code class="docutils literal notranslate"><span class="pre">EquatableType</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">assignIfNotNull(</span> <span class="pre">nlohmann::json&amp;</span> <span class="pre">j,</span> <span class="pre">const</span> <span class="pre">std::string&amp;</span> <span class="pre">key,</span> <span class="pre">const</span> <span class="pre">std::shared_ptr&lt;</span> <span class="pre">T</span> <span class="pre">&gt;&amp;</span> <span class="pre">object</span> <span class="pre">)</span></code>: updates or defines <code class="docutils literal notranslate"><span class="pre">j[</span> <span class="pre">key</span> <span class="pre">]</span></code> only if <code class="docutils literal notranslate"><span class="pre">object</span> <span class="pre">!=</span> <span class="pre">NULL</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">assignIfNotEmpty(</span> <span class="pre">nlohmann::json&amp;</span> <span class="pre">j,</span> <span class="pre">const</span> <span class="pre">std::string&amp;</span> <span class="pre">key,</span> <span class="pre">const</span> <span class="pre">ContainerType&amp;</span> <span class="pre">container</span> <span class="pre">)</span></code>: updates or defines <code class="docutils literal notranslate"><span class="pre">j[</span> <span class="pre">key</span> <span class="pre">]</span></code> only if <code class="docutils literal notranslate"><span class="pre">object.empty(</span> <span class="pre">)</span> <span class="pre">==</span> <span class="pre">false</span></code>. Can only be used when the method <code class="docutils literal notranslate"><span class="pre">empty</span></code> is defined for <code class="docutils literal notranslate"><span class="pre">ContainerType</span></code>.</p></li>
</ul>
<p>Note that the following is not possible:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="w"> </span><span class="n">mainJson</span><span class="p">;</span><span class="w"></span>
<span class="n">KeyPath</span><span class="w"> </span><span class="n">keyPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;integrator&quot;</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="p">;</span><span class="w"></span>
<span class="n">mainJson</span><span class="p">[</span><span class="w"> </span><span class="n">keyPath</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rungeKutta4&quot;</span><span class="p">;</span><span class="w">             </span><span class="c1">// compile error</span>
<span class="n">mainJson</span><span class="p">[</span><span class="w"> </span><span class="s">&quot;integrator.type&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rungeKutta4&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// wrong! {&quot;integrator.type&quot;:&quot;rungeKutta4&quot;}</span>
</pre></div>
</div>
<p>Instead, the default basic value set methods have to be used:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="w"> </span><span class="n">mainJson</span><span class="p">;</span><span class="w"></span>
<span class="n">mainJson</span><span class="p">[</span><span class="w"> </span><span class="s">&quot;integrator&quot;</span><span class="w"> </span><span class="p">][</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;rungeKutta4&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>If one wants to use the properties of a given object to update the keys of a <code class="xref py py-class docutils literal notranslate"><span class="pre">nlohmann::json</span></code> object that is above in the key tree, e.g.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kr">inline</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="w"> </span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Integrator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">integrator</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">j</span><span class="p">[</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integrator</span><span class="p">.</span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">j</span><span class="p">[</span><span class="w"> </span><span class="s">&quot;stepSize&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integrator</span><span class="p">.</span><span class="n">stepSize</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">j</span><span class="p">[</span><span class="w"> </span><span class="s">&quot;&lt;-&quot;</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="s">&quot;initialEpoch&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integrator</span><span class="p">.</span><span class="n">initialTime</span><span class="p">;</span><span class="w">   </span><span class="c1">// compile error</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>this is not possible (yet). This kind of implementation is required only once in the whole JSON Interface library, when converting a <code class="xref py py-class docutils literal notranslate"><span class="pre">Simulation</span></code> object to <code class="xref py py-class docutils literal notranslate"><span class="pre">nlohmann::json</span></code>, as the information contained in the propagator settings is stored in three different places in the simulation object (part of its information is stored in the key <span class="jsonkey">propagators</span> of the <code class="docutils literal notranslate"><span class="pre">mainJson</span></code>, the termination settings are stored in the key <span class="jsonkey">termination</span> of the <code class="docutils literal notranslate"><span class="pre">mainJson</span></code>, and the print interval is stored in the <span class="jsonkey">options.printInterval</span> key path of the <code class="docutils literal notranslate"><span class="pre">mainJson</span></code>). To do so, the following implementation was chosen (code has been simplified):</p>
<div class="literal-block-wrapper docutils container" id="simulation-h">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal notranslate"><span class="pre">simulation.h</span></code></span><a class="headerlink" href="#simulation-h" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="w"> </span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mainJson</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Simulation</span><span class="o">&amp;</span><span class="w"> </span><span class="n">simulation</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="n">mainJson</span><span class="p">[</span><span class="w"> </span><span class="s">&quot;integrator&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">simulation</span><span class="p">.</span><span class="n">integrator</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="n">propagators</span><span class="o">::</span><span class="n">to_json</span><span class="p">(</span><span class="w"> </span><span class="n">mainJson</span><span class="p">,</span><span class="w"> </span><span class="n">simulation</span><span class="p">.</span><span class="n">propagator</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="propagator-h">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal notranslate"><span class="pre">propagator.h</span></code></span><a class="headerlink" href="#propagator-h" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span><span class="w"> </span><span class="nn">propagators</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="w"> </span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mainJson</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Propagator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">propagator</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">mainJson</span><span class="p">[</span><span class="w"> </span><span class="s">&quot;propagators&quot;</span><span class="w"> </span><span class="p">][</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">][</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">propagator</span><span class="p">.</span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">mainJson</span><span class="p">[</span><span class="w"> </span><span class="s">&quot;propagators&quot;</span><span class="w"> </span><span class="p">][</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">][</span><span class="w"> </span><span class="s">&quot;centralBodies&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">propagator</span><span class="p">.</span><span class="n">centralBodies</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">...</span><span class="w"></span>
<span class="w">        </span><span class="n">mainJson</span><span class="p">[</span><span class="w"> </span><span class="s">&quot;termination&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">propagator</span><span class="p">.</span><span class="n">terminationSettings</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">mainJson</span><span class="p">[</span><span class="w"> </span><span class="s">&quot;options&quot;</span><span class="w"> </span><span class="p">][</span><span class="w"> </span><span class="s">&quot;printInterval&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">propagator</span><span class="p">.</span><span class="n">printInterval</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>This is the only case in which a <code class="docutils literal notranslate"><span class="pre">to_json</span></code> function is manually called in the JSON Interface library. Note that, when passed to the <code class="docutils literal notranslate"><span class="pre">to_json</span></code> function, the <code class="docutils literal notranslate"><span class="pre">mainJson</span></code> object is not re-initialised, so the keys defined before this function call are kept.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="validation.html" class="btn btn-neutral float-right" title="Validation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="enhancedValueAccess.html" class="btn btn-neutral" title="Enhanced value access" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Delft University of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header .arrow").click(function() {
            $(this).closest('.toggle').children().not(".header").toggle(400);
            $(this).toggleClass("open");
            // $(this).html() == "More" ? $(this).html('Less') : $(this).html('More');
        });
        $(".showall").click(function() {
            $(".toggle > *").show(400);
            $(".toggle .header .arrow").addClass("open");
        });
        $(".hideall").click(function() {
            $(".toggle > *").hide(400);
            $(".toggle .header").show(400);
            $(".toggle .header .arrow").removeClass("open");
        });

        var nav_top_height = Math.round($(".wy-side-nav-search").outerHeight())+2;
        $(".wy-nav-content-wrap").prepend("<div id='announcement'><p>⚠️ This website is now mostly outdated! ⚠️</p><p>Please visit <a href='https://tudat-space.readthedocs.io/en/latest'>tudat-space.readthedocs.io</a> instead.</p></div>");
        $("#announcement").css("height", String(nav_top_height) + "px");
        $(".rst-content").css("margin-top", String(nav_top_height) + "px");
    });
</script>


</body>
</html>