

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. Adding a New State Derivative Model &mdash; TU Delft Astrodynamic Toolbox  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="TU Delft Astrodynamic Toolbox  documentation" href="../../index.html"/>
        <link rel="up" title="Adding Features to Tudat" href="index.html"/>
        <link rel="next" title="5. Adding a New Estimatable Parameter" href="addingNewEstimatableParameter.html"/>
        <link rel="prev" title="3. Adding a New Acceleration Model" href="addingNewAccelerationModel.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> TU Delft Astrodynamic Toolbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Start Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials and Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ/index.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../githubBasics/githubBasics.html">Github Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../updatingTudat/updatingTudat.html">Updating Tudat</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Adding Features to Tudat</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="addingDependentVariablesToSave.html">1. Adding Dependent Variables to Save</a></li>
<li class="toctree-l3"><a class="reference internal" href="addingNewEnvironmentModel.html">2. Adding a New Environment Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="addingNewAccelerationModel.html">3. Adding a New Acceleration Model</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">4. Adding a New State Derivative Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="addingNewEstimatableParameter.html">5. Adding a New Estimatable Parameter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../qtBasics/qtBasics.html">Qt Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../applicationCMakeLists/applicationCMakeLists.html">Application CMakelists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extendingJSON/index.html">Extending the JSON Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extendingMATLAB/index.html">Extending the MATLAB Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howToWriteTheWiki/howToWriteTheWiki.html">How to Write the Wiki</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TU Delft Astrodynamic Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Developer Guide</a> &raquo;</li>
        
          <li><a href="index.html">Adding Features to Tudat</a> &raquo;</li>
        
      <li><span class="section-number">4. </span>Adding a New State Derivative Model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/developerGuide/addingFeatures/addingNewStateDerivativeModel.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adding-a-new-state-derivative-model">
<span id="addingnewstatederivativemodel"></span><h1><span class="section-number">4. </span>Adding a New State Derivative Model<a class="headerlink" href="#adding-a-new-state-derivative-model" title="Permalink to this headline">¶</a></h1>
<p>Another type of model which allows the user to add extra features to it, is the state derivative model. These models are used by the dynamics simulator to determine how the state equations are solved. Currently there are several available, e.g. cowell state derivative model, encke state derivate model, and more, but if a special model is needed for a certain application, the user can add this to tudat by following this guide.</p>
<p>As before, this guide will start by looking at the framework of how the state derivative model is implemented. First, the state derivative model is chosen by the user from an enum called <code class="docutils literal notranslate"><span class="pre">TranslationalPropagatorType</span></code>, located in <code class="docutils literal notranslate"><span class="pre">nBodyStateDerivativeModel.h</span></code>. The model picked from this enum is then used as an input into the constructor of the <code class="docutils literal notranslate"><span class="pre">TranslationalPropagatorSettings</span></code>, where it is assigned to a specific member variable called: <code class="docutils literal notranslate"><span class="pre">propagator_</span></code>. The <code class="docutils literal notranslate"><span class="pre">TranslationalPropagatorSettings</span></code> is used as an input to the <code class="docutils literal notranslate"><span class="pre">SingleArcDynamicsSimulator</span></code>, where it will be used further. An example of this is shown below:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="c1">// Create propagation settings.</span>
<span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="w"> </span><span class="n">TranslationalStatePropagatorSettings</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">propagatorSettings</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">         </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">TranslationalStatePropagatorSettings</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">         </span><span class="p">(</span><span class="w"> </span><span class="n">centralBodies</span><span class="p">,</span><span class="w"> </span><span class="n">accelerationModelMap</span><span class="p">,</span><span class="w"> </span><span class="n">bodiesToPropagate</span><span class="p">,</span><span class="w"> </span><span class="n">systemInitialState</span><span class="p">,</span><span class="w"></span>
<span class="w">           </span><span class="n">terminationSettings</span><span class="p">,</span><span class="w"> </span><span class="n">cowell</span><span class="p">,</span><span class="w"> </span><span class="n">dependentVariablesToSave</span><span class="w"> </span><span class="p">);</span><span class="w"></span>

<span class="c1">// Create simulation object and propagate dynamics.</span>
<span class="n">SingleArcDynamicsSimulator</span><span class="o">&lt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dynamicsSimulator</span><span class="p">(</span><span class="w"></span>
<span class="w">         </span><span class="n">bodyMap</span><span class="p">,</span><span class="w"> </span><span class="n">integratorSettings</span><span class="p">,</span><span class="w"> </span><span class="n">propagatorSettings</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Inside <code class="docutils literal notranslate"><span class="pre">SingleArcDynamicsSimulator</span></code>, the propagator settings are passed to various functions, but the state derivative model is only needed in <code class="docutils literal notranslate"><span class="pre">createStateDerivativeModels</span></code>. This function returns a vector of <code class="docutils literal notranslate"><span class="pre">SingleStateTypeDerivative</span></code>. If a hybrid state derivative model is used, this function will fill the vector with state derivative models. If not, this vector will only contain one state derivative model, created by the function (equally) called <code class="docutils literal notranslate"><span class="pre">createStateDerivativeModels</span></code>. This function checks what kind of state is propagated (translational, rotational, etc.) and creates the specific state derivative model. For example, for the translational state it will call the <code class="docutils literal notranslate"><span class="pre">createTranslationalStateDerivativeModel</span></code> function. This function looks as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="k">template</span><span class="o">&lt;</span><span class="w"> </span><span class="k">typename</span> <span class="nc">StateScalarType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span> <span class="nc">TimeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="w"></span>
<span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="w"> </span><span class="n">SingleStateTypeDerivative</span><span class="o">&lt;</span><span class="w"> </span><span class="n">StateScalarType</span><span class="p">,</span><span class="w"> </span><span class="n">TimeType</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"></span>
<span class="w"> </span><span class="n">createTranslationalStateDerivativeModel</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="w"> </span><span class="n">TranslationalStatePropagatorSettings</span><span class="o">&lt;</span><span class="w"> </span><span class="n">StateScalarType</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">        </span><span class="n">translationPropagatorSettings</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">simulation_setup</span><span class="o">::</span><span class="n">NamedBodyMap</span><span class="o">&amp;</span><span class="w"> </span><span class="n">bodyMap</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">TimeType</span><span class="w"> </span><span class="n">propagationStartTime</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Create object for frame origin transformations.</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="w"> </span><span class="n">CentralBodyData</span><span class="o">&lt;</span><span class="w"> </span><span class="n">StateScalarType</span><span class="p">,</span><span class="w"> </span><span class="n">TimeType</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">centralBodyData</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">            </span><span class="n">createCentralBodyData</span><span class="o">&lt;</span><span class="w"> </span><span class="n">StateScalarType</span><span class="p">,</span><span class="w"> </span><span class="n">TimeType</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="n">translationPropagatorSettings</span><span class="o">-&gt;</span><span class="n">centralBodies_</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">translationPropagatorSettings</span><span class="o">-&gt;</span><span class="n">bodiesToIntegrate_</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">bodyMap</span><span class="w"> </span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="w"> </span><span class="n">SingleStateTypeDerivative</span><span class="o">&lt;</span><span class="w"> </span><span class="n">StateScalarType</span><span class="p">,</span><span class="w"> </span><span class="n">TimeType</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">stateDerivativeModel</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Check propagator type and create corresponding state derivative object.</span>
<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="w"> </span><span class="n">translationPropagatorSettings</span><span class="o">-&gt;</span><span class="n">propagator_</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nl">cowell</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">stateDerivativeModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"></span>
<span class="w">                </span><span class="n">NBodyCowellStateDerivative</span><span class="o">&lt;</span><span class="w"> </span><span class="n">StateScalarType</span><span class="p">,</span><span class="w"> </span><span class="n">TimeType</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">                </span><span class="p">(</span><span class="w"> </span><span class="n">translationPropagatorSettings</span><span class="o">-&gt;</span><span class="n">getAccelerationsMap</span><span class="p">(</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">centralBodyData</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="n">translationPropagatorSettings</span><span class="o">-&gt;</span><span class="n">bodiesToIntegrate_</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="w"></span>
<span class="w">                    </span><span class="s">&quot;Error, did not recognize translational state propagation type: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">                    </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="w"> </span><span class="n">translationPropagatorSettings</span><span class="o">-&gt;</span><span class="n">propagator_</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">stateDerivativeModel</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This function is responsible for making the state derivate model based on the <code class="docutils literal notranslate"><span class="pre">TranslationalPropagatorType</span></code> variable decalred by the user, using a switch statement.</p>
<p>When a new state derivative model is implemented in tudat, two additions need to be made to the framework (besides making the model itself). The first part is to add the name of the model to the enum: <code class="docutils literal notranslate"><span class="pre">TranslationalPropagatorType</span></code>. This will allow the user to pick this model and use it as an input to the translational propagator settings. The second step is to add this model to the switch statement in <code class="docutils literal notranslate"><span class="pre">createTranslationalStateDerivativeModel</span></code>. A new case should be made for the name added to the enum before, and in it, the variable <code class="docutils literal notranslate"><span class="pre">stateDerivativeModel</span></code> should be assigned to the new model.</p>
<p>When building the new model, it is advised to use a state derivative model that is already available as an example for a place to start. The classes which contain these models are derived from the base class <code class="docutils literal notranslate"><span class="pre">NBodyStateDerivative</span></code>, and should contain a template for the <code class="docutils literal notranslate"><span class="pre">TimeType</span></code> that will be used. The <code class="docutils literal notranslate"><span class="pre">NBodyStateDerivative</span></code> class is again derived from another class called the <code class="docutils literal notranslate"><span class="pre">SingleStateTypeDerivative</span></code>. This class contains several pure virtual functions, which all should be added to the new model class in order for the new model to work. The specific names and input parameters of these functions can be found in the <code class="docutils literal notranslate"><span class="pre">SingleStateTypeDerivative</span></code> class. Once this is done, and the new model is implemented in the state derivative model framework, the new model should be available for the user.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Don’t forget to put the include statement in <code class="docutils literal notranslate"><span class="pre">createStateDerivativeModel.h</span></code> if the new class is made in a seperate file.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="addingNewEstimatableParameter.html" class="btn btn-neutral float-right" title="5. Adding a New Estimatable Parameter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="addingNewAccelerationModel.html" class="btn btn-neutral" title="3. Adding a New Acceleration Model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Delft University of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header .arrow").click(function() {
            $(this).closest('.toggle').children().not(".header").toggle(400);
            $(this).toggleClass("open");
            // $(this).html() == "More" ? $(this).html('Less') : $(this).html('More');
        });
        $(".showall").click(function() {
            $(".toggle > *").show(400);
            $(".toggle .header .arrow").addClass("open");
        });
        $(".hideall").click(function() {
            $(".toggle > *").hide(400);
            $(".toggle .header").show(400);
            $(".toggle .header .arrow").removeClass("open");
        });

        var nav_top_height = Math.round($(".wy-side-nav-search").outerHeight())+2;
        $(".wy-nav-content-wrap").prepend("<div id='announcement'><p>⚠️ This website is now mostly outdated! ⚠️</p><p>Please visit <a href='https://tudat-space.readthedocs.io/en/latest'>tudat-space.readthedocs.io</a> instead.</p></div>");
        $("#announcement").css("height", String(nav_top_height) + "px");
        $(".rst-content").css("margin-top", String(nav_top_height) + "px");
    });
</script>


</body>
</html>