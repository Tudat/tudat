

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basics &mdash; TU Delft Astrodynamic Toolbox  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="TU Delft Astrodynamic Toolbox  documentation" href="../../index.html"/>
        <link rel="up" title="Extending the MATLAB Interface" href="index.html"/>
        <link rel="next" title="Adding features" href="addingFeatures.html"/>
        <link rel="prev" title="Extending the MATLAB Interface" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> TU Delft Astrodynamic Toolbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Start Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials and Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ/index.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../githubBasics/githubBasics.html">Github Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../updatingTudat/updatingTudat.html">Updating Tudat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../addingFeatures/index.html">Adding Features to Tudat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qtBasics/qtBasics.html">Qt Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../applicationCMakeLists/applicationCMakeLists.html">Application CMakelists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extendingJSON/index.html">Extending the JSON Interface</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Extending the MATLAB Interface</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Basics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#code-structure">Code structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deserialisation-decoding">Deserialisation (decoding)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#serialisation-encoding">Serialisation (encoding)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="addingFeatures.html">Adding features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../howToWriteTheWiki/howToWriteTheWiki.html">How to Write the Wiki</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TU Delft Astrodynamic Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Developer Guide</a> &raquo;</li>
        
          <li><a href="index.html">Extending the MATLAB Interface</a> &raquo;</li>
        
      <li>Basics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/developerGuide/extendingMATLAB/basics.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basics">
<span id="extendingmatlab-basics"></span><h1>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h1>
<p>No external packages or functions are used in the MATLAB interface. All the necessary code is available in the directory <code class="xref py py-class docutils literal notranslate"><span class="pre">tudatBundle/matlabInterface/MatlabInterface</span></code> or through the use of built-in MATLAB functions. The MATLAB interface uses the built-in functions <a class="reference external" href="https://nl.mathworks.com/help/matlab/ref/jsondecode.html">jsondecode</a>, <a class="reference external" href="https://nl.mathworks.com/help/matlab/ref/jsonencode.html">jsonencode</a> and <a class="reference external" href="https://nl.mathworks.com/help/matlab/ref/split.html">split</a>, which are only available since version R2016b.</p>
<div class="section" id="code-structure">
<h2>Code structure<a class="headerlink" href="#code-structure" title="Permalink to this headline">¶</a></h2>
<p>The contents of the MATLAB interface are structured in three directories:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Examples</strong>: contains example scripts.</p></li>
<li><p><strong>MatlabInterface</strong>: contains the source code. Includes class definitions for creating settings objects, as well as some packages (directories starting with “+”).</p></li>
<li><p><strong>UnitTests</strong>: contains scripts used to generate input files for the <a class="reference internal" href="../../tutorials/jsonInterface/index.html#jsoninterface"><span class="std std-ref">JSON Interface</span></a>.</p></li>
</ul>
</div></blockquote>
<p>Additionally, these three files can be found in the root directory:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>setup.m</strong>: adds the directory <code class="xref py py-class docutils literal notranslate"><span class="pre">tudatBundle/matlabInterface</span></code> to the user’s MATLAB path definition permanently.</p></li>
<li><p><strong>build.m</strong>: builds all the required targets (using CMake and the C++ code in the tudatBundle) for the MATLAB interface to work properly.</p></li>
<li><p><strong>tudat.m</strong>: defines the class <code class="xref py py-class docutils literal notranslate"><span class="pre">tudat</span></code> that is used to include all the source directories in the current session’s path, amongst other things.</p></li>
</ul>
</div></blockquote>
<div class="section" id="the-tudat-class">
<h3>The <code class="xref py py-class docutils literal notranslate"><span class="pre">tudat</span></code> class<a class="headerlink" href="#the-tudat-class" title="Permalink to this headline">¶</a></h3>
<p>After running <code class="docutils literal notranslate"><span class="pre">setup.m</span></code> (to be done only once), one can write <code class="docutils literal notranslate"><span class="pre">tudat.load()</span></code> (in the current or future MATLAB sessions). In this way, all the classes and functions inside <code class="xref py py-class docutils literal notranslate"><span class="pre">tudatBundle/matlabInterface/MatlabInterface</span></code> become available directly through their name, except for the code contained in package directories, which has to be accessed through <code class="docutils literal notranslate"><span class="pre">packageName.functionOrClassName(...)</span></code>.</p>
<p>It is also possible to run all the unit tests associated to the MATLAB/JSON interfaces by calling <code class="docutils literal notranslate"><span class="pre">tudat.test()</span></code>. This class also stores some paths, such as the absolute path to the MATLAB interface, its source directory, its unit tests directory or the (optional) file <code class="docutils literal notranslate"><span class="pre">settings.mat</span></code>, created when the user defines custom paths for the tudatBundle and associated targets. By default, the <code class="xref py py-class docutils literal notranslate"><span class="pre">tudatBundle</span></code> directory is the parent directory of the <code class="xref py py-class docutils literal notranslate"><span class="pre">matlabInterface</span></code> directory, but this can be changed by calling <code class="docutils literal notranslate"><span class="pre">tudat.find(absolutePathToTudatBundle)</span></code>.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">tudat</span></code> class can also be used to set/get user settings, stored in the file <code class="docutils literal notranslate"><span class="pre">settings.mat</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface/tudat.m</span></code></span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">properties</span><span class="w"> </span><span class="p">(</span>Constant<span class="p">,</span><span class="w"> </span>Hidden<span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">...</span><span class="w"></span>
<span class="w">  </span><span class="n">bundlePathKey</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;bundlePath&#39;</span><span class="w"></span>
<span class="w">  </span><span class="n">defaultBundlePath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fileparts</span><span class="p">(</span><span class="n">tudat</span><span class="p">.</span><span class="n">rootdir</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">...</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="k">...</span><span class="w"></span>
<span class="k">methods</span><span class="w"> </span><span class="p">(</span><span class="n">Static</span><span class="p">,</span><span class="w"> </span><span class="n">Hidden</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">function</span><span class="w"> </span>path<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">bundle</span><span class="p">(</span>newPath<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="nb">nargin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="c">% get</span><span class="w"></span>
<span class="w">          </span><span class="k">try</span><span class="w"></span>
<span class="w">              </span><span class="nb">path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tudat</span><span class="p">.</span><span class="n">settings</span><span class="p">.(</span><span class="n">tudat</span><span class="p">.</span><span class="n">bundlePathKey</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="k">catch</span><span class="w"></span>
<span class="w">              </span><span class="nb">path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tudat</span><span class="p">.</span><span class="n">defaultBundlePath</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="k">end</span><span class="w"></span>
<span class="w">      </span><span class="k">else</span><span class="w">  </span><span class="c">% set</span><span class="w"></span>
<span class="w">          </span><span class="n">updateSetting</span><span class="p">(</span><span class="n">tudat</span><span class="p">.</span><span class="n">bundlePathKey</span><span class="p">,</span><span class="n">newPath</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">end</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="k">...</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>If the settings named <code class="docutils literal notranslate"><span class="pre">bundlePath</span></code> is not stored in the file <code class="docutils literal notranslate"><span class="pre">settings.mat</span></code>, or if this file does not exist, the default bundle path will be returned when calling <code class="docutils literal notranslate"><span class="pre">tudat.bundle</span></code>. The setting can be modified by calling <code class="docutils literal notranslate"><span class="pre">tudat.bundle(customPath)</span></code>. In the same way, support for additional user settings can be added in the future. Note that these properties and methods are usually hidden, as the user will rarely use them. The settings that can be currently customised are: <code class="docutils literal notranslate"><span class="pre">bundlePath</span></code>, <code class="docutils literal notranslate"><span class="pre">binaryPath</span></code> (the path to the binary <code class="docutils literal notranslate"><span class="pre">json_interface</span></code>), <code class="docutils literal notranslate"><span class="pre">testsSourcesDirectoryPath</span></code> (the path to the directory containing the JSON Interface unit tests C++ sources) and <code class="docutils literal notranslate"><span class="pre">testsBinariesDirectoryPath</span></code> (the path to the directory containing the C++ unit tests binaries).</p>
</div>
</div>
<div class="section" id="deserialisation-decoding">
<h2>Deserialisation (decoding)<a class="headerlink" href="#deserialisation-decoding" title="Permalink to this headline">¶</a></h2>
<p>The built-in function <code class="docutils literal notranslate"><span class="pre">jsondecode</span></code> fails when the provided text to be decoded (or deserialised) contains line breaks. A custom <code class="docutils literal notranslate"><span class="pre">json.decode</span></code> function, located in <code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface/+json/decode.m</span></code> has been written to bypass this limitation.</p>
<p>However, currently the MATLAB interface does not support creating settings objects from JSON text. This means that, if one decodes the string <code class="docutils literal notranslate"><span class="pre">{&quot;mass&quot;:</span> <span class="pre">5000,</span> <span class="pre">&quot;referenceArea&quot;:</span> <span class="pre">10}</span></code>, a struct will be obtained, but not an object of <a class="reference internal" href="../../tutorials/tudatFeatures/environmentSetup/setup.html#Body" title="Body"><code class="xref py py-class docutils literal notranslate"><span class="pre">Body</span></code></a> class. To add support for creating settings objects from JSON text, it would be necessary to write custom constructor implementations or static functions for all the classes in the <code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface</span></code> directory or to provide this for the <code class="xref py py-class docutils literal notranslate"><span class="pre">jsonable</span></code> class, from which all the settings objects classes derive, in a similar way as done for serialisation.</p>
</div>
<div class="section" id="serialisation-encoding">
<h2>Serialisation (encoding)<a class="headerlink" href="#serialisation-encoding" title="Permalink to this headline">¶</a></h2>
<p>Serialisation consists in converting MATLAB variables to JSON-formatted text. This is done using the built-in function <code class="docutils literal notranslate"><span class="pre">jsonencode</span></code>. This function generates a single-line text, which is difficult to read for long files. Thus, a custom <code class="docutils literal notranslate"><span class="pre">json.encode</span></code> function, located in <code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface/+json/encode.m</span></code>, has been written. This function has a second input argument, <code class="docutils literal notranslate"><span class="pre">tabsize</span></code>, used to determine the number of spaces for each indentation level. For instance, a value of <code class="docutils literal notranslate"><span class="pre">2</span></code> adds line breaks and uses two space for each indentation level. When not specified, the value of <code class="docutils literal notranslate"><span class="pre">2</span></code> is used. When set to <code class="docutils literal notranslate"><span class="pre">0</span></code>, no spaces or line breaks are added, resulting in a single-line text.</p>
<p>Before encoding an object into JSON-formatted text, it is necessary to convert that object to something that is serialisable, basically to a number, string, boolean or array/map containing these objects. This is done by using the function <code class="docutils literal notranslate"><span class="pre">json.jsonize</span></code>. For numbers, strings and booleans, this function does nothing, as these types are directly serialisable. For structs and cell arrays, this function <em>jsonizes</em> each of their elements. The built-in encoding function only supports <code class="xref py py-class docutils literal notranslate"><span class="pre">containers.Map</span></code> when its keys are strings, so <code class="docutils literal notranslate"><span class="pre">json.jsonize</span></code> extends this functionality by converting the keys of non-char <code class="xref py py-class docutils literal notranslate"><span class="pre">containers.Map</span></code> to string by using the format specification <code class="docutils literal notranslate"><span class="pre">%g</span></code>. The most important addition of the <code class="docutils literal notranslate"><span class="pre">json.jsonize</span></code> is, however, support for custom classes and enumerations.</p>
<div class="section" id="enumerations">
<h3>Enumerations<a class="headerlink" href="#enumerations" title="Permalink to this headline">¶</a></h3>
<p>For enumerations, the name of the enumeration value is used. This means that nothing has to be added to the enumeration definition for it to be serialisable. For instance, consider the following enumeration:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface/MassRateModel/MassRateModels.m</span></code></span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">classdef</span><span class="w"> </span><span class="n">RotationModels</span><span class="w"></span>
<span class="w">  </span><span class="nb">enumeration</span><span class="w"></span>
<span class="w">      </span><span class="n">simple</span><span class="w"></span>
<span class="w">      </span><span class="n">spice</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>If we use the built-in function and write <code class="docutils literal notranslate"><span class="pre">jsonencode(RotationModels.simple)</span></code> we get:</p>
<div class="highlight-txt notranslate"><div class="highlight"><pre><span></span>Error using jsonencode
Unable to encode objects of enumeration class RotationModels as JSON-formatted text.
</pre></div>
</div>
<p>However, if we use the custom function and write <code class="docutils literal notranslate"><span class="pre">json.encode(RotationModels.simple)</span></code> we get the text <code class="docutils literal notranslate"><span class="pre">&quot;simple&quot;</span></code>. Writing <code class="docutils literal notranslate"><span class="pre">json.jsonize(RotationModels.simple)</span></code> returns the char variable <code class="docutils literal notranslate"><span class="pre">simple</span></code>, i.e. <code class="docutils literal notranslate"><span class="pre">json.jsonize</span></code> converts a variable to something that is serialisable, while <code class="docutils literal notranslate"><span class="pre">json.encode</span></code> actually serialises it.</p>
</div>
<div class="section" id="custom-classes">
<h3>Custom classes<a class="headerlink" href="#custom-classes" title="Permalink to this headline">¶</a></h3>
<p>For classes, the serialisation process is a bit more complex. Although the built-in function supports encoding objects of custom classes, by converting them first to a struct in which each of its field names corresponds to a class’ property, this fails when any of the properties is set to be an object that is not supported by <code class="docutils literal notranslate"><span class="pre">jsonencode</span></code>, such as an enumeration value. Additionally, in some cases it may not be necessary to use all the properties of a class in its JSON representation. Thus, for the classes used in the MATLAB interface, we define a <code class="docutils literal notranslate"><span class="pre">jsonize</span></code> method, which is then called by the <code class="docutils literal notranslate"><span class="pre">json.jsonize</span></code> function. This means that this function, as well as <code class="docutils literal notranslate"><span class="pre">json.encode</span></code>, do not support custom classes that do not implement the method <code class="docutils literal notranslate"><span class="pre">jsonize</span></code>.</p>
<p>Rather than implementing a custom <code class="docutils literal notranslate"><span class="pre">jsonize</span></code> method for all the custom classes, all the classes that should be convertible to JSON were made to derive from the class <code class="xref py py-class docutils literal notranslate"><span class="pre">jsonable</span></code>, defined in <code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface/jsonable.m</span></code>, which derives from the built-in class <code class="xref py py-class docutils literal notranslate"><span class="pre">handle</span></code> (similar to a shared pointer, i.e. if a <code class="xref py py-class docutils literal notranslate"><span class="pre">handle</span></code> is modified, all the objects containing it will also be updated automatically).</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">jsonable</span></code> class has the following (hidden) methods:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">getProperties</span></code>: returns the list of properties to be used for the JSON representation. This list includes all the properties of the (derived) class on which it is called <strong>that are not marked as Transient</strong>. For instance, for the <a class="reference internal" href="../../tutorials/tudatFeatures/environmentSetup/setup.html#Body" title="Body"><code class="xref py py-class docutils literal notranslate"><span class="pre">Body</span></code></a> class:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface/Body/Body.m</span></code></span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">classdef</span><span class="w"> </span><span class="n">Body</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">jsonable</span><span class="w"></span>
<span class="w">  </span><span class="k">properties</span><span class="w"></span>
<span class="w">      </span><span class="n">useDefaultSettings</span><span class="w"></span>
<span class="w">      </span><span class="n">initialState</span><span class="w"></span>
<span class="w">      </span><span class="n">mass</span><span class="w"></span>
<span class="w">      </span><span class="n">rotationalState</span><span class="w"></span>
<span class="w">      </span><span class="n">referenceArea</span><span class="w"></span>
<span class="w">      </span><span class="n">aerodynamics</span><span class="w"></span>
<span class="w">      </span><span class="n">atmosphere</span><span class="w"></span>
<span class="w">      </span><span class="n">ephemeris</span><span class="w"></span>
<span class="w">      </span><span class="n">gravityField</span><span class="w"></span>
<span class="w">      </span><span class="n">gravityFieldVariation</span><span class="w"></span>
<span class="w">      </span><span class="n">radiationPressure</span><span class="w"></span>
<span class="w">      </span><span class="n">rotationModel</span><span class="w"></span>
<span class="w">      </span><span class="n">shapeModel</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="w">  </span><span class="k">properties</span><span class="w"> </span><span class="p">(</span>Transient<span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">name</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="k">...</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>when it is converted to JSON, the property <code class="docutils literal notranslate"><span class="pre">name</span></code> is ignored, because it is used internally by the MATLAB interface but it is not needed by the JSON interface or Tudat.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">isMandatory(property)</span></code>: returns whether the property named <code class="docutils literal notranslate"><span class="pre">property</span></code> is mandatory. If a property is marked as mandatory, but its value is empty, the <code class="docutils literal notranslate"><span class="pre">json.encode</span></code> function will fail. In order to know which properties are mandatory, the derived classes have to implement the (hidden) method <code class="docutils literal notranslate"><span class="pre">getMandatoryProperties</span></code>. For instance, for <a class="reference internal" href="../../tutorials/tudatFeatures/environmentSetup/setup.html#Body" title="Body"><code class="xref py py-class docutils literal notranslate"><span class="pre">Body</span></code></a>:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface/Body/Body.m</span></code></span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">classdef</span><span class="w"> </span><span class="n">Body</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">jsonable</span><span class="w"></span>
<span class="w">  </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="k">methods</span><span class="w"> </span><span class="p">(</span><span class="n">Hidden</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">function</span><span class="w"> </span>mp<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">getMandatoryProperties</span><span class="p">(</span>obj<span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="n">mp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="w">      </span><span class="k">end</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>In this case, none of the properties of <a class="reference internal" href="../../tutorials/tudatFeatures/environmentSetup/setup.html#Body" title="Body"><code class="xref py py-class docutils literal notranslate"><span class="pre">Body</span></code></a> are mandatory, because for a non-perturbed problem, we do not need to define any of its properties, so an empty body (i.e. <code class="docutils literal notranslate"><span class="pre">[]</span></code> or <code class="docutils literal notranslate"><span class="pre">null</span></code>) is valid. In other cases, some of the properties <em>are</em> mandatory:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface/Propagator/Propagator.m</span></code></span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">classdef</span><span class="w"> </span><span class="n">Propagator</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">jsonable</span><span class="w"></span>
<span class="w">  </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="k">methods</span><span class="w"> </span><span class="p">(</span><span class="n">Hidden</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">function</span><span class="w"> </span>mp<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">getMandatoryProperties</span><span class="p">(</span>obj<span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="n">mp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;integratedStateType&#39;</span><span class="p">,</span><span class="s">&#39;bodiesToPropagate&#39;</span><span class="p">};</span><span class="w"></span>
<span class="w">      </span><span class="k">end</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface/Propagator/MassPropagator.m</span></code></span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">classdef</span><span class="w"> </span><span class="n">MassPropagator</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Propagator</span><span class="w"></span>
<span class="w">  </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="k">methods</span><span class="w"> </span><span class="p">(</span><span class="n">Hidden</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">function</span><span class="w"> </span>mp<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">getMandatoryProperties</span><span class="p">(</span>obj<span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="n">mp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">getMandatoryProperties</span><span class="p">@</span><span class="n">Propagator</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="n">mp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">horzcat</span><span class="p">(</span><span class="n">mp</span><span class="p">,{</span><span class="s">&#39;massRateModels&#39;</span><span class="p">});</span><span class="w"></span>
<span class="w">      </span><span class="k">end</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>Note that, for <code class="xref py py-class docutils literal notranslate"><span class="pre">MassPropagator</span></code>, the mandatory properties are those of <code class="xref py py-class docutils literal notranslate"><span class="pre">Propagator</span></code>, from which it derives, i.e. <code class="docutils literal notranslate"><span class="pre">integratedStateType</span></code> and <code class="docutils literal notranslate"><span class="pre">bodiesToPropagate</span></code>, and also the property <code class="docutils literal notranslate"><span class="pre">massRateModels</span></code>. Thus, we get first the mandatory properties of the base class by calling <code class="docutils literal notranslate"><span class="pre">getMandatoryProperties&#64;Propagator(obj)</span></code>, and then add additional mandatory properties for the derived class.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">isPath(property)</span></code>: returns whether the property named <code class="docutils literal notranslate"><span class="pre">property</span></code> represents a path. Paths are automatically converted to JSON using the format specification <code class="docutils literal notranslate"><span class="pre">&#64;path(%s)</span></code>. By default, this returns <code class="docutils literal notranslate"><span class="pre">false</span></code>. Derived classes can override this method:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface/Body/Atmosphere/TabulatedAtmosphere.m</span></code></span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">classdef</span><span class="w"> </span><span class="n">TabulatedAtmosphere</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Atmosphere</span><span class="w"></span>
<span class="w">    </span><span class="k">properties</span><span class="w"></span>
<span class="w">        </span><span class="n">file</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="k">methods</span><span class="w"> </span><span class="p">(</span><span class="n">Hidden</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">function</span><span class="w"> </span>p<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">isPath</span><span class="p">(</span>obj,property<span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcmp</span><span class="p">(</span><span class="n">property</span><span class="p">,</span><span class="s">&#39;file&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">isempty</span></code>: overrides the implementation of the <code class="xref py py-class docutils literal notranslate"><span class="pre">handle</span></code> class, so that an instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">jsonable</span></code> will be empty if (an only if) all of its non-transient properties (i.e. the properties returned by <code class="docutils literal notranslate"><span class="pre">getProperties</span></code>) are empty. There is no need to override this method in derived classes of <code class="xref py py-class docutils literal notranslate"><span class="pre">jsonable</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jsonize</span></code>: returns an object that can be serialised as JSON-formatted text. Basically, it returns a struct containing the values for the non-transient properties (i.e. the properties returned by <code class="docutils literal notranslate"><span class="pre">getProperties</span></code>) that are non-empty. If an optional property has an empty value (e.g. <code class="docutils literal notranslate"><span class="pre">[]</span></code>), this field will not be defined in the returned struct. There is no need to provide a custom implementation of this method in derived classes; we only override this method if we want the JSON representation to include keys other than those associated to non-transient properties. This is done only once in the MATLAB interface in <code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface/Termination/Termination.m</span></code></p></li>
</ul>
</div>
<div class="section" id="other-types">
<h3>Other types<a class="headerlink" href="#other-types" title="Permalink to this headline">¶</a></h3>
<p>Some variables other than custom classes or enumerations are not serialisable either. For instance, complex numbers. These types have to be identified in the function <code class="docutils literal notranslate"><span class="pre">json.jsonize</span></code>, a custom implementation can be provided in this file:</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatlabInterface/+json/jsonize.m</span></code></span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>j<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">jsonize</span><span class="p">(</span>object<span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="k">try</span><span class="w"></span>
<span class="w">    </span><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">object</span><span class="p">.</span><span class="n">jsonize</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="k">catch</span><span class="w"> </span><span class="n">ME</span><span class="w"></span>
<span class="w">      </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="k">elseif</span><span class="w"> </span><span class="nb">strcmp</span><span class="p">(</span><span class="n">ME</span><span class="p">.</span><span class="n">identifier</span><span class="p">,</span><span class="s">&#39;MATLAB:structRefFromNonStruct&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="nb">isnumeric</span><span class="p">(</span><span class="n">object</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="nb">any</span><span class="p">(</span><span class="nb">imag</span><span class="p">(</span><span class="n">object</span><span class="p">(:)))</span><span class="w"></span>
<span class="w">                </span><span class="k">...</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>First, we try calling the <code class="docutils literal notranslate"><span class="pre">jsonize</span></code> method. If it is not defined, a <code class="docutils literal notranslate"><span class="pre">MATLAB:structRefFromNonStruct</span></code> error will be thrown. By catching this error, we can e.g. check whether the object is an imaginary number and provide a custom implementation for converting it to a value that is serialisable. For instance, the <a class="reference internal" href="../../tutorials/jsonInterface/index.html#jsoninterface"><span class="std std-ref">JSON Interface</span></a> uses <code class="docutils literal notranslate"><span class="pre">boost::literal_cast</span></code> to cast strings to <code class="xref py py-class docutils literal notranslate"><span class="pre">std::complex</span></code>, so we provide the required code so that <code class="docutils literal notranslate"><span class="pre">json.jsonize(0.5-4i)</span></code> returns the char <code class="docutils literal notranslate"><span class="pre">(0.5,-4)</span></code>, which is serialised as the string <code class="docutils literal notranslate"><span class="pre">&quot;(0.5,-4)&quot;</span></code>.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="addingFeatures.html" class="btn btn-neutral float-right" title="Adding features" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Extending the MATLAB Interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Delft University of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header .arrow").click(function() {
            $(this).closest('.toggle').children().not(".header").toggle(400);
            $(this).toggleClass("open");
            // $(this).html() == "More" ? $(this).html('Less') : $(this).html('More');
        });
        $(".showall").click(function() {
            $(".toggle > *").show(400);
            $(".toggle .header .arrow").addClass("open");
        });
        $(".hideall").click(function() {
            $(".toggle > *").hide(400);
            $(".toggle .header").show(400);
            $(".toggle .header .arrow").removeClass("open");
        });

        var nav_top_height = Math.round($(".wy-side-nav-search").outerHeight())+2;
        $(".wy-nav-content-wrap").prepend("<div id='announcement'><p>⚠️ This website is now mostly outdated! ⚠️</p><p>Please visit <a href='https://tudat-space.readthedocs.io/en/latest'>tudat-space.readthedocs.io</a> instead.</p></div>");
        $("#announcement").css("height", String(nav_top_height) + "px");
        $(".rst-content").css("margin-top", String(nav_top_height) + "px");
    });
</script>


</body>
</html>