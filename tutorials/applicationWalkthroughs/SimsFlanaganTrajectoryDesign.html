

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7. Sims-Flanagan Trajectory Optimisation &mdash; TU Delft Astrodynamic Toolbox  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="TU Delft Astrodynamic Toolbox  documentation" href="../../index.html"/>
        <link rel="up" title="Application Tutorials" href="index.html"/>
        <link rel="next" title="Tudat Libraries" href="../tudatFeatures/index.html"/>
        <link rel="prev" title="6. Shaping Methods Trajectory Optimisation" href="hodographicShapingTrajectoryOptimisation.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> TU Delft Astrodynamic Toolbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Start Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials and Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Application Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html#preparation">Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#tudat-example-application-tutorials">Tudat Example Application Tutorials</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html#pagmo-optimization-tutorials">Pagmo Optimization Tutorials</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="himmelblau.html">1. Himmelblau Optimization</a></li>
<li class="toctree-l4"><a class="reference internal" href="cecOptimization.html">2. CEC 2013 Optimizer Comparison</a></li>
<li class="toctree-l4"><a class="reference internal" href="earthMarsTrans.html">3. (multi-objective) Earth Mars Transfer</a></li>
<li class="toctree-l4"><a class="reference internal" href="mgaTrans.html">4. Multiple Gravity Assist Transfer</a></li>
<li class="toctree-l4"><a class="reference internal" href="propTargeting.html">5. Propagation Targeting</a></li>
<li class="toctree-l4"><a class="reference internal" href="hodographicShapingTrajectoryOptimisation.html">6. Shaping Methods Trajectory Optimisation</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">7. Sims-Flanagan Trajectory Optimisation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tudatFeatures/index.html">Tudat Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/index.html">Tudat Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jsonInterface/index.html">JSON Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../matlabInterface/index.html">MATLAB Interface</a></li>
<li class="toctree-l2"><a class="reference external" href="http://doxygen.tudat.tudelft.nl">Doxygen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developerGuide/index.html">Developer Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TU Delft Astrodynamic Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Tutorials and Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Application Tutorials</a> &raquo;</li>
        
      <li><span class="section-number">7. </span>Sims-Flanagan Trajectory Optimisation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/tutorials/applicationWalkthroughs/SimsFlanaganTrajectoryDesign.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sims-flanagan-trajectory-optimisation">
<span id="walkthroughssimsflanagantrajectoryoptimisation"></span><h1><span class="section-number">7. </span>Sims-Flanagan Trajectory Optimisation<a class="headerlink" href="#sims-flanagan-trajectory-optimisation" title="Permalink to this headline">¶</a></h1>
<p>This tutorial describes how to tackle an Earth-Mars trajectory design problem using first hodographic shaping to get a good preliminary design, and then a Sims-Flanagan method to optimise the transfer trajectory from this initial guess. The code for this tutorial is given on Github, and is also located in your Tudat bundle at:</p>
<blockquote>
<div><p>tudatBundle/tudatExampleApplications/libraryExamples/PaGMOEx/SimsFlanaganTrajectoryExample.cpp</p>
</div></blockquote>
<p>As described in the documentation dedicated to the Sims-Flanagan method (<a class="reference internal" href="../tudatFeatures/lowThrustTrajectoryDesign/SimsFlanagan.html#tudatfeaturessimsflanagan"><span class="std std-ref">Sims-Flanagan Method</span></a>), it is a direct method which turns the trajectory design problem into a parametrised optimisation problem. It is usually extremely difficult to reach convergence without having a good initial guess for the targeted trajectory. This is why, in this tutorial, a hodographically shaped trajectory is first computed and used as a starting point to run the Sims-Flanagan optimisation problem.</p>
<div class="section" id="set-up-the-trajectory-design-problem">
<h2><span class="section-number">7.1. </span>Set up the trajectory design problem<a class="headerlink" href="#set-up-the-trajectory-design-problem" title="Permalink to this headline">¶</a></h2>
<p>First, the characteristics of the targeted transfer trajectory are defined (departure date, time-of-flight, and number of revolutions are specified).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">julianDate</span> <span class="o">=</span> <span class="mf">9264.5</span> <span class="o">*</span> <span class="n">physical_constants</span><span class="o">::</span><span class="n">JULIAN_DAY</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">timeOfFlight</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">physical_constants</span><span class="o">::</span><span class="n">JULIAN_DAY</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">numberOfRevolutions</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1">// Ephemeris departure body.</span>
<span class="n">ephemerides</span><span class="o">::</span><span class="n">EphemerisPointer</span> <span class="n">pointerToDepartureBodyEphemeris</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">ephemerides</span><span class="o">::</span><span class="n">ApproximatePlanetPositions</span><span class="o">&gt;</span><span class="p">(</span>
            <span class="n">ephemerides</span><span class="o">::</span><span class="n">ApproximatePlanetPositionsBase</span><span class="o">::</span><span class="n">BodiesWithEphemerisData</span><span class="o">::</span><span class="n">earthMoonBarycenter</span> <span class="p">);</span>

<span class="c1">// Ephemeris arrival body.</span>
<span class="n">ephemerides</span><span class="o">::</span><span class="n">EphemerisPointer</span> <span class="n">pointerToArrivalBodyEphemeris</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">ephemerides</span><span class="o">::</span><span class="n">ApproximatePlanetPositions</span> <span class="o">&gt;</span><span class="p">(</span>
            <span class="n">ephemerides</span><span class="o">::</span><span class="n">ApproximatePlanetPositionsBase</span><span class="o">::</span><span class="n">BodiesWithEphemerisData</span><span class="o">::</span><span class="n">mars</span> <span class="p">);</span>

<span class="c1">// Retrieve cartesian state at departure and arrival.</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">Vector6d</span> <span class="n">cartesianStateDepartureBody</span> <span class="o">=</span> <span class="n">pointerToDepartureBodyEphemeris</span><span class="o">-&gt;</span><span class="n">getCartesianState</span><span class="p">(</span> <span class="n">julianDate</span> <span class="p">);</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">Vector6d</span> <span class="n">cartesianStateArrivalBody</span> <span class="o">=</span> <span class="n">pointerToArrivalBodyEphemeris</span><span class="o">-&gt;</span><span class="n">getCartesianState</span><span class="p">(</span> <span class="n">julianDate</span> <span class="o">+</span> <span class="n">timeOfFlight</span> <span class="p">);</span>
</pre></div>
</div>
<p>The parameters defining the Sims-Flanagan method are then introduced. This includes spacecraft-related parameters (initial mass, maximum allowable thrust magnitude, specific impulse), as well as the number of segments into which the trajectory is to be subdivided.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">maximumThrust</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">specificImpulse</span> <span class="o">=</span> <span class="mf">3000.0</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">mass</span> <span class="o">=</span> <span class="mf">2800.0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">numberSegments</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
</pre></div>
</div>
<p>The environment within which the trajectory is to be computed is defined similarly to what is done in the previous tutorials. The central body (Sun) is created using default settings and its position is fixed to the origin of the inertial reference frame. A vehicle body is also created, and the value of its initial mass is set up.</p>
</div>
<div class="section" id="computing-a-shape-based-preliminary-design">
<h2><span class="section-number">7.2. </span>Computing a shape-based preliminary design<a class="headerlink" href="#computing-a-shape-based-preliminary-design" title="Permalink to this headline">¶</a></h2>
<p>The lowest-order solution (no free parameter, see the previous tutorial for more details (<a class="reference internal" href="hodographicShapingTrajectoryOptimisation.html#walkthroughshodographicshapingoptimisation"><span class="std std-ref">Shaping Methods Trajectory Optimisation</span></a>)) of the Earth-Mars hodographically shaped transfer is computed. The base functions for the hodographic shaping are defined as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Get recommended base functions for the radial velocity composite function.</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">BaseFunctionHodographicShapingSettings</span> <span class="o">&gt;</span> <span class="n">firstRadialVelocityBaseFunctionSettings</span> <span class="o">=</span>
        <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">BaseFunctionHodographicShapingSettings</span> <span class="o">&gt;</span><span class="p">(</span> <span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">BaseFunctionHodographicShapingSettings</span> <span class="o">&gt;</span> <span class="n">secondRadialVelocityBaseFunctionSettings</span> <span class="o">=</span>
        <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">PowerFunctionHodographicShapingSettings</span> <span class="o">&gt;</span><span class="p">(</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">scaleFactor</span> <span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">BaseFunctionHodographicShapingSettings</span> <span class="o">&gt;</span> <span class="n">thirdRadialVelocityBaseFunctionSettings</span> <span class="o">=</span>
        <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">TrigonometricFunctionHodographicShapingSettings</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">frequency</span> <span class="p">);</span>

<span class="c1">// Create components of the radial velocity composite function.</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">BaseFunctionHodographicShaping</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">radialVelocityFunctionComponents</span><span class="p">;</span>
<span class="n">radialVelocityFunctionComponents</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="n">createBaseFunctionHodographicShaping</span><span class="p">(</span> <span class="n">constant</span><span class="p">,</span> <span class="n">firstRadialVelocityBaseFunctionSettings</span> <span class="p">)</span> <span class="p">);</span>
<span class="n">radialVelocityFunctionComponents</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="n">createBaseFunctionHodographicShaping</span><span class="p">(</span> <span class="n">scaledPower</span><span class="p">,</span> <span class="n">secondRadialVelocityBaseFunctionSettings</span> <span class="p">)</span> <span class="p">);</span>
<span class="n">radialVelocityFunctionComponents</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="n">createBaseFunctionHodographicShaping</span><span class="p">(</span> <span class="n">cosine</span><span class="p">,</span> <span class="n">thirdRadialVelocityBaseFunctionSettings</span> <span class="p">)</span> <span class="p">);</span>

<span class="c1">// Create base function settings for the components of the normal velocity composite function.</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">BaseFunctionHodographicShapingSettings</span> <span class="o">&gt;</span> <span class="n">firstNormalVelocityBaseFunctionSettings</span> <span class="o">=</span>
        <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">BaseFunctionHodographicShapingSettings</span> <span class="o">&gt;</span><span class="p">(</span> <span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">BaseFunctionHodographicShapingSettings</span> <span class="o">&gt;</span> <span class="n">secondNormalVelocityBaseFunctionSettings</span> <span class="o">=</span>
        <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">PowerFunctionHodographicShapingSettings</span> <span class="o">&gt;</span><span class="p">(</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">scaleFactor</span> <span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">BaseFunctionHodographicShapingSettings</span> <span class="o">&gt;</span> <span class="n">thirdNormalVelocityBaseFunctionSettings</span> <span class="o">=</span>
        <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">TrigonometricFunctionHodographicShapingSettings</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">frequency</span> <span class="p">);</span>

<span class="c1">// Get recommended base functions for normal velocity composition function.</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">shape_based_methods</span><span class="o">::</span><span class="n">BaseFunctionHodographicShaping</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">normalVelocityFunctionComponents</span><span class="p">;</span>
<span class="n">normalVelocityFunctionComponents</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="n">createBaseFunctionHodographicShaping</span><span class="p">(</span> <span class="n">constant</span><span class="p">,</span> <span class="n">firstNormalVelocityBaseFunctionSettings</span> <span class="p">)</span> <span class="p">);</span>
<span class="n">normalVelocityFunctionComponents</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="n">createBaseFunctionHodographicShaping</span><span class="p">(</span> <span class="n">scaledPower</span><span class="p">,</span> <span class="n">secondNormalVelocityBaseFunctionSettings</span> <span class="p">)</span> <span class="p">);</span>
<span class="n">normalVelocityFunctionComponents</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="n">createBaseFunctionHodographicShaping</span><span class="p">(</span> <span class="n">cosine</span><span class="p">,</span> <span class="n">thirdNormalVelocityBaseFunctionSettings</span> <span class="p">)</span> <span class="p">);</span>

<span class="c1">// Create base function settings for the components of the axial velocity composite function.</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">BaseFunctionHodographicShapingSettings</span> <span class="o">&gt;</span> <span class="n">firstAxialVelocityBaseFunctionSettings</span> <span class="o">=</span>
        <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">TrigonometricFunctionHodographicShapingSettings</span> <span class="o">&gt;</span><span class="p">(</span> <span class="p">(</span> <span class="n">numberOfRevolutions</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="p">)</span> <span class="o">*</span> <span class="n">frequency</span> <span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">BaseFunctionHodographicShapingSettings</span> <span class="o">&gt;</span> <span class="n">secondAxialVelocityBaseFunctionSettings</span> <span class="o">=</span>
        <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">PowerTimesTrigonometricFunctionHodographicShapingSettings</span> <span class="o">&gt;</span>
        <span class="p">(</span> <span class="mf">3.0</span><span class="p">,</span> <span class="p">(</span> <span class="n">numberOfRevolutions</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="p">)</span> <span class="o">*</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">scaleFactor</span> <span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">BaseFunctionHodographicShapingSettings</span> <span class="o">&gt;</span> <span class="n">thirdAxialVelocityBaseFunctionSettings</span> <span class="o">=</span>
        <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">PowerTimesTrigonometricFunctionHodographicShapingSettings</span> <span class="o">&gt;</span><span class="p">(</span>
            <span class="mf">3.0</span><span class="p">,</span> <span class="p">(</span> <span class="n">numberOfRevolutions</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="p">)</span> <span class="o">*</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">scaleFactor</span> <span class="p">);</span>

<span class="c1">// Get recommended base functions for axial velocity composition function.</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">shape_based_methods</span><span class="o">::</span><span class="n">BaseFunctionHodographicShaping</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">axialVelocityFunctionComponents</span><span class="p">;</span>
<span class="n">axialVelocityFunctionComponents</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="n">createBaseFunctionHodographicShaping</span><span class="p">(</span> <span class="n">cosine</span><span class="p">,</span> <span class="n">firstAxialVelocityBaseFunctionSettings</span> <span class="p">)</span> <span class="p">);</span>
<span class="n">axialVelocityFunctionComponents</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="n">createBaseFunctionHodographicShaping</span><span class="p">(</span> <span class="n">scaledPowerCosine</span><span class="p">,</span> <span class="n">secondAxialVelocityBaseFunctionSettings</span> <span class="p">)</span> <span class="p">);</span>
<span class="n">axialVelocityFunctionComponents</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="n">createBaseFunctionHodographicShaping</span><span class="p">(</span> <span class="n">scaledPowerSine</span><span class="p">,</span> <span class="n">thirdAxialVelocityBaseFunctionSettings</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>Once the shaped trajectory has been calculated, it is saved in a separate map, and so are the associated thrust, thrust acceleration, and mass profiles.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Save results</span>
<span class="kt">int</span> <span class="n">numberOfSteps</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">stepSize</span> <span class="o">=</span> <span class="n">timeOfFlight</span> <span class="o">/</span> <span class="k">static_cast</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">numberOfSteps</span> <span class="p">);</span>

<span class="c1">// Define specific impulse function.</span>
<span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">(</span> <span class="k">const</span> <span class="kt">double</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="n">specificImpulseFunction</span> <span class="o">=</span> <span class="p">[</span> <span class="o">=</span> <span class="p">](</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">time</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">specificImpulse</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Define integrator settings.</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">numerical_integrators</span><span class="o">::</span><span class="n">IntegratorSettings</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">integratorSettings</span> <span class="o">=</span>
        <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">numerical_integrators</span><span class="o">::</span><span class="n">IntegratorSettings</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">(</span> <span class="n">numerical_integrators</span><span class="o">::</span><span class="n">rungeKutta4</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">stepSize</span> <span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span> <span class="n">epochsToSaveResults</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">numberOfSteps</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">epochsToSaveResults</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">i</span> <span class="o">*</span> <span class="n">stepSize</span> <span class="p">);</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector6d</span> <span class="o">&gt;</span> <span class="n">hodographicShapingTrajectory</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="o">&gt;</span> <span class="n">hodographicShapingMassProfile</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="o">&gt;</span> <span class="n">hodographicShapingThrustProfile</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="o">&gt;</span> <span class="n">hodographicShapingThrustAcceleration</span><span class="p">;</span>
<span class="n">hodographicShaping</span><span class="o">-&gt;</span><span class="n">getTrajectory</span><span class="p">(</span> <span class="n">epochsToSaveResults</span><span class="p">,</span> <span class="n">hodographicShapingTrajectory</span> <span class="p">);</span>
<span class="n">hodographicShaping</span><span class="o">-&gt;</span><span class="n">getMassProfile</span><span class="p">(</span> <span class="n">epochsToSaveResults</span><span class="p">,</span> <span class="n">hodographicShapingMassProfile</span><span class="p">,</span> <span class="n">specificImpulseFunction</span><span class="p">,</span> <span class="n">integratorSettings</span> <span class="p">);</span>
<span class="n">hodographicShaping</span><span class="o">-&gt;</span><span class="n">getThrustProfile</span><span class="p">(</span> <span class="n">epochsToSaveResults</span><span class="p">,</span> <span class="n">hodographicShapingThrustProfile</span><span class="p">,</span> <span class="n">specificImpulseFunction</span><span class="p">,</span> <span class="n">integratorSettings</span> <span class="p">);</span>
<span class="n">hodographicShaping</span><span class="o">-&gt;</span><span class="n">getThrustAccelerationProfile</span><span class="p">(</span> <span class="n">epochsToSaveResults</span><span class="p">,</span> <span class="n">hodographicShapingThrustAcceleration</span><span class="p">,</span> <span class="n">specificImpulseFunction</span><span class="p">,</span> <span class="n">integratorSettings</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-a-sims-flanagan-optimisation-problem">
<h2><span class="section-number">7.3. </span>Setting up a Sims-Flanagan optimisation problem<a class="headerlink" href="#setting-up-a-sims-flanagan-optimisation-problem" title="Permalink to this headline">¶</a></h2>
<p>The Sims-Flanagan problem consists of a parametrised optimisation problem with thrust throttles as design parameters. The use of a shaped trajectory as an initial guess for Sims-Flanagan requires the derivation of a set of thrust throttles (one for each segment of the trajectory) from the thrust profile delivered by the shaping method. The function <code class="docutils literal notranslate"><span class="pre">getInitialGuessFunctionFromShaping</span></code>, which approximates the shaped thrust profile by a set of constant thrust segments (constant in both magnitude and direction) is used to this end (see <code class="docutils literal notranslate"><span class="pre">tudatFeaturesSimsFlanaganInitialGuessFromShaping</span></code> for more details).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">ShapeBasedMethodLeg</span> <span class="o">&gt;</span> <span class="n">shapeBasedLeg</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">dynamic_pointer_cast</span><span class="o">&lt;</span> <span class="n">ShapeBasedMethodLeg</span> <span class="o">&gt;</span><span class="p">(</span> <span class="n">hodographicShaping</span> <span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span><span class="p">(</span> <span class="k">const</span> <span class="kt">double</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="n">initialGuessThrustFromShaping</span> <span class="o">=</span>
        <span class="n">getInitialGuessFunctionFromShaping</span><span class="p">(</span> <span class="n">shapeBasedLeg</span><span class="p">,</span> <span class="n">numberSegments</span><span class="p">,</span> <span class="n">timeOfFlight</span><span class="p">,</span> <span class="n">specificImpulseFunction</span><span class="p">,</span> <span class="n">integratorSettings</span> <span class="p">);</span>
</pre></div>
</div>
<p>The Sims-Flanagan initial guess, obtained as an approximation of the shaped trajectory, is saved in a separate map. Not only the approximate thrust profile, but also the corresponding thrust acceleration and mass profiles are saved.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span> <span class="o">&gt;</span> <span class="n">initialGuessThrustProfile</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span> <span class="o">&gt;</span> <span class="n">initialGuessThrustAccelerationProfile</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector1d</span> <span class="o">&gt;</span> <span class="n">initialGuessMassProfile</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">epochsToSaveResults</span><span class="p">.</span><span class="n">size</span><span class="p">(</span> <span class="p">)</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="n">epochsToSaveResults</span><span class="p">[</span> <span class="n">i</span> <span class="p">];</span>
    <span class="n">initialGuessThrustProfile</span><span class="p">[</span> <span class="n">currentTime</span> <span class="p">]</span> <span class="o">=</span>  <span class="n">initialGuessThrustFromShaping</span><span class="p">(</span> <span class="n">currentTime</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">initialGuessMassProfile</span><span class="p">[</span> <span class="n">currentTime</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector1d</span><span class="p">(</span> <span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">mass</span> <span class="p">).</span><span class="n">finished</span><span class="p">(</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">initialGuessMassProfile</span><span class="p">[</span> <span class="n">currentTime</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector1d</span><span class="p">(</span> <span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">initialGuessMassProfile</span><span class="p">[</span> <span class="n">epochsToSaveResults</span><span class="p">[</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">]</span>
                <span class="o">-</span> <span class="n">initialGuessThrustProfile</span><span class="p">[</span> <span class="n">currentTime</span> <span class="p">].</span><span class="n">norm</span><span class="p">(</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">specificImpulse</span> <span class="o">*</span> <span class="n">physical_constants</span><span class="o">::</span><span class="n">SEA_LEVEL_GRAVITATIONAL_ACCELERATION</span> <span class="p">)</span> <span class="o">*</span> <span class="n">stepSize</span> <span class="p">).</span><span class="n">finished</span><span class="p">(</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="n">initialGuessThrustAccelerationProfile</span><span class="p">[</span> <span class="n">currentTime</span> <span class="p">]</span> <span class="o">=</span> <span class="n">initialGuessThrustProfile</span><span class="p">[</span> <span class="n">currentTime</span> <span class="p">]</span> <span class="o">/</span> <span class="n">initialGuessMassProfile</span><span class="p">[</span> <span class="n">currentTime</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">];</span>

<span class="p">}</span>
</pre></div>
</div>
<p>An <code class="docutils literal notranslate"><span class="pre">OptimisationSettings</span></code> object can then be defined from this thrust profile initial guess, allowing the algorithm to look for the optimum in a parameter space delimited by 30% lower and upper margins around the initial guess solution.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Define optimisation algorithm.</span>
<span class="n">algorithm</span> <span class="n">optimisationAlgorithm</span><span class="p">{</span> <span class="n">pagmo</span><span class="o">::</span><span class="n">de1220</span><span class="p">()</span> <span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">OptimisationSettings</span> <span class="o">&gt;</span> <span class="n">optimisationSettings</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">OptimisationSettings</span> <span class="o">&gt;</span><span class="p">(</span>
            <span class="n">optimisationAlgorithm</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mf">1.0e-6</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span> <span class="n">initialGuessThrustFromShaping</span><span class="p">,</span> <span class="mf">0.3</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">SimsFlanagan</span></code> object is finally created, and the corresponding trajctory, thrust,  thrust acceleration, and mass profiles are saved:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">SimsFlanagan</span> <span class="n">simsFlanagan</span> <span class="o">=</span> <span class="n">SimsFlanagan</span><span class="p">(</span> <span class="n">cartesianStateDepartureBody</span><span class="p">,</span> <span class="n">cartesianStateArrivalBody</span><span class="p">,</span> <span class="n">maximumThrust</span><span class="p">,</span> <span class="n">specificImpulseFunction</span><span class="p">,</span> <span class="n">numberSegments</span><span class="p">,</span>
                                          <span class="n">timeOfFlight</span><span class="p">,</span> <span class="n">bodyMap</span><span class="p">,</span> <span class="n">bodyToPropagate</span><span class="p">,</span> <span class="n">centralBody</span><span class="p">,</span> <span class="n">optimisationSettings</span> <span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">Vector6d</span> <span class="o">&gt;</span> <span class="n">SimsFlanaganTrajectory</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="o">&gt;</span> <span class="n">SimsFlanaganMassProfile</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="o">&gt;</span> <span class="n">SimsFlanaganThrustProfile</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="o">&gt;</span> <span class="n">SimsFlanaganThrustAcceleration</span><span class="p">;</span>
<span class="n">simsFlanagan</span><span class="p">.</span><span class="n">getTrajectory</span><span class="p">(</span> <span class="n">epochsToSaveResults</span><span class="p">,</span> <span class="n">SimsFlanaganTrajectory</span> <span class="p">);</span>
<span class="n">simsFlanagan</span><span class="p">.</span><span class="n">getMassProfile</span><span class="p">(</span> <span class="n">epochsToSaveResults</span><span class="p">,</span> <span class="n">SimsFlanaganMassProfile</span><span class="p">,</span> <span class="n">specificImpulseFunction</span><span class="p">,</span> <span class="n">integratorSettings</span> <span class="p">);</span>
<span class="n">simsFlanagan</span><span class="p">.</span><span class="n">getThrustProfile</span><span class="p">(</span> <span class="n">epochsToSaveResults</span><span class="p">,</span> <span class="n">SimsFlanaganThrustProfile</span><span class="p">,</span> <span class="n">specificImpulseFunction</span><span class="p">,</span> <span class="n">integratorSettings</span> <span class="p">);</span>
<span class="n">simsFlanagan</span><span class="p">.</span><span class="n">getThrustAccelerationProfile</span><span class="p">(</span> <span class="n">epochsToSaveResults</span><span class="p">,</span> <span class="n">SimsFlanaganThrustAcceleration</span><span class="p">,</span> <span class="n">specificImpulseFunction</span><span class="p">,</span> <span class="n">integratorSettings</span>
</pre></div>
</div>
</div>
<div class="section" id="results">
<h2><span class="section-number">7.4. </span>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<p>The output of the application should look as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>Starting ... \tudatBundle\tudatExampleApplications\libraryExamples\bin\applications\application_PagmoSimsFlanaganTrajectoryExample.exe...

DELTAV SIMS FLANAGAN: 71571.1

DELTAV SHAPE BASED: 73112

/tudatBundle/tudatExampleApplications/libraryExamples/bin/applications/application_PagmoSimsFlanaganTrajectoryExample.exe exited with code 0
</pre></div>
</div>
<p>The comparison between the hodographically shaped trajectory and the Sims-Flanagan results is provided in the plot below. The upper plots present the shaped trajectory design (and corresponding thrust, thrust acceleration, and mass profiles), along with the approximate Sims-Flanagan initial guess derived from that the shaping method results. The middle plots represent the Sims-Flanagan results, obtained from that initial guess (they are superimposed with the shaping results). Finally, the bottom plots directly show the difference between hodographic shaping and Sims-Flanagan results.</p>
<div class="figure align-default">
<img alt="../../_images/SimsFlanaganResults.png" src="../../_images/SimsFlanaganResults.png" />
</div>
<p>The final mass of the spacecraft obtained with Sims-Flanagan is lower than that of the shape-based trajectory (the difference between the two is negative). This is consistent with the slightly lower deltaV of the Sims-Flanagan trajectory solution.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tudatFeatures/index.html" class="btn btn-neutral float-right" title="Tudat Libraries" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="hodographicShapingTrajectoryOptimisation.html" class="btn btn-neutral" title="6. Shaping Methods Trajectory Optimisation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Delft University of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header .arrow").click(function() {
            $(this).closest('.toggle').children().not(".header").toggle(400);
            $(this).toggleClass("open");
            // $(this).html() == "More" ? $(this).html('Less') : $(this).html('More');
        });
        $(".showall").click(function() {
            $(".toggle > *").show(400);
            $(".toggle .header .arrow").addClass("open");
        });
        $(".hideall").click(function() {
            $(".toggle > *").hide(400);
            $(".toggle .header").show(400);
            $(".toggle .header .arrow").removeClass("open");
        });
    });
</script>


</body>
</html>