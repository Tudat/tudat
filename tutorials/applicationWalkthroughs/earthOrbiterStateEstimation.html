

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>12. Orbit Determination and Parameter Estimation &mdash; TU Delft Astrodynamic Toolbox  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="TU Delft Astrodynamic Toolbox  documentation" href="../../index.html"/>
        <link rel="up" title="Application Tutorials" href="index.html"/>
        <link rel="next" title="13. MGA Trajectory Design" href="interplanetaryTrajectory.html"/>
        <link rel="prev" title="11. Orbit Determination and Parameter Estimation (Basic)" href="earthOrbiterBasicStateEstimation.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> TU Delft Astrodynamic Toolbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Start Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials and Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Application Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html#preparation">Preparation</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html#tudat-example-application-tutorials">Tudat Example Application Tutorials</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="unperturbedEarthOrbitingSatellite.html">1. Unperturbed Earth-orbiting Satellite</a></li>
<li class="toctree-l4"><a class="reference internal" href="perturbedEarthOrbitingSatellite.html">2. Perturbed Earth-orbiting Satellite</a></li>
<li class="toctree-l4"><a class="reference internal" href="unguidedCapsuleEntry.html">3. Un-guided Capsule Entry</a></li>
<li class="toctree-l4"><a class="reference internal" href="innerSolarSystemPropagation.html">4. Inner Solar System Propagation</a></li>
<li class="toctree-l4"><a class="reference internal" href="useOfThrustThrustForceAlongVelocityVector.html">5. Use of Thrust: Thrust Force Along Velocity Vector</a></li>
<li class="toctree-l4"><a class="reference internal" href="useOfThrustUserDefinedThrustVector.html">6. Use of Thrust: User-defined Thrust Vector</a></li>
<li class="toctree-l4"><a class="reference internal" href="tabulatedAtmosphereExamples.html">7. Tabulated Atmosphere Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="propagatorTypesComparison.html">8. Comparison of Propagator Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="filterExample.html">9. Kalman Filter for State Estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="variationalEquationsPropagation.html">10. Variational Equations Propagation</a></li>
<li class="toctree-l4"><a class="reference internal" href="earthOrbiterBasicStateEstimation.html">11. Orbit Determination and Parameter Estimation (Basic)</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">12. Orbit Determination and Parameter Estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="interplanetaryTrajectory.html">13. MGA Trajectory Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="fullPropagationCR3BP.html">14. Full propagation of the CR3BP</a></li>
<li class="toctree-l4"><a class="reference internal" href="fullPropagationPatchedConicsTrajectory.html">15. Full propagation of a patched conics trajectory</a></li>
<li class="toctree-l4"><a class="reference internal" href="shapeBasedTrajectory.html">16. Shape-Based Low-Thrust Trajectories</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#pagmo-optimization-tutorials">Pagmo Optimization Tutorials</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tudatFeatures/index.html">Tudat Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/index.html">Tudat Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jsonInterface/index.html">JSON Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../matlabInterface/index.html">MATLAB Interface</a></li>
<li class="toctree-l2"><a class="reference external" href="http://doxygen.tudat.tudelft.nl">Doxygen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developerGuide/index.html">Developer Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TU Delft Astrodynamic Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Tutorials and Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Application Tutorials</a> &raquo;</li>
        
      <li><span class="section-number">12. </span>Orbit Determination and Parameter Estimation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/tutorials/applicationWalkthroughs/earthOrbiterStateEstimation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="orbit-determination-and-parameter-estimation">
<span id="earthorbiterstateestimation"></span><h1><span class="section-number">12. </span>Orbit Determination and Parameter Estimation<a class="headerlink" href="#orbit-determination-and-parameter-estimation" title="Permalink to this headline">Â¶</a></h1>
<p>In the previous tutorial (see <a class="reference internal" href="earthOrbiterBasicStateEstimation.html#earthorbiterbasicstateestimation"><span class="std std-ref">Orbit Determination and Parameter Estimation (Basic)</span></a>) we introduced the basic features of orbit determination, including simulating observables, defining parameters and performing the estimation. However, various features were not discussed, and a number of assumption were unrealistic. In this tutorial, we discuss a more comprehensive example of orbit determination.</p>
<p>The code for this tutorial is given on Github, and is also located in your Tudat bundle at:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tudatBundle</span><span class="o">/</span><span class="n">tudatExampleApplications</span><span class="o">/</span><span class="n">satellitePropagatorExamples</span><span class="o">/</span><span class="n">SatellitePropagatorExamples</span><span class="o">/</span><span class="n">earthOrbiterStateEstimation</span><span class="o">.</span><span class="n">cpp</span>
</pre></div>
</div>
<p>As you can see in the code, setting up the environment is done in a similar manner as the previous tutorial. One difference is introduced: the simulation now runs over 30 days instead of 3. For the acceleration models, we make two additions compared to the previous tutorial: a relativistic acceleration correction, and an empirical acceleration. Both are added because we want to estimate properties of these acceleration models in this example.</p>
<p>Since we want to make this tutorial more realistic than the previous one, we now propagate and estimate the state of the spacecraft over multiple arcs. We take a length of 3 days for each of them, using the same set of acceleration models, and the same numerical integration settings, for each arc. We need the following extra information, compared to the single arc case:</p>
<blockquote>
<div><ul class="simple">
<li><p>A list of initial times for the arcs</p></li>
<li><p>A list of propagator settings for the arcs</p></li>
</ul>
</div></blockquote>
<p>This is performed by the code below, where we use an arc length of just over 3 days.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Define arc length</span>
<span class="kt">double</span><span class="w"> </span><span class="n">arcDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.01</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">86400.0</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">arcOverlap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3600.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Create propagator settings (including initial state taken from Kepler orbit) for each arc</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="w"> </span><span class="n">SingleArcPropagatorSettings</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">propagatorSettingsList</span><span class="p">;</span><span class="w"></span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">arcStartTimes</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">currentTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initialEphemerisTime</span><span class="p">;</span><span class="w"></span>
<span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">currentTime</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">finalEphemerisTime</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">arcStartTimes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">currentTime</span><span class="w"> </span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector6d</span><span class="w"> </span><span class="n">currentArcInitialState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">convertKeplerianToCartesianElements</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="n">propagateKeplerOrbit</span><span class="p">(</span><span class="w"> </span><span class="n">vehicleInitialKeplerianState</span><span class="p">,</span><span class="w"> </span><span class="n">currentTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">initialEphemerisTime</span><span class="p">,</span><span class="w"></span>
<span class="w">                                      </span><span class="n">earthGravitationalParameter</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">earthGravitationalParameter</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">propagatorSettingsList</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">TranslationalStatePropagatorSettings</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">                                          </span><span class="n">centralBodies</span><span class="p">,</span><span class="w"> </span><span class="n">accelerationModelMap</span><span class="p">,</span><span class="w"> </span><span class="n">bodiesToIntegrate</span><span class="p">,</span><span class="w"> </span><span class="n">currentArcInitialState</span><span class="p">,</span><span class="w"></span>
<span class="w">                                          </span><span class="n">currentTime</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">arcDuration</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">arcOverlap</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">currentTime</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">arcDuration</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>where we have set an arc-overlap of 1 hour. The propagator settings for the multi-arc propagation are now created as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create propagator settings</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="w"> </span><span class="n">PropagatorSettings</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">propagatorSettings</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">MultiArcPropagatorSettings</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">propagatorSettingsList</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>We use the same link ends/observable types as in the previous example. However, we extend our list of estimated parameters to:</p>
<blockquote>
<div><ul class="simple">
<li><p>The spacecraft initial states <span class="math notranslate nohighlight">\(x(t_{j})\)</span> for 10 arcs, with <span class="math notranslate nohighlight">\(j=\left[1,\ldots,10\right]\)</span>, <span class="math notranslate nohighlight">\(t_{j+1}-t_{j}\)</span> = 3 days.</p></li>
<li><p>Parameteric Post-Newtonian (PPN) parameter <span class="math notranslate nohighlight">\(\gamma\)</span>. Parameter equals 1 in general relativity.</p></li>
<li><p>A constant radiation pressure coefficient <span class="math notranslate nohighlight">\(C_{r}\)</span> of the spacecraft (assuming a cannonball radiation pressure model).</p></li>
<li><p>A constant aerodynamic drag coefficient <span class="math notranslate nohighlight">\(C_{D}\)</span> of the spacecraft.</p></li>
<li><p>Constant Earth rotation rate <span class="math notranslate nohighlight">\(\omega_{E}\)</span>.</p></li>
<li><p>Pole position of Earth rotation axis, parameterized by its right ascension and declination <span class="math notranslate nohighlight">\(\alpha_{E}\)</span> and <span class="math notranslate nohighlight">\(\delta_{E}\)</span>.</p></li>
<li><p>Earth-fixed position of ground stations <code class="docutils literal notranslate"><span class="pre">&quot;Station1&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;Station2&quot;</span></code>, namely <span class="math notranslate nohighlight">\(\mathbf{x}_{GS,1}^{(E)}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{x}_{GS,2}^{(E)}\)</span>.</p></li>
<li><p>Absolute observation bias <span class="math notranslate nohighlight">\(K_{a}\)</span> for the first two links used for one-way range.</p></li>
<li><p>Spherical harmonic cosine coefficients <span class="math notranslate nohighlight">\(C_{lm}\)</span> at degree <span class="math notranslate nohighlight">\(l=\left[2,\ldots,8\right]\)</span> and orders <span class="math notranslate nohighlight">\(m=\left[0,\ldots,l\right]\)</span>.</p></li>
<li><p>Spherical harmonic cosine coefficients <span class="math notranslate nohighlight">\(S_{lm}\)</span> at degree <span class="math notranslate nohighlight">\(l=\left[2,\ldots,8\right]\)</span> and orders <span class="math notranslate nohighlight">\(m=\left[1,\ldots,l\right]\)</span>.</p></li>
<li><p>Empirical accelerations in along- and across-track directions (both sine and cosine of true anomaly components), estimated in a multi-arc fashion, using 2 arcs over the full simulation period.</p></li>
</ul>
</div></blockquote>
<p>which is achieved with the following block of code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Define list of parameters to estimate.</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="w"> </span><span class="n">EstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameterNames</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Create concatenated list of arc initial states</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="w"> </span><span class="n">systemInitialState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="p">(</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">arcStartTimes</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">arcStartTimes</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">systemInitialState</span><span class="p">.</span><span class="n">segment</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">propagatorSettingsList</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="o">-&gt;</span><span class="n">getInitialStates</span><span class="p">(</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">ArcWiseInitialTranslationalStateEstimatableParameterSettings</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">                              </span><span class="s">&quot;Vehicle&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">systemInitialState</span><span class="p">,</span><span class="w"> </span><span class="n">arcStartTimes</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Earth&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">EstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;global_metric&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ppn_parameter_gamma</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">EstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Vehicle&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">radiation_pressure_coefficient</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">EstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Vehicle&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">constant_drag_coefficient</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">EstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Earth&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">constant_rotation_rate</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">EstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Earth&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">rotation_pole_position</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">EstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Earth&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ground_station_position</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Station1&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">EstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Earth&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ground_station_position</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Station2&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">ConstantObservationBiasEstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">                              </span><span class="n">linkEndsPerObservable</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="w"> </span><span class="n">one_way_range</span><span class="w"> </span><span class="p">).</span><span class="n">at</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">one_way_range</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">ConstantObservationBiasEstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">                              </span><span class="n">linkEndsPerObservable</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="w"> </span><span class="n">one_way_range</span><span class="w"> </span><span class="p">).</span><span class="n">at</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">one_way_range</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">SphericalHarmonicEstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">                              </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Earth&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">spherical_harmonics_cosine_coefficient_block</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">SphericalHarmonicEstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">                              </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Earth&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">spherical_harmonics_sine_coefficient_block</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>

<span class="c1">// Define required settings for arc-wise empirical accelerations</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="w"> </span><span class="n">EmpiricalAccelerationComponents</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">EmpiricalAccelerationFunctionalShapes</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">empiricalAccelerationComponents</span><span class="p">;</span><span class="w"></span>
<span class="n">empiricalAccelerationComponents</span><span class="p">[</span><span class="w"> </span><span class="n">across_track_empirical_acceleration_component</span><span class="w"> </span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">cosine_empirical</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">empiricalAccelerationComponents</span><span class="p">[</span><span class="w"> </span><span class="n">across_track_empirical_acceleration_component</span><span class="w"> </span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">sine_empirical</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">empiricalAccelerationComponents</span><span class="p">[</span><span class="w"> </span><span class="n">along_track_empirical_acceleration_component</span><span class="w"> </span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">cosine_empirical</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">empiricalAccelerationComponents</span><span class="p">[</span><span class="w"> </span><span class="n">along_track_empirical_acceleration_component</span><span class="w"> </span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">sine_empirical</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">empiricalAccelerationArcTimes</span><span class="p">;</span><span class="w"></span>
<span class="n">empiricalAccelerationArcTimes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">initialEphemerisTime</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">empiricalAccelerationArcTimes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">initialEphemerisTime</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">finalEphemerisTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">initialEphemerisTime</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">ArcWiseEmpiricalAccelerationEstimatableParameterSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">                              </span><span class="s">&quot;Vehicle&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Earth&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">empiricalAccelerationComponents</span><span class="p">,</span><span class="w"> </span><span class="n">empiricalAccelerationArcTimes</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>

<span class="c1">// Create parameters</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="w"> </span><span class="n">estimatable_parameters</span><span class="o">::</span><span class="n">EstimatableParameterSet</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">parametersToEstimate</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">createParametersToEstimate</span><span class="p">(</span><span class="w"> </span><span class="n">parameterNames</span><span class="p">,</span><span class="w"> </span><span class="n">bodyMap</span><span class="p">,</span><span class="w"> </span><span class="n">accelerationModelMap</span><span class="w"> </span><span class="p">);</span><span class="w"></span>

<span class="c1">// Print identifiers and indices of parameters to terminal.</span>
<span class="n">printEstimatableParameterEntries</span><span class="p">(</span><span class="w"> </span><span class="n">parametersToEstimate</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>This list is clearly much more comprehensive than the set of parameters in the previous tutorials. The output becomes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Parameter</span> <span class="n">start</span> <span class="n">index</span><span class="p">,</span> <span class="n">Parameter</span> <span class="n">definition</span>
<span class="mi">0</span><span class="p">,</span> <span class="n">arc</span><span class="o">-</span><span class="n">wise</span> <span class="n">translational</span> <span class="n">state</span> <span class="n">of</span> <span class="p">(</span><span class="n">Vehicle</span><span class="p">)</span><span class="o">.</span>
<span class="mi">60</span><span class="p">,</span> <span class="n">PPN</span> <span class="n">parameter</span> <span class="n">gamma</span> <span class="n">of</span> <span class="p">(</span><span class="n">global_metric</span><span class="p">)</span><span class="o">.</span>
<span class="mi">61</span><span class="p">,</span> <span class="n">radiation</span> <span class="n">pressure</span> <span class="n">coefficient</span> <span class="n">of</span> <span class="p">(</span><span class="n">Vehicle</span><span class="p">)</span><span class="o">.</span>
<span class="mi">62</span><span class="p">,</span> <span class="n">constant</span> <span class="n">drag</span> <span class="n">coefficient</span> <span class="n">of</span> <span class="p">(</span><span class="n">Vehicle</span><span class="p">)</span><span class="o">.</span>
<span class="mi">63</span><span class="p">,</span> <span class="n">constant</span> <span class="n">rotation</span> <span class="n">rate</span> <span class="n">of</span> <span class="p">(</span><span class="n">Earth</span><span class="p">)</span><span class="o">.</span>
<span class="mi">64</span><span class="p">,</span> <span class="n">pole</span> <span class="n">position</span> <span class="n">of</span> <span class="p">(</span><span class="n">Earth</span><span class="p">)</span><span class="o">.</span>
<span class="mi">66</span><span class="p">,</span> <span class="n">ground</span> <span class="n">station</span> <span class="n">position</span> <span class="n">of</span> <span class="p">(</span><span class="n">Earth</span><span class="p">,</span> <span class="n">Station1</span><span class="p">)</span><span class="o">.</span>
<span class="mi">69</span><span class="p">,</span> <span class="n">ground</span> <span class="n">station</span> <span class="n">position</span> <span class="n">of</span> <span class="p">(</span><span class="n">Earth</span><span class="p">,</span> <span class="n">Station2</span><span class="p">)</span><span class="o">.</span>
<span class="mi">72</span><span class="p">,</span> <span class="n">absolute</span> <span class="n">observation</span> <span class="n">bias</span> <span class="k">for</span> <span class="n">observable</span><span class="p">:</span> <span class="p">(</span><span class="n">OneWayRange</span><span class="p">)</span> <span class="ow">and</span> <span class="n">link</span> <span class="n">ends</span><span class="p">:</span> <span class="p">(</span><span class="n">transmitter</span><span class="p">:</span> <span class="p">(</span><span class="n">Vehicle</span><span class="p">);</span> <span class="n">receiver</span><span class="p">:</span> <span class="p">(</span><span class="n">Earth</span><span class="p">,</span> <span class="n">Station1</span><span class="p">))</span>
<span class="mi">73</span><span class="p">,</span> <span class="n">absolute</span> <span class="n">observation</span> <span class="n">bias</span> <span class="k">for</span> <span class="n">observable</span><span class="p">:</span> <span class="p">(</span><span class="n">OneWayRange</span><span class="p">)</span> <span class="ow">and</span> <span class="n">link</span> <span class="n">ends</span><span class="p">:</span> <span class="p">(</span><span class="n">transmitter</span><span class="p">:</span> <span class="p">(</span><span class="n">Earth</span><span class="p">,</span> <span class="n">Station1</span><span class="p">);</span> <span class="n">receiver</span><span class="p">:</span> <span class="p">(</span><span class="n">Vehicle</span><span class="p">))</span>
<span class="mi">74</span><span class="p">,</span> <span class="n">cosine</span> <span class="n">spherical</span> <span class="n">harmonic</span> <span class="n">coefficient</span> <span class="n">block</span> <span class="n">of</span> <span class="p">(</span><span class="n">Earth</span><span class="p">),</span> <span class="n">Minimum</span> <span class="n">D</span><span class="o">/</span><span class="n">O</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Maximum</span> <span class="n">D</span><span class="o">/</span><span class="n">O</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span>
<span class="mi">116</span><span class="p">,</span> <span class="n">sine</span> <span class="n">spherical</span> <span class="n">harmonic</span> <span class="n">coefficient</span> <span class="n">block</span> <span class="n">of</span> <span class="p">(</span><span class="n">Earth</span><span class="p">),</span> <span class="n">Minimum</span> <span class="n">D</span><span class="o">/</span><span class="n">O</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Maximum</span> <span class="n">D</span><span class="o">/</span><span class="n">O</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span>
<span class="mi">151</span><span class="p">,</span>  <span class="n">arc</span><span class="o">-</span><span class="n">wise</span> <span class="n">empirical</span> <span class="n">acceleration</span> <span class="n">coefficients</span> <span class="n">of</span> <span class="p">(</span><span class="n">Vehicle</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<p>You may notice that two parameters stand out in this list: the observation biases. In fact, the objects to which these parameters are linked in the simulation (the <code class="xref py py-class docutils literal notranslate"><span class="pre">ObservationBias</span></code> objects) are not yet created. These objects are only created when the observation models are set up, which is performed when creating the <a class="reference internal" href="../tudatFeatures/estimationSetup/estimationExecution.html#OrbitDeterminationManager" title="OrbitDeterminationManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrbitDeterminationManager</span></code></a> object. Until this time, the <a class="reference internal" href="../tudatFeatures/estimationSetup/parameterEstimationSettings.html#EstimatableParameterSet" title="EstimatableParameterSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">EstimatableParameterSet</span></code></a> object exists in a state where it is not fully defined, and its member functions (get/set parameter values) should not be used.</p>
<p>Since we now want to estimate observation biases for the range observables, these models should be endowed with a bias model when creating them (<a class="reference internal" href="../tudatFeatures/estimationSetup/observationModelSetup.html#observationbiases"><span class="std std-ref">Observation Biases</span></a>). This is achieved by the following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Iterate over all observable types and associated link ends, and creating settings for observation</span>
<span class="n">observation_models</span><span class="o">::</span><span class="n">ObservationSettingsMap</span><span class="w"> </span><span class="n">observationSettingsMap</span><span class="p">;</span><span class="w"></span>
<span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="w"> </span><span class="n">ObservableType</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">LinkEnds</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;::</span><span class="n">iterator</span><span class="w"> </span><span class="n">linkEndIterator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linkEndsPerObservable</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">     </span><span class="n">linkEndIterator</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">linkEndsPerObservable</span><span class="p">.</span><span class="n">end</span><span class="p">(</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="n">linkEndIterator</span><span class="o">++</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">ObservableType</span><span class="w"> </span><span class="n">currentObservable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linkEndIterator</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">LinkEnds</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">currentLinkEndsList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linkEndIterator</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">currentLinkEndsList</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Define bias and light-time correction settings</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="w"> </span><span class="n">ObservationBiasSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">biasSettings</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="w"> </span><span class="n">LightTimeCorrectionSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">lightTimeCorrections</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">currentObservable</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">one_way_range</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">biasSettings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">ConstantObservationBiasSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">                        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector1d</span><span class="o">::</span><span class="n">Zero</span><span class="p">(</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Define settings for observable, no light-time corrections, and biases for selected links</span>
<span class="w">        </span><span class="n">observationSettingsMap</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="w"></span>
<span class="w">                    </span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="w"> </span><span class="n">currentLinkEndsList</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">),</span><span class="w"></span>
<span class="w">                                    </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">ObservationSettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">                                        </span><span class="n">currentObservable</span><span class="p">,</span><span class="w"> </span><span class="n">lightTimeCorrections</span><span class="p">,</span><span class="w"> </span><span class="n">biasSettings</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>which is similar to the previous tutorial, but now includes the definition of a <a class="reference internal" href="../tudatFeatures/estimationSetup/observationModelSetup.html#ConstantObservationBiasSettings" title="ConstantObservationBiasSettings"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConstantObservationBiasSettings</span></code></a> for the one-way range model.</p>
<p>Creating the <a class="reference internal" href="../tudatFeatures/estimationSetup/estimationExecution.html#OrbitDeterminationManager" title="OrbitDeterminationManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrbitDeterminationManager</span></code></a> object and the <code class="docutils literal notranslate"><span class="pre">measurementSimulationInput</span></code> observation simulation settings happens as before. However, when actually generating the observations, we now want to add a crucial check: visibility from the ground station. To do this, we create an object of type <a class="reference internal" href="../tudatFeatures/estimationSetup/observationSimulation.html#ObservationViabilitySettings" title="ObservationViabilitySettings"><code class="xref py py-class docutils literal notranslate"><span class="pre">ObservationViabilitySettings</span></code></a>, as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create observation viability settings and calculators</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="w"> </span><span class="n">ObservationViabilitySettings</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">observationViabilitySettings</span><span class="p">;</span><span class="w"></span>
<span class="n">observationViabilitySettings</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="w"> </span><span class="n">ObservationViabilitySettings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">                                            </span><span class="n">minimum_elevation_angle</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Earth&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                                            </span><span class="n">unit_conversions</span><span class="o">::</span><span class="n">convertDegreesToRadians</span><span class="p">(</span><span class="w"> </span><span class="mf">5.0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">PerObservableObservationViabilityCalculatorList</span><span class="w"> </span><span class="n">viabilityCalculators</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createObservationViabilityCalculators</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">bodyMap</span><span class="p">,</span><span class="w"> </span><span class="n">linkEndsPerObservable</span><span class="p">,</span><span class="w"> </span><span class="n">observationViabilitySettings</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The objects that are created by the <code class="docutils literal notranslate"><span class="pre">createObservationViabilityCalculators</span></code> function will be used to only use those observations for which the elevation angle at each ground station is larger than 5 degrees.</p>
<p>An additional modification to the observation simulation that we will make, w.r.t. the previous tutorial, is that we will now introduce noise in the simulations. We use a relatively simple model for the noise, setting Gaussian, time-independent and time-uncorrelated distribution for the noise of each observable:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Define noise levels</span>
<span class="kt">double</span><span class="w"> </span><span class="n">rangeNoise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">angularPositionNoise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0E-7</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">dopplerNoise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0E-12</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Create noise functions per observable</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="w"> </span><span class="n">ObservableType</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">noiseFunctions</span><span class="p">;</span><span class="w"></span>
<span class="n">noiseFunctions</span><span class="p">[</span><span class="w"> </span><span class="n">one_way_range</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">utilities</span><span class="o">::</span><span class="n">evaluateFunctionWithoutInputArgumentDependency</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">                   </span><span class="n">createBoostContinuousRandomVariableGeneratorFunction</span><span class="p">(</span><span class="w"></span>
<span class="w">                       </span><span class="n">normal_boost_distribution</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">rangeNoise</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="w"> </span><span class="p">);</span><span class="w"></span>

<span class="n">noiseFunctions</span><span class="p">[</span><span class="w"> </span><span class="n">angular_position</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">utilities</span><span class="o">::</span><span class="n">evaluateFunctionWithoutInputArgumentDependency</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">                   </span><span class="n">createBoostContinuousRandomVariableGeneratorFunction</span><span class="p">(</span><span class="w"></span>
<span class="w">                       </span><span class="n">normal_boost_distribution</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">angularPositionNoise</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="w"> </span><span class="p">);</span><span class="w"></span>

<span class="n">noiseFunctions</span><span class="p">[</span><span class="w"> </span><span class="n">one_way_doppler</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">utilities</span><span class="o">::</span><span class="n">evaluateFunctionWithoutInputArgumentDependency</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<span class="w">                   </span><span class="n">createBoostContinuousRandomVariableGeneratorFunction</span><span class="p">(</span><span class="w"></span>
<span class="w">                       </span><span class="n">normal_boost_distribution</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">dopplerNoise</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Which generates noise functions that put a 0.1 m noise on range, 0.1 mrad noise on the angular position, and <span class="math notranslate nohighlight">\(10^{-12}\)</span> noise on the Doppler observation. The syntax of the above code is described in more detail on the page on <a class="reference internal" href="../tudatFeatures/estimationSetup/observationSimulation.html#observationnoise"><span class="std std-ref">Observation Noise</span></a>. The observations are simulated similarly as before:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Simulate observations</span>
<span class="n">PodInputDataType</span><span class="w"> </span><span class="n">observationsAndTimes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">simulateObservationsWithNoise</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">measurementSimulationInput</span><span class="p">,</span><span class="w"> </span><span class="n">orbitDeterminationManager</span><span class="p">.</span><span class="n">getObservationSimulators</span><span class="p">(</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">noiseFunctions</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">viabilityCalculators</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The rest of the code runs the same as in the previous example. To analyze the output, we ship a MATLAB script with the example application, and show some of its output below. Since we are using different data types with weights <span class="math notranslate nohighlight">\(w_{i}=\sigma_{i}^{-2}\)</span> (with <span class="math notranslate nohighlight">\(\sigma_{i}\)</span> the uncertainty on the observation) that differ by orders of magnitude, we rescale variables such as the partial derivatives, residuals, etc., when plotting them, to be able to compare the various data types.</p>
<p>We first show the correlation matrix:</p>
<div class="figure align-default">
<img alt="../../_images/estimationCorrelations.png" src="../../_images/estimationCorrelations.png" />
</div>
<p>where the indices for the patrameters differ by 1, compared to the list given above (since Matlab starts counting at 1, and C++ at 0).</p>
<p>Next, is the matrix of partial derivatives, scaled by <span class="math notranslate nohighlight">\(\sigma_{i}^{-1}\)</span>, on a logarithmic scale. The different arcs/observables/link ends are clearly visible in the matrix of partial derivatives (see the page on <a class="reference internal" href="../tudatFeatures/estimationSetup/observationSimulation.html#observationsimulation"><span class="std std-ref">Simulating Observations</span></a> on how to interpret the order of the rows of the matrix; columns correspond to the parameters).</p>
<div class="figure align-default">
<img alt="../../_images/estimationPartials.png" src="../../_images/estimationPartials.png" />
</div>
<p>We show the evolution of the observation residuals below (again scaled by <span class="math notranslate nohighlight">\(\sigma_{i}^{-1}\)</span>) as a function of iteration. In the final iteration, the residuals have converged to a Gaussian distribution with 0 mean and standard deviation 1.</p>
<div class="figure align-default">
<img alt="../../_images/residualHistograms.png" src="../../_images/residualHistograms.png" />
</div>
<p>Finally, we give the ratio of true to formal error of the estimated parameters (as a histogram and as a function of parameter index). The histogram very roughly corresponds to the expected behaviour (Gaussian distribution with 0 mean and standard deviation 1).</p>
<div class="figure align-default">
<img alt="../../_images/errorRatios.png" src="../../_images/errorRatios.png" />
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="interplanetaryTrajectory.html" class="btn btn-neutral float-right" title="13. MGA Trajectory Design" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="earthOrbiterBasicStateEstimation.html" class="btn btn-neutral" title="11. Orbit Determination and Parameter Estimation (Basic)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Delft University of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header .arrow").click(function() {
            $(this).closest('.toggle').children().not(".header").toggle(400);
            $(this).toggleClass("open");
            // $(this).html() == "More" ? $(this).html('Less') : $(this).html('More');
        });
        $(".showall").click(function() {
            $(".toggle > *").show(400);
            $(".toggle .header .arrow").addClass("open");
        });
        $(".hideall").click(function() {
            $(".toggle > *").hide(400);
            $(".toggle .header").show(400);
            $(".toggle .header .arrow").removeClass("open");
        });

        var nav_top_height = Math.round($(".wy-side-nav-search").outerHeight())+2;
        $(".wy-nav-content-wrap").prepend("<div id='announcement'><p>â ï¸ This website is now mostly outdated! â ï¸</p><p>Please visit <a href='https://tudat-space.readthedocs.io/en/latest'>tudat-space.readthedocs.io</a> instead.</p></div>");
        $("#announcement").css("height", String(nav_top_height) + "px");
        $(".rst-content").css("margin-top", String(nav_top_height) + "px");
    });
</script>


</body>
</html>