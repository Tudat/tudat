

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10. Variational Equations Propagation &mdash; TU Delft Astrodynamic Toolbox  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="TU Delft Astrodynamic Toolbox  documentation" href="../../index.html"/>
        <link rel="up" title="Application Tutorials" href="index.html"/>
        <link rel="next" title="11. Orbit Determination and Parameter Estimation (Basic)" href="earthOrbiterBasicStateEstimation.html"/>
        <link rel="prev" title="9. Kalman Filter for State Estimation" href="filterExample.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> TU Delft Astrodynamic Toolbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Start Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials and Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../basics/index.html">Tudat Basics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Application Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html#preparation">Preparation</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html#tudat-example-application-tutorials">Tudat Example Application Tutorials</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="tabulatedAtmosphereExamples.html">1. Tabulated Atmosphere Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="unperturbedEarthOrbitingSatellite.html">2. Unperturbed Earth-orbiting Satellite</a></li>
<li class="toctree-l4"><a class="reference internal" href="perturbedEarthOrbitingSatellite.html">3. Perturbed Earth-orbiting Satellite</a></li>
<li class="toctree-l4"><a class="reference internal" href="propagatorTypesComparison.html">4. Comparison of Propagator Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="unguidedCapsuleEntry.html">5. Un-guided Capsule Entry</a></li>
<li class="toctree-l4"><a class="reference internal" href="innerSolarSystemPropagation.html">6. Inner Solar System Propagation</a></li>
<li class="toctree-l4"><a class="reference internal" href="useOfThrustThrustForceAlongVelocityVector.html">7. Use of Thrust: Thrust Force Along Velocity Vector</a></li>
<li class="toctree-l4"><a class="reference internal" href="useOfThrustUserDefinedThrustVector.html">8. Use of Thrust: User-defined Thrust Vector</a></li>
<li class="toctree-l4"><a class="reference internal" href="filterExample.html">9. Kalman Filter for State Estimation</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">10. Variational Equations Propagation</a></li>
<li class="toctree-l4"><a class="reference internal" href="earthOrbiterBasicStateEstimation.html">11. Orbit Determination and Parameter Estimation (Basic)</a></li>
<li class="toctree-l4"><a class="reference internal" href="earthOrbiterStateEstimation.html">12. Orbit Determination and Parameter Estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="interplanetaryTrajectory.html">13. MGA Trajectory Design</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#pagmo-optimization-tutorials">Pagmo Optimization Tutorials</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tudatFeatures/index.html">Tudat Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jsonInterface/index.html">JSON Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../matlabInterface/index.html">MATLAB Interface</a></li>
<li class="toctree-l2"><a class="reference external" href="http://doxygen.tudat.tudelft.nl">Doxygen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../FAQ/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developerGuide/index.html">Developer Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TU Delft Astrodynamic Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Tutorials and Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Application Tutorials</a> &raquo;</li>
        
      <li>10. Variational Equations Propagation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/tutorials/applicationWalkthroughs/variationalEquationsPropagation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="variational-equations-propagation">
<span id="variationalequationpropagation"></span><h1>10. Variational Equations Propagation<a class="headerlink" href="#variational-equations-propagation" title="Permalink to this headline">Â¶</a></h1>
<p>In the previous tutorials, we have focussed on propagating the (translational and mass) state of one of or more bodies. Tudat is also capable of propagating the variational equations for the dynamics, to produce the state transition matrix <span class="math">\(\Phi(t,t_{0})\)</span> and sensitivity matrix <span class="math">\(S(t)\)</span>, which we define here as:</p>
<div class="math">
\[\begin{split}\Phi(t,t_{0}) &amp;= \frac{\partial \mathbf{x}(t)}{\partial\mathbf{x}(t_{0})}\\
S &amp;= \frac{\partial \mathbf{x}(t)}{\partial \mathbf{p  }}\\\end{split}\]</div>
<p>where <span class="math">\(\mathbf{x}\)</span> is the propagated state, <span class="math">\(\mathbf{p}\)</span> the vector of a parameter vector (e.g. gravity field parameters, rotation model parameters, etc.), and <span class="math">\(t_{0}\)</span> denotes the initial time.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In some literature, the sensitivity matrix is not defined separately, but the state transition matrix <span class="math">\(\Phi(t,t_{0})\)</span> is defined as <span class="math">\(\frac{\partial[\mathbf{x}(t);\text{ }\mathbf{p}]}{\partial[\mathbf{x}(t_{0};\text{ }\mathbf{p}])}\)</span></p>
</div>
<p>The code for this tutorial is given on Github, and is also located in your tudat bundle at:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tudatBundle</span><span class="o">/</span><span class="n">tudatExampleApplications</span><span class="o">/</span><span class="n">satellitePropagatorExamples</span><span class="o">/</span><span class="n">SatellitePropagatorExamples</span><span class="o">/</span><span class="n">singlePerturbedSatelliteVariationalEquationsPropagator</span><span class="o">.</span><span class="n">cpp</span>
</pre></div>
</div>
<p>As you can see in the code, setting up the simulations is done in a similar manner as the <a class="reference internal" href="perturbedEarthOrbitingSatellite.html#walkthroughsperturbedearthorbitingsatellite"><span class="std std-ref">Perturbed Earth-orbiting Satellite</span></a>: the code start by providing settings for the environment, accelerations, propagation and integration.</p>
<p>To propagate the variational equations, additional information needs to be provided, specifically: for which paramaters are the variational equations to be set up? In this example, the following code fully defines this:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="c1">// Define list of parameters to estimate.</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">EstimatableParameterSettings</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">parameterNames</span><span class="p">;</span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
            <span class="n">boost</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">InitialTranslationalStateEstimatableParameterSettings</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span>
                <span class="s">&quot;Asterix&quot;</span><span class="p">,</span> <span class="n">asterixInitialState</span><span class="p">,</span> <span class="s">&quot;Earth&quot;</span> <span class="p">)</span> <span class="p">);</span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">boost</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">EstimatableParameterSettings</span> <span class="o">&gt;</span><span class="p">(</span> <span class="s">&quot;Asterix&quot;</span><span class="p">,</span> <span class="n">radiation_pressure_coefficient</span> <span class="p">)</span> <span class="p">);</span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">boost</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">EstimatableParameterSettings</span> <span class="o">&gt;</span><span class="p">(</span> <span class="s">&quot;Asterix&quot;</span><span class="p">,</span> <span class="n">constant_drag_coefficient</span> <span class="p">)</span> <span class="p">);</span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">boost</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">SphericalHarmonicEstimatableParameterSettings</span> <span class="o">&gt;</span><span class="p">(</span>
                              <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Earth&quot;</span><span class="p">,</span> <span class="n">spherical_harmonics_cosine_coefficient_block</span> <span class="p">)</span> <span class="p">);</span>
<span class="n">parameterNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">boost</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">SphericalHarmonicEstimatableParameterSettings</span> <span class="o">&gt;</span><span class="p">(</span>
                              <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Earth&quot;</span><span class="p">,</span> <span class="n">spherical_harmonics_sine_coefficient_block</span> <span class="p">)</span> <span class="p">);</span>

<span class="c1">// Create parameters</span>
<span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">estimatable_parameters</span><span class="o">::</span><span class="n">EstimatableParameterSet</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">parametersToEstimate</span> <span class="o">=</span>
        <span class="n">createParametersToEstimate</span><span class="p">(</span> <span class="n">parameterNames</span><span class="p">,</span> <span class="n">bodyMap</span> <span class="p">);</span>

<span class="c1">// Print identifiers and indices of parameters to terminal.</span>
<span class="n">printEstimatableParameterEntries</span><span class="p">(</span> <span class="n">parametersToEstimate</span> <span class="p">);</span>
</pre></div>
</div>
<p>Details on the setup, and the options available, for the parameters is given on the page: <a class="reference internal" href="../tudatFeatures/estimationSetup/parameterEstimationSettings.html#parameterestimationsettings"><span class="std std-ref">Setting Up Estimated Parameters</span></a>. Summarizing, the lines of code above define that the following parameters should be used:</p>
<ul class="simple">
<li>Initial state of body Asterix, denoted as <span class="math">\(\mathbf{x}_{0}\)</span></li>
<li>Radiation pressure coefficient (constant) of body Asterix, denoted as  <span class="math">\(C_{r}\)</span></li>
<li>Drag coefficient (constant) of body Asterix, denoted as  <span class="math">\(C_{D}\)</span></li>
<li>Both cosine and sine spherical harmonic gravity field coefficients of body Earth, at degree 2: <span class="math">\(\bar{C}_{2,0..2}\)</span>, denoted as  <span class="math">\(\bar{S}_{2,1..2}\)</span></li>
</ul>
<p>Similar to other models, we create objects of (derived classes of) <a class="reference internal" href="../tudatFeatures/estimationSetup/parameterEstimationSettings.html#EstimatableParameterSettings" title="EstimatableParameterSettings"><code class="xref py py-class docutils literal"><span class="pre">EstimatableParameterSettings</span></code></a>, and then call the <code class="docutils literal"><span class="pre">createParametersToEstimate</span></code> function to create the actual objects that are used internally in Tudat, in this case stored in an <a class="reference internal" href="../tudatFeatures/estimationSetup/parameterEstimationSettings.html#EstimatableParameterSet" title="EstimatableParameterSet"><code class="xref py py-class docutils literal"><span class="pre">EstimatableParameterSet</span></code></a> object.</p>
<p>The propagation of the variational equations solver is done by a dedicated object:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="c1">// Create simulation object and propagate dynamics.</span>
   <span class="n">SingleArcVariationalEquationsSolver</span><span class="o">&lt;</span> <span class="o">&gt;</span> <span class="n">variationalEquationsSimulator</span><span class="p">(</span>
               <span class="n">bodyMap</span><span class="p">,</span> <span class="n">integratorSettings</span><span class="p">,</span> <span class="n">propagatorSettings</span><span class="p">,</span> <span class="n">parametersToEstimate</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span>
               <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">numerical_integrators</span><span class="o">::</span><span class="n">IntegratorSettings</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span> <span class="p">),</span> <span class="nb">false</span><span class="p">,</span> <span class="nb">true</span> <span class="p">);</span>
</pre></div>
</div>
<p>So, instead of using a <a class="reference internal" href="../tudatFeatures/propagationSetup/simulatorCreation.html#SingleArcDynamicsSimulator" title="SingleArcDynamicsSimulator"><code class="xref py py-class docutils literal"><span class="pre">SingleArcDynamicsSimulator</span></code></a> object (which propagates only the state), we use <a class="reference internal" href="../tudatFeatures/propagationSetup/variationalSimulatorCreation.html#SingleArcVariationalEquationsSolver" title="SingleArcVariationalEquationsSolver"><code class="xref py py-class docutils literal"><span class="pre">SingleArcVariationalEquationsSolver</span></code></a> object (which propagates both the state and the variational equations). Details on the input to the object are discussed on the page <span class="xref std std-ref">variationalEquationsSolver</span>. Using the above, the equations are immediately propagated upon creation of the object. Retrieving the output is done as:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span> <span class="o">&gt;</span> <span class="n">stateTransitionResult</span> <span class="o">=</span>
        <span class="n">variationalEquationsSimulator</span><span class="p">.</span><span class="n">getNumericalVariationalEquationsSolution</span><span class="p">(</span> <span class="p">).</span><span class="n">at</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span> <span class="o">&gt;</span> <span class="n">sensitivityResult</span> <span class="o">=</span>
        <span class="n">variationalEquationsSimulator</span><span class="p">.</span><span class="n">getNumericalVariationalEquationsSolution</span><span class="p">(</span> <span class="p">).</span><span class="n">at</span><span class="p">(</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span> <span class="kt">double</span><span class="p">,</span> <span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span> <span class="o">&gt;</span> <span class="n">integrationResult</span> <span class="o">=</span>
        <span class="n">variationalEquationsSimulator</span><span class="p">.</span><span class="n">getDynamicsSimulator</span><span class="p">(</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getEquationsOfMotionNumericalSolution</span><span class="p">(</span> <span class="p">);</span>
</pre></div>
</div>
<p>Finally, these maps are written to files, similarly to the previous examples and discussed in <a class="reference internal" href="../tudatFeatures/otherLibraries/inputOutput.html#tudatfeaturesinputoutput"><span class="std std-ref">Input/Output</span></a>. Note however, that the matrix entries of the first two maps in the above are spread out over a single row in the output file. The concatenation of the matrix entries is done row by row.</p>
<p>Below,a plot is given of the entries of the state transition matrix as a function of time. The current state entry is indicated by line style, the initial state entry by color.</p>
<div class="figure">
<img alt="../../_images/variationalEquationsExample.png" src="../../_images/variationalEquationsExample.png" />
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Open the figure in a new tab for more detail.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="earthOrbiterBasicStateEstimation.html" class="btn btn-neutral float-right" title="11. Orbit Determination and Parameter Estimation (Basic)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="filterExample.html" class="btn btn-neutral" title="9. Kalman Filter for State Estimation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Delft University of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header .arrow").click(function() {
            $(this).closest('.toggle').children().not(".header").toggle(400);
            $(this).toggleClass("open");
            // $(this).html() == "More" ? $(this).html('Less') : $(this).html('More');
        });
        $(".showall").click(function() {
            $(".toggle > *").show(400);
            $(".toggle .header .arrow").addClass("open");
        });
        $(".hideall").click(function() {
            $(".toggle > *").hide(400);
            $(".toggle .header").show(400);
            $(".toggle .header .arrow").removeClass("open");
        });
    });
</script>


</body>
</html>