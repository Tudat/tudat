

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.5. Perturbed Earth-orbiting Satellite Lifetime Maximisation Using a Custom C++ Application &mdash; TU Delft Astrodynamic Toolbox  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="TU Delft Astrodynamic Toolbox  documentation" href="../../../../index.html"/>
        <link rel="up" title="2. Tutorials" href="../index.html"/>
        <link rel="next" title="3. List of Keys" href="../../keys/rst/index.html"/>
        <link rel="prev" title="2.4. Apollo Capsule Entry" href="../apolloCapsuleEntry/index.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> TU Delft Astrodynamic Toolbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Start Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Tutorials and Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../basics/index.html">Tudat Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../applicationWalkthroughs/index.html">Application Walkthroughs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tudatFeatures/index.html">Tudat Libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">JSON Interface</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../basicJsonInterfaces.html">1. Basic JSON Interfaces</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">2. Tutorials</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../unperturbedSatellite/index.html">2.1. Unperturbed Earth-orbiting Satellite</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perturbedSatellite/index.html">2.2. Perturbed Earth-orbiting Satellite</a></li>
<li class="toctree-l4"><a class="reference internal" href="../lifetimeMaximisation/index.html">2.3. Perturbed Earth-orbiting Satellite Lifetime Maximisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../apolloCapsuleEntry/index.html">2.4. Apollo Capsule Entry</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">2.5. Perturbed Earth-orbiting Satellite Lifetime Maximisation Using a Custom C++ Application</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../keys/rst/index.html">3. List of Keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../customJsonApp.html">4. Writing Custom JSON-based Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../modularFiles.html">5. Modular Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../multicase.html">6. Multi-case Simulations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../matlabInterface/index.html">MATLAB Interface</a></li>
<li class="toctree-l2"><a class="reference external" href="http://doxygen.tudat.tudelft.nl">Doxygen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../troubleshooting/index.html">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../FAQ/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developerGuide/index.html">Developer Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">TU Delft Astrodynamic Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Tutorials and Documentation</a> &raquo;</li>
        
          <li><a href="../../index.html">JSON Interface</a> &raquo;</li>
        
          <li><a href="../index.html">2. Tutorials</a> &raquo;</li>
        
      <li>2.5. Perturbed Earth-orbiting Satellite Lifetime Maximisation Using a Custom C++ Application</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/tutorials/jsonInterface/tutorials/lifetimeMaximisationCPP/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="perturbed-earth-orbiting-satellite-lifetime-maximisation-using-a-custom-c-application">
<span id="jsoninterface-tutorials-lifetimemaximisationcpp"></span><h1>2.5. Perturbed Earth-orbiting Satellite Lifetime Maximisation Using a Custom C++ Application<a class="headerlink" href="#perturbed-earth-orbiting-satellite-lifetime-maximisation-using-a-custom-c-application" title="Permalink to this headline">Â¶</a></h1>
<p>The example described on this page is identical to that described in <a class="reference internal" href="../lifetimeMaximisation/index.html#jsoninterface-tutorials-lifetimemaximisation"><span class="std std-ref">Perturbed Earth-orbiting Satellite Lifetime Maximisation</span></a>. The only difference is that there, the <code class="docutils literal"><span class="pre">json_interface</span></code> application is used with many input files to run the different cases, while in this case only one input file, containing the shared settings, is used, and a custom C++ application is written to manually modify a few parameters for each case. The C++ code can be found in:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tudatBundle</span><span class="o">/</span><span class="n">tudatExampleApplications</span><span class="o">/</span><span class="n">satellitePropagatorExamples</span><span class="o">/</span><span class="n">SatellitePropagatorExamples</span><span class="o">/</span><span class="n">lifetimeMaximisation</span><span class="o">.</span><span class="n">cpp</span>
</pre></div>
</div>
<p>The file <code class="xref py py-class docutils literal"><span class="pre">lifetimeMaximisation.json</span></code> used as input for all the propagations is identical to the file <code class="xref py py-class docutils literal"><span class="pre">shared.json</span></code> created in <a class="reference internal" href="../lifetimeMaximisation/index.html#jsoninterface-tutorials-lifetimemaximisation"><span class="std std-ref">Perturbed Earth-orbiting Satellite Lifetime Maximisation</span></a>.</p>
<p>In this case, we do not write a C++ application because we want to use Tudat features that cannot be provided through a JSON file, but because we want to avoid having to generate a different input file for each propagation. The disadvantage of this choice is that we cannot use parallel processing, as all the propagations will be run sequentially by a single process, while when using the <code class="docutils literal"><span class="pre">json_interface</span></code> with different input files, we are able to run many cases concurrently.</p>
<p>In this case there is no need to write a derived class of <code class="xref py py-class docutils literal"><span class="pre">JsonSimulationManager</span></code> with custom implementations for virtual methods. We can simply modify the JSON object containing the settings read from the JSON file before it is actually used to set up the simulation objects. Thus, all the code we need to write is:</p>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;Tudat/JsonInterface/jsonInterface.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;SatellitePropagatorExamples/applicationOutput.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">cppFilePath</span><span class="p">(</span> <span class="n">__FILE__</span> <span class="p">);</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">cppFolder</span> <span class="o">=</span> <span class="n">cppFilePath</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cppFilePath</span><span class="p">.</span><span class="n">find_last_of</span><span class="p">(</span><span class="s">&quot;/</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span>
  <span class="n">tudat</span><span class="o">::</span><span class="n">json_interface</span><span class="o">::</span><span class="n">JsonSimulationManager</span><span class="o">&lt;</span> <span class="o">&gt;</span> <span class="n">jsonSimulationManager</span><span class="p">(</span> <span class="n">cppFolder</span> <span class="o">+</span> <span class="s">&quot;lifetimeMaximisation.json&quot;</span> <span class="p">);</span>

  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">outputDirectory</span> <span class="o">=</span> <span class="n">tudat_applications</span><span class="o">::</span><span class="n">getOutputPath</span><span class="p">(</span> <span class="p">)</span> <span class="o">+</span> <span class="s">&quot;LifetimeMaximisation/&quot;</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">numberOfCases</span> <span class="o">=</span> <span class="mi">365</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numberOfCases</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
      <span class="c1">// Notify on propagation start</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Running propagation &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; of &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">numberOfCases</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;...&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

      <span class="c1">// Define the initial and final epochs</span>
      <span class="k">const</span> <span class="kt">double</span> <span class="n">initialEpoch</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">tudat</span><span class="o">::</span><span class="n">physical_constants</span><span class="o">::</span><span class="n">JULIAN_DAY</span><span class="p">;</span>
      <span class="n">jsonSimulationManager</span><span class="p">[</span> <span class="s">&quot;initialEpoch&quot;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">initialEpoch</span><span class="p">;</span>
      <span class="n">jsonSimulationManager</span><span class="p">[</span> <span class="s">&quot;finalEpoch&quot;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">initialEpoch</span> <span class="o">+</span> <span class="n">tudat</span><span class="o">::</span><span class="n">physical_constants</span><span class="o">::</span><span class="n">JULIAN_YEAR</span><span class="p">;</span>

      <span class="c1">// Define the output file</span>
      <span class="n">jsonSimulationManager</span><span class="p">[</span> <span class="s">&quot;export&quot;</span> <span class="p">][</span> <span class="mi">0</span> <span class="p">][</span> <span class="s">&quot;file&quot;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">outputDirectory</span> <span class="o">+</span> <span class="s">&quot;day&quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.txt&quot;</span><span class="p">;</span>

      <span class="c1">// Create settings objects</span>
      <span class="n">jsonSimulationManager</span><span class="p">.</span><span class="n">updateSettings</span><span class="p">(</span> <span class="p">);</span>

      <span class="c1">// Propagate</span>
      <span class="n">jsonSimulationManager</span><span class="p">.</span><span class="n">runPropagation</span><span class="p">(</span> <span class="p">);</span>

      <span class="c1">// Export results</span>
      <span class="n">jsonSimulationManager</span><span class="p">.</span><span class="n">exportResults</span><span class="p">(</span> <span class="p">);</span>

      <span class="c1">// Silence unused key warnings after first propagation</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
      <span class="p">{</span>
          <span class="n">jsonSimulationManager</span><span class="p">[</span> <span class="s">&quot;options&quot;</span> <span class="p">][</span> <span class="s">&quot;unusedKey&quot;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tudat</span><span class="o">::</span><span class="n">json_interface</span><span class="o">::</span><span class="n">continueSilently</span><span class="p">;</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>In this example, we first create a <code class="xref py py-class docutils literal"><span class="pre">JsonSimulationManager</span></code>, which will contain the JSON object obtained by parsing the specified input file. Then, we write a loop in which we modify this JSON object before it is actually used to set up the objects needed for the propagation (integrator, propagators, bodies, etc.) when we call the <code class="docutils literal"><span class="pre">updateSettings</span></code> method. We can access this JSON object by using the method <code class="docutils literal"><span class="pre">getJsonObject</span></code>. However, we can also modify this object by accessing the <code class="docutils literal"><span class="pre">at</span></code> method and the <code class="docutils literal"><span class="pre">[]</span></code> operators of the <code class="xref py py-class docutils literal"><span class="pre">JsonSimulationManager</span></code> directly. Thus, these two lines are equivalent:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">jsonSimulationManager</span><span class="p">.</span><span class="n">getJsonObject</span><span class="p">(</span> <span class="p">)[</span> <span class="s">&quot;initialEpoch&quot;</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">jsonSimulationManager</span><span class="p">[</span> <span class="s">&quot;initialEpoch&quot;</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>And so are these two lines too:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">jsonSimulationManager</span><span class="p">.</span><span class="n">getJsonObject</span><span class="p">(</span> <span class="p">).</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;initialEpoch&quot;</span> <span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">jsonSimulationManager</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;initialEpoch&quot;</span> <span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
</div>
<p>Inside the loop, in which we iterate for each of the propagations to be carried out, we modify the keys <span class="jsonkey">initialEpoch</span> and <span class="jsonkey">finalEpoch</span> of the JSON object. Additionally, we want each propagation to generate an output file with a unique name, so we also modify the key <span class="jsonkey">export[0].file</span>. Then, we can set up the simulation, run the propagation and export the results.</p>
<p>After the first propagation has been completed, we turn off warnings for unused keys. This is done to silence warnings about the key <span class="jsonkey">bodies.satellite.initialState</span> being unused. When running the first propagation, the Keplerian state defined in <span class="jsonkey">bodies.satellite.initialState</span> is converted to Cartesian and assigned to <span class="jsonkey">propagators[0].initialStates</span>. Further propagations find that the key <span class="jsonkey">propagators[0].initialStates</span> is defined, and thus they do not use the information at <span class="jsonkey">bodies.satellite.initialState</span>, resulting in an unused key warning if we do not set the key <span class="jsonkey">options.unusedKey</span> to <code class="docutils literal"><span class="pre">&quot;continueSilently&quot;</span></code>.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../keys/rst/index.html" class="btn btn-neutral float-right" title="3. List of Keys" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../apolloCapsuleEntry/index.html" class="btn btn-neutral" title="2.4. Apollo Capsule Entry" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Delft University of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header .arrow").click(function() {
            $(this).closest('.toggle').children().not(".header").toggle(400);
            $(this).toggleClass("open");
            // $(this).html() == "More" ? $(this).html('Less') : $(this).html('More');
        });
        $(".showall").click(function() {
            $(".toggle > *").show(400);
            $(".toggle .header .arrow").addClass("open");
        });
        $(".hideall").click(function() {
            $(".toggle > *").hide(400);
            $(".toggle .header").show(400);
            $(".toggle .header .arrow").removeClass("open");
        });
    });
</script>


</body>
</html>