

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.4. Aerodynamic Guidance &mdash; TU Delft Astrodynamic Toolbox  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="TU Delft Astrodynamic Toolbox  documentation" href="../../../index.html"/>
        <link rel="up" title="2. Setting up State Derivative Models" href="index.html"/>
        <link rel="next" title="2.5. Thrust Guidance" href="thrustModels.html"/>
        <link rel="prev" title="2.3. Mass Rate Model Set-up" href="massModel.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> TU Delft Astrodynamic Toolbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Start Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Tutorials and Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../applicationWalkthroughs/index.html">Application Tutorials</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Tudat Libraries</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../environmentSetup/index.html">1. Environment Set-up</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">2. Setting up State Derivative Models</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="frameworkAcceleration.html">2.1. Acceleration Model Set-up</a></li>
<li class="toctree-l4"><a class="reference internal" href="rotModel.html">2.2. Torque Model Set-up</a></li>
<li class="toctree-l4"><a class="reference internal" href="massModel.html">2.3. Mass Rate Model Set-up</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">2.4. Aerodynamic Guidance</a></li>
<li class="toctree-l4"><a class="reference internal" href="thrustModels.html">2.5. Thrust Guidance</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../propagationSetup/index.html">3. Simulator Set-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../estimationSetup/index.html">4. Estimation Set-Up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../astroTools/index.html">5. Basic Astrodynamics Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lowThrustTrajectoryDesign/index.html">Low-Thrust Trajectory Design Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mathTools/index.html">6. Basic Mathematics Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../otherLibraries/index.html">7. Other Libraries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../basics/index.html">Tudat Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jsonInterface/index.html">JSON Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../matlabInterface/index.html">MATLAB Interface</a></li>
<li class="toctree-l2"><a class="reference external" href="http://doxygen.tudat.tudelft.nl">Doxygen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../FAQ/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developerGuide/index.html">Developer Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TU Delft Astrodynamic Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Tutorials and Documentation</a> &raquo;</li>
        
          <li><a href="../index.html">Tudat Libraries</a> &raquo;</li>
        
          <li><a href="index.html"><span class="section-number">2. </span>Setting up State Derivative Models</a> &raquo;</li>
        
      <li><span class="section-number">2.4. </span>Aerodynamic Guidance</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/tutorials/tudatFeatures/accelerationSetup/aerodynamicGuidance.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="aerodynamic-guidance">
<span id="tudatfeaturesaerodynamicguidance"></span><h1><span class="section-number">2.4. </span>Aerodynamic Guidance<a class="headerlink" href="#aerodynamic-guidance" title="Permalink to this headline">¶</a></h1>
<p>When including aerodynamics in the orbit propagation, it may often be desirable to modify the aerodynamic properties of the vehicle as a function of the current environment. This is the case for ascent and entry for instance. Also, control surface deflections may be needed to modify the vehicle’s behaviour. Both options are included in Tudat, and the interfaces are described below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In applications were no aerodynamic guidance is used, the angle of attack, sideslip angle and bank angle are all implicitly set to zero.</p>
</div>
<div class="section" id="vehicle-orientation">
<h2><span class="section-number">2.4.1. </span>Vehicle orientation<a class="headerlink" href="#vehicle-orientation" title="Permalink to this headline">¶</a></h2>
<p>Although rotational motion can be propagated in Tudat (see <a class="reference internal" href="../propagationSetup/propagatorSettings.html#RotationalStatePropagatorSettings" title="RotationalStatePropagatorSettings"><code class="xref py py-class docutils literal notranslate"><span class="pre">RotationalStatePropagatorSettings</span></code></a>), in many cases the user wants to impose this rotational motion on the vehicle, using some a-priori model or guidance system.</p>
<p>For aerodynamics, the vehicle orientation is typically described by the angle of attack, angle of sideslip and bank angle, which is also the approach we take in Tudat. There is a single interface in Tudat through which the functions describing these angles are fed to the trajectory propagation:</p>
<dl class="py class">
<dt id="AerodynamicAngleCalculator">
<em class="property">class </em><code class="sig-name descname">AerodynamicAngleCalculator</code><a class="headerlink" href="#AerodynamicAngleCalculator" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is used for the describing the angle of attack, angle of sideslip and bank angle of the vehicle. The <code class="docutils literal notranslate"><span class="pre">setOrientationAngleFunctions</span></code> member function of this class is used. However, there is a number of manners in which to use this function, either directly or indirectly, the preferred selection of course depending on your application. The options are:</p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li><p>Manual definitions of the three angles of a function of time (can also be used to set constant angles).</p></li>
<li><p>Pre-defined guidance laws (only angle-of-attack trim presently implemented).</p></li>
<li><p>A user-defined <a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicGuidance</span></code></a> class, which computes the current angles using any number of input/environment variables. This option is typically the preferred option for a realistic entry propagation.</p></li>
</ul>
</div></blockquote>
<p>Below, we will indicate how to use these three options for the example of the Apollo entry example. Currently, the following code is used in the example, defining a constant angle of attack of 30 degree, and 0 sideslip and bank angle:</p>
</div></blockquote>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;Apollo&quot;</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getFlightConditions</span><span class="p">(</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getAerodynamicAngleCalculator</span><span class="p">(</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">setOrientationAngleFunctions</span><span class="p">(</span>
            <span class="p">[</span> <span class="o">=</span> <span class="p">](</span> <span class="p">){</span> <span class="k">return</span> <span class="mf">30.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span> <span class="p">}</span> <span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>We stress that any definition of the aerodynamic guidance must be done after the acceleration models have been created (by <a class="reference internal" href="frameworkAcceleration.html#AccelerationSettings" title="AccelerationSettings"><code class="xref py py-class docutils literal notranslate"><span class="pre">AccelerationSettings</span></code></a>)(but before the trajectory is propagated).</p>
</div>
</dd></dl>

<div class="section" id="manual-angle-functions">
<h3><span class="section-number">2.4.1.1. </span>Manual angle functions<a class="headerlink" href="#manual-angle-functions" title="Permalink to this headline">¶</a></h3>
<p>To manually set the body orientation as constant angles, the <code class="docutils literal notranslate"><span class="pre">setOrientationAngleFunctions</span></code> function is called directly, as is done in the above example. Note that if you need a definition of aerodynamic angles that varies with time, a specific <a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicGuidance</span></code></a> derived class should be implemented or one of the predefined orientation functions should be used. In general, the manual definition of the angles is done as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">constantAngleOfAttack</span> <span class="o">=</span> <span class="mf">30.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">constantSideslipAngle</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">constantBankAngle</span> <span class="o">=</span> <span class="o">-</span><span class="mf">70.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>

<span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;Apollo&quot;</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getFlightConditions</span><span class="p">(</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getAerodynamicAngleCalculator</span><span class="p">(</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">setOrientationAngleFunctions</span><span class="p">(</span>
            <span class="p">[</span> <span class="o">=</span> <span class="p">](</span> <span class="p">){</span> <span class="k">return</span> <span class="n">constantAngleOfAttack</span><span class="p">;</span> <span class="p">},</span> <span class="p">[</span> <span class="o">=</span> <span class="p">](</span> <span class="p">){</span> <span class="k">return</span> <span class="n">constantSideslipAngle</span><span class="p">;</span> <span class="p">},</span> <span class="p">[</span> <span class="o">=</span> <span class="p">](</span> <span class="p">){</span> <span class="k">return</span> <span class="n">constantBankAngle</span><span class="p">;</span> <span class="p">}</span> <span class="p">);</span>
</pre></div>
</div>
<p>By using this code, the vehicle will fly at 30 degree angle of attack, 2 degree sideslip angle and -70 degree bank angle during the full propagation.</p>
</div>
<div class="section" id="predefined-guidance-law">
<h3><span class="section-number">2.4.1.2. </span>Predefined guidance law<a class="headerlink" href="#predefined-guidance-law" title="Permalink to this headline">¶</a></h3>
<p>Presently, only a single predefined guidance law is implemented in Tudat: imposing pitch-trim. When using this setting, the sideslip and bank angles are set to zero, while the angle of attack is chosen such that the pitch moment coefficient is exactly zero. It is set by using:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">TrimOrientationCalculator</span> <span class="o">&gt;</span> <span class="n">trimCalculator</span> <span class="o">=</span> <span class="n">setTrimmedConditions</span><span class="p">(</span> <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;Apollo&quot;</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>After calling this function, no additional action is needed from the user. In fact, using the following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">setTrimmedConditions</span><span class="p">(</span> <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;Apollo&quot;</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>will work equally well. The <code class="xref py py-class docutils literal notranslate"><span class="pre">TrimOrientationCalculator</span></code> is returned by the function to keep the object through which the computations are performed available to the user.</p>
</div>
<div class="section" id="user-defined-aerodynamic-orientation">
<h3><span class="section-number">2.4.1.3. </span>User-defined aerodynamic orientation<a class="headerlink" href="#user-defined-aerodynamic-orientation" title="Permalink to this headline">¶</a></h3>
<p>For a general description of the vehicle orientation, a custom-defined function is typically required, to fit the needs to the mission/simulation under consideration. To facilitate this process, we have defined a virtual base class called <a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicGuidance</span></code></a>.</p>
<dl class="py class">
<dt id="AerodynamicGuidance">
<em class="property">class </em><code class="sig-name descname">AerodynamicGuidance</code><a class="headerlink" href="#AerodynamicGuidance" title="Permalink to this definition">¶</a></dt>
<dd><p>Virtual base class used to facilitate user-defined derived guidance classes.</p>
</dd></dl>

<p>A user-defined derived class must be defined, through which the orientation is computed at each time step of the propagation. Below, there are several examples of how to implement such a guidance algorithm. In each case, the final binding to the propagation is done as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">AerodynamicGuidance</span> <span class="o">&gt;</span> <span class="n">aerodynamicGuidance</span> <span class="o">=</span>  <span class="c1">// Create user-defined guidance object here</span>
<span class="n">setGuidanceAnglesFunctions</span><span class="p">(</span> <span class="n">aerodynamicGuidance</span><span class="p">,</span> <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;Apollo&quot;</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>An example of the computation of the three aerodynamic angles as a function of time alone can be done by using the following <a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicGuidance</span></code></a> derived class:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LinearTimeAerodynamicGuidance</span><span class="o">:</span> <span class="k">public</span> <span class="n">AerodynamicGuidance</span>
<span class="p">{</span>
    <span class="n">LinearTimeAerodynamicGuidance</span><span class="p">(</span>
        <span class="k">const</span> <span class="kt">double</span> <span class="n">angleOfAttackRate</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">sideslipAngleRate</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">bankAngleRate</span><span class="p">,</span>
            <span class="k">const</span> <span class="kt">double</span> <span class="n">referenceTime</span> <span class="p">)</span><span class="o">:</span>
                <span class="n">angleOfAttackRate_</span><span class="p">(</span> <span class="n">angleOfAttackRate</span> <span class="p">),</span> <span class="n">sideslipAngleRate_</span><span class="p">(</span> <span class="n">sideslipAngleRate</span> <span class="p">),</span> <span class="n">bankAngleRate_</span><span class="p">(</span> <span class="n">bankAngleRate</span> <span class="p">),</span>
                    <span class="n">referenceTime_</span><span class="p">(</span> <span class="n">referenceTime</span> <span class="p">){</span> <span class="p">}</span>

<span class="kt">void</span> <span class="n">updateGuidance</span><span class="p">(</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">currentTime</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="n">angleOfAttackRate_</span> <span class="o">*</span> <span class="p">(</span> <span class="n">currentTime</span> <span class="o">-</span> <span class="n">referenceTime_</span> <span class="p">);</span>
    <span class="n">currentAngleOfSideslip_</span> <span class="o">=</span> <span class="n">sideslipAngleRate_</span> <span class="o">*</span> <span class="p">(</span> <span class="n">currentTime</span> <span class="o">-</span> <span class="n">referenceTime_</span> <span class="p">);</span>
    <span class="n">currentBankAngle_</span> <span class="o">=</span> <span class="n">bankAngleRate_</span> <span class="o">*</span> <span class="p">(</span> <span class="n">currentTime</span> <span class="o">-</span> <span class="n">referenceTime_</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span><span class="o">:</span>

    <span class="kt">double</span> <span class="n">angleOfAttackRate_</span><span class="p">;</span>

    <span class="kt">double</span> <span class="n">sideslipAngleRate_</span><span class="p">;</span>

    <span class="kt">double</span> <span class="n">bankAngleRate_</span><span class="p">;</span>

    <span class="kt">double</span> <span class="n">referenceTime_</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Then, the guidance law can be created and set by:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">AerodynamicGuidance</span> <span class="o">&gt;</span> <span class="n">aerodynamicGuidance</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">LinearTimeAerodynamicGuidance</span> <span class="o">&gt;</span><span class="p">(</span>
    <span class="mf">1.0E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0E-6</span><span class="p">,</span> <span class="mf">1.0E-3</span><span class="p">,</span> <span class="mf">500.0</span> <span class="p">);</span>
<span class="n">setGuidanceAnglesFunctions</span><span class="p">(</span> <span class="n">aerodynamicGuidance</span><span class="p">,</span> <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="s">&quot;Apollo&quot;</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>This creates and sets aerodynamic angles that are zero at t=500 s, where the angles of attack, sideslip and bank change by 10 -4, -2*10 -6 and 10 -3 rad/s. Recall that al units in Tudat are SI unless otherwise indicated. The key behind this implementation in the <a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicGuidance</span></code></a> derived class is the following:</p>
<blockquote>
<div><ul class="simple">
<li><p>A definition of a <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">updateGuidance(</span> <span class="pre">const</span> <span class="pre">double</span> <span class="pre">currentTime</span> <span class="pre">)</span></code> function in the derived class, which is called every time step to compute the current angles as a function of time.</p></li>
<li><p>The calculation of <code class="docutils literal notranslate"><span class="pre">currentAngleOfAttack_</span></code>, <code class="docutils literal notranslate"><span class="pre">currentAngleOfSideslip_</span></code> and <code class="docutils literal notranslate"><span class="pre">currentBankAngle_</span></code> in this function. Whichever values these variables are set to in the <code class="docutils literal notranslate"><span class="pre">updateGuidance</span></code> function are the values that will be used during the current time step.</p></li>
</ul>
</div></blockquote>
<p>The example of aerodynamic guidance given above is not very representative, of course. In general, you will want to define your body’s orientation as a function of its current state/environment, etc. To accomplish this, you can add the body map (or any its contents) as member variables to your <a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicGuidance</span></code></a> derived class. In many cases, the required information will be stored in the <a class="reference internal" href="#FlightConditions" title="FlightConditions"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlightConditions</span></code></a> object.</p>
<dl class="py class">
<dt id="FlightConditions">
<em class="property">class </em><code class="sig-name descname">FlightConditions</code><a class="headerlink" href="#FlightConditions" title="Permalink to this definition">¶</a></dt>
<dd><p>Class which calculates and stores data on altitude, longitude, latitude, etc. for non-atmospheric flight (stored as a member of a <a class="reference internal" href="../environmentSetup/setup.html#Body" title="Body"><code class="xref py py-class docutils literal notranslate"><span class="pre">Body</span></code></a> object). Can be used during propagation to retrieve various data, using the functions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getCurrentAltitude</span></code>  Returns the current altitude w.r.t. the central body shape model</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCurrentLongitude</span></code> Returns the current longitude, in the body-fixed frame of the central body</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCurrentGeodeticLatitude</span></code> Returns the current geodetic latitude, in the body-fixed frame of the central body</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getAerodynamicAngleCalculator</span></code> Returns a <code class="docutils literal notranslate"><span class="pre">AerodynamicAngleCalculator</span></code> object, from which the current geographic latitude, longitude, flight path angle, heading angle, bank angle, sideslip angle and angle of attack can be retrieved.</p></li>
</ul>
</dd></dl>

<dl class="py class">
<dt id="AtmosphericFlightConditions">
<em class="property">class </em><code class="sig-name descname">AtmosphericFlightConditions</code><a class="headerlink" href="#AtmosphericFlightConditions" title="Permalink to this definition">¶</a></dt>
<dd><p>Class, derived from <a class="reference internal" href="#FlightConditions" title="FlightConditions"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlightConditions</span></code></a>, which stores data on altitude, longitude, latitude, density, airspeed, etc. for atmospheric flight.  Can be used during propagation to retrieve various data. It derives all functions of <a class="reference internal" href="#FlightConditions" title="FlightConditions"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlightConditions</span></code></a>, and also provides the functions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getCurrentDensity</span></code> Returns the current atmospheric density at the vehicle current state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCurrentFreestreamTemperature</span></code> Returns the current atmospheric temperature at the vehicle current state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCurrentDynamicPressure</span></code> Returns the current dynamic pressure at the vehicle current state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCurrentPressure</span></code> Returns the current static pressure at the vehicle current state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCurrentAirspeed</span></code> Returns the current airspeed at the vehicle current state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCurrentSpeedOfSound</span></code> Returns the current speed of sound at the vehicle current state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCurrentMachNumber</span></code> Returns the current Mach number at the vehicle current state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCurrentAirspeedBasedVelocity</span></code> Returns the current velocity vectorof the vehicle w.r.t. the atmosphere, expressed in the frame fixed to the central body.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getAerodynamicCoefficientInterface</span></code> Returns the object of type <a class="reference internal" href="../environmentSetup/availableSettings.html#AerodynamicCoefficientInterface" title="AerodynamicCoefficientInterface"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicCoefficientInterface</span></code></a> responsible for computing and updating the aerodynamic coefficients.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getAerodynamicCoefficientIndependentVariables</span></code> Returns the current list of independent variables of the aerodynamic coefficients. For instance, if the coefficients depend on Mach number, angle of attack and sideslip angle, this function returns a vector containing these three variables (in order).</p></li>
</ul>
</dd></dl>

<p>An example of an implementation of an aerodynamic guidance class is given and discussed below.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FlightConditionsBasedAerodynamicGuidance</span><span class="o">:</span> <span class="k">public</span> <span class="n">AerodynamicGuidance</span>
<span class="p">{</span>
    <span class="n">FlightConditionsBasedAerodynamicGuidance</span><span class="p">(</span>
            <span class="k">const</span> <span class="n">NamedBodyMap</span><span class="o">&amp;</span> <span class="n">bodyMap</span><span class="p">,</span>
            <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">vehicleName</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">vehicleFlightConditions_</span> <span class="o">=</span>
           <span class="n">std</span><span class="o">::</span><span class="n">dynamic_pointer_cast</span><span class="o">&lt;</span> <span class="n">AtmosphericFlightConditions</span> <span class="o">&gt;</span><span class="p">(</span>
              <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="n">vehicleName</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getFlightConditions</span><span class="p">(</span> <span class="p">)</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span> <span class="o">==</span> <span class="k">nullptr</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span> <span class="s">&quot;Error in FlightConditionsBasedAerodynamicGuidance, expected AtmosphericFlightConditions&quot;</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">updateGuidance</span><span class="p">(</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">currentTime</span> <span class="p">);</span>

<span class="k">private</span><span class="o">:</span>

    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">AtmosphericFlightConditions</span> <span class="o">&gt;</span> <span class="n">vehicleFlightConditions_</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>where the <code class="docutils literal notranslate"><span class="pre">updateGuidance</span></code> function is not defined directly in the <code class="docutils literal notranslate"><span class="pre">.h</span></code> file, but instead in the <code class="docutils literal notranslate"><span class="pre">.cpp</span></code> file (below). Note the <code class="docutils literal notranslate"><span class="pre">dynamic_pointer_cast</span></code> in the constructor, and the check to see if the <a class="reference internal" href="#FlightConditions" title="FlightConditions"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlightConditions</span></code></a> object is actually of the type <a class="reference internal" href="#AtmosphericFlightConditions" title="AtmosphericFlightConditions"><code class="xref py py-class docutils literal notranslate"><span class="pre">AtmosphericFlightConditions</span></code></a>.</p>
<p>As an example for a guidance scheme, let’s consider the simplified (and still not particularly realistic) aerodynamic guidance where:</p>
<blockquote>
<div><ul class="simple">
<li><p>Angle of attack is 35 degrees is altitude is larger than 60 km, angle of attack is 5 degrees at 30 km, and changes linearly between these two values.</p></li>
<li><p>Sideslip angle is always zero.</p></li>
<li><p>Bank angle is 80 degrees if mach number is larger than 8.</p></li>
</ul>
</div></blockquote>
<p>The implementation of the <code class="docutils literal notranslate"><span class="pre">updateGuidance</span></code> functions in the <code class="docutils literal notranslate"><span class="pre">.cpp</span></code> file would then read:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">FlightConditionsBasedAerodynamicGuidance</span><span class="o">::</span><span class="n">updateGuidance</span><span class="p">(</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">currentTime</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mf">60.0E3</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="mf">35.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">25.0E3</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">5.0</span> <span class="o">+</span> <span class="mf">30.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">-</span> <span class="mf">25.0E3</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">35.0E3</span> <span class="p">)</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>

    <span class="p">}</span>

    <span class="n">currentAngleOfSideslip_</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentMachNumber</span><span class="p">(</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentBankAngle_</span> <span class="o">=</span> <span class="mf">80.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">currentBankAngle_</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Although this guidance profile is still not very realistic for full numerical simulations, it does show the manner in which the interface is to be set up for a more realistic approach.</p>
</div>
<div class="section" id="using-the-environment-models">
<h3><span class="section-number">2.4.1.4. </span>Using the environment models<a class="headerlink" href="#using-the-environment-models" title="Permalink to this headline">¶</a></h3>
<p>In computing your aerodynamic guidance commands, you will likely need to use a number of physical quantities from your environment, as is the case with the example above, where the altitude is used. Below, a list is given with the way in which to retrieve some variables that are typical in aerodynamic guidance:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Current conditions at a vehicle’s location w.r.t. a central central body:</strong> These are stored in an object of type <a class="reference internal" href="#FlightConditions" title="FlightConditions"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlightConditions</span></code></a>, which may be of the <a class="reference internal" href="#AtmosphericFlightConditions" title="AtmosphericFlightConditions"><code class="xref py py-class docutils literal notranslate"><span class="pre">AtmosphericFlightConditions</span></code></a> derived class, as in the case above (stored in a <a class="reference internal" href="../environmentSetup/setup.html#Body" title="Body"><code class="xref py py-class docutils literal notranslate"><span class="pre">Body</span></code></a> object; retrieved by using the <code class="docutils literal notranslate"><span class="pre">getFlightConditions</span></code> function). In the <a class="reference internal" href="#FlightConditions" title="FlightConditions"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlightConditions</span></code></a> and <a class="reference internal" href="#AtmosphericFlightConditions" title="AtmosphericFlightConditions"><code class="xref py py-class docutils literal notranslate"><span class="pre">AtmosphericFlightConditions</span></code></a> class code, you will see a number of functions called <code class="docutils literal notranslate"><span class="pre">getCurrent...</span></code>. These functions are key in linking the environment with the guidance. When called from the <a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicGuidance</span></code></a> derived class, the current value of the associated quantity is returned (e.g. <code class="docutils literal notranslate"><span class="pre">getCurrentAltitude</span></code> returns altitude, <code class="docutils literal notranslate"><span class="pre">getCurrentAirspeed</span></code> returns airspeed, etc.).</p></li>
<li><p><strong>Aerodynamic coefficients:</strong> These often play a particularly important role in the aerodynamic guidance. Whereas the other dependent variables are computed before updating the angles of attack, sideslip and bank, the aerodynamic coefficients are computed as a function of these angles. Therefore, the ‘current aerodynamic coefficients’ cannot yet be retrieved from the environment when updating the guidance. However, if the angles on which the aerodynamic coefficients depend have already been locally computed (in <code class="docutils literal notranslate"><span class="pre">currentAngleOfAttack_</span></code>, etc.), they may be used for determination of subsequent angles. Below is an example of aerodynamic coefficients depending on angle of attack, angle of sideslip and Mach number and the bank angle determined as a function of aerodynamic coefficients. The following can then be used inside the <code class="docutils literal notranslate"><span class="pre">updateGuidance</span></code> function:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Define aerodynamic coefficient interface/flight conditions (typically retrieved from body map; may also be a member variable)</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">AerodynamicCoefficientInterface</span> <span class="o">&gt;</span> <span class="n">coefficientInterface_</span> <span class="o">=</span> <span class="p">...</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">AtmosphericFlightConditions</span> <span class="o">&gt;</span> <span class="n">flightConditions_</span> <span class="o">=</span> <span class="p">...</span>

<span class="c1">// Compute angles of attack and sideslip</span>
<span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="p">...</span>
<span class="n">currentAngleOfSideslip_</span> <span class="o">=</span> <span class="p">...</span>

<span class="c1">// Define input to aerodynamic coefficients: take care of order of input (this depends on how the coefficients are created)!</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;</span> <span class="n">currentAerodynamicCoefficientsInput_</span><span class="p">;</span>
<span class="n">currentAerodynamicCoefficientsInput_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">currentAngleOfAttack_</span> <span class="p">);</span>
<span class="n">currentAerodynamicCoefficientsInput_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">currentAngleOfSideslip_</span> <span class="p">);</span>
<span class="n">currentAerodynamicCoefficientsInput_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span> <span class="n">flightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentMachNumber</span><span class="p">(</span> <span class="p">)</span> <span class="p">);</span>

<span class="c1">// Update and retrieve current aerodynamic coefficients</span>
<span class="n">coefficientInterface_</span><span class="o">-&gt;</span><span class="n">updateCurrentCoefficients</span><span class="p">(</span> <span class="n">currentAerodynamicCoefficientsInput_</span> <span class="p">);</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">Vector3d</span> <span class="n">currentAerodynamicCoefficients</span> <span class="o">=</span> <span class="n">coefficientInterface_</span><span class="o">-&gt;</span><span class="n">getCurrentForceCoefficients</span><span class="p">(</span> <span class="p">);</span>

<span class="c1">// Compute bank angle</span>
<span class="n">currentBankAngle_</span> <span class="o">=</span>  <span class="n">some</span> <span class="n">function</span> <span class="n">of</span> <span class="n">currentAerodynamicCoefficients</span>
</pre></div>
</div>
<p>Note that the physical meaning of the coefficients may differ, depending on how they are defined in <a class="reference internal" href="../environmentSetup/availableSettings.html#AerodynamicCoefficientSettings" title="AerodynamicCoefficientSettings"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicCoefficientSettings</span></code></a>: if they are defined in the aerodynamic frame (<code class="docutils literal notranslate"><span class="pre">C_D</span></code>, <code class="docutils literal notranslate"><span class="pre">C_S</span></code>, <code class="docutils literal notranslate"><span class="pre">C_L</span></code>)  this is how they are returned.</p>
<ul class="simple">
<li><p><strong>Current vehicle orientation angles:</strong> In particular, the angles used to define the spherical vehicle state: latitude, longitude, flight path angle and heading angle may be needed. These are retrieved from an object of type <a class="reference internal" href="#AerodynamicAngleCalculator" title="AerodynamicAngleCalculator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicAngleCalculator</span></code></a>, which is retrieved from the <a class="reference internal" href="#FlightConditions" title="FlightConditions"><code class="xref py py-class docutils literal notranslate"><span class="pre">FlightConditions</span></code></a> class with the <code class="docutils literal notranslate"><span class="pre">getAerodynamicAngleCalculator</span></code> function. The <a class="reference internal" href="#AerodynamicAngleCalculator" title="AerodynamicAngleCalculator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicAngleCalculator</span></code></a> class in turn has a function <code class="docutils literal notranslate"><span class="pre">getAerodynamicAngle</span></code>, which takes a single argument: the type of angle that is to be returned. You can use any of the first four identifiers in the <code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicsReferenceFrameAngles</span></code>. In the aerodynamic guidance, DO NOT use this function to retrieve the angle of attack, sideslip or bank. As an example, you can use:</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Define aerodynamic coefficient interface/flight conditions (typically retrieved from body map; may also be a member variable)</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">aerodynamics</span><span class="o">::</span><span class="n">FlightConditions</span> <span class="o">&gt;</span> <span class="n">flightConditions_</span> <span class="o">=</span> <span class="p">...</span>
<span class="kt">double</span> <span class="n">currentFlightPathAngle</span> <span class="o">=</span> <span class="n">flightConditions_</span><span class="o">-&gt;</span><span class="n">getAerodynamicAngleCalculator</span><span class="p">(</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getAerodynamicAngle</span><span class="p">(</span> <span class="n">reference_frames</span><span class="o">::</span><span class="n">flight_path_angle</span> <span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Body mass:</strong> The mass of the body at the current time is retrieved directly from the <a class="reference internal" href="../environmentSetup/setup.html#Body" title="Body"><code class="xref py py-class docutils literal notranslate"><span class="pre">Body</span></code></a> object using the <code class="docutils literal notranslate"><span class="pre">getBodyMass(</span> <span class="pre">)</span></code> function.</p></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="control-surface-deflections">
<h2><span class="section-number">2.4.2. </span>Control surface deflections<a class="headerlink" href="#control-surface-deflections" title="Permalink to this headline">¶</a></h2>
<p>For a realistic vehicle entry/ascent trajectory propagation, it will often be necessary to include control surface deflections in the numerical propagation. How to load/define the aerodynamic influence of control surfaces is discussed at the end of this page.</p>
<p>To use the control surface increments, the control surface deflections have to be set, either to a constant value before stating the propagation, or every time step by a user-defined guidance system. In each case, the control surface deflections are stored in a <code class="xref py py-class docutils literal notranslate"><span class="pre">VehicleSystems</span></code> object, which is a member of a <a class="reference internal" href="../environmentSetup/setup.html#Body" title="Body"><code class="xref py py-class docutils literal notranslate"><span class="pre">Body</span></code></a> object. The vehicle systems represent a collection of all physical (hardware) properties of a vehicle including the control surface deflections and properties. Presently, the only quantities that are stored for the control surfaces are the current deflection.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If your application requires more extensive functionality, please open an issue requesting this feature on Github).</p>
</div>
<p>In either case, a <code class="xref py py-class docutils literal notranslate"><span class="pre">VehicleSystems</span></code> object must be created and stored in the associated <a class="reference internal" href="../environmentSetup/setup.html#Body" title="Body"><code class="xref py py-class docutils literal notranslate"><span class="pre">Body</span></code></a> object:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">system_models</span><span class="o">::</span><span class="n">VehicleSystems</span> <span class="o">&gt;</span> <span class="n">systemsModels</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span> <span class="n">system_models</span><span class="o">::</span><span class="n">VehicleSystems</span> <span class="o">&gt;</span><span class="p">(</span> <span class="p">);</span>
<span class="n">bodyMap</span><span class="p">[</span> <span class="s">&quot;Vehicle&quot;</span> <span class="p">]</span><span class="o">-&gt;</span><span class="n">setVehicleSystems</span><span class="p">(</span> <span class="n">systemsModels</span> <span class="p">);</span>
</pre></div>
</div>
<p>The control surface deflections are then set by:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">elevonDeflection</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">controlSurfaceId</span> <span class="o">=</span> <span class="s">&quot;Elevon&quot;</span><span class="p">;</span>
<span class="n">apolloSystems</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="n">controlSurfaceId</span><span class="p">,</span> <span class="n">elevonDeflection</span> <span class="p">);</span>
</pre></div>
</div>
<p>Note that the deflections of multiple control surfaces can be set in exactly the same manner as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">apolloSystems</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="s">&quot;Elevon&quot;</span><span class="p">,</span> <span class="mf">0.1</span> <span class="p">);</span>
<span class="n">apolloSystems</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="s">&quot;Aileron1&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span> <span class="p">);</span>
<span class="n">apolloSystems</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="s">&quot;Aileron2&quot;</span><span class="p">,</span> <span class="mf">0.15</span> <span class="p">);</span>
</pre></div>
</div>
<p>When only using the above, the control surfaces are set to a costant deflection throughout the propagation. This may not be very realistic but can be useful for preliminary analysis.</p>
<p>In general, however, you will want to determine the control surface deflections as a function of your current state, time, etc. The best way to achieve this is by incorporating the control surface deflections into the aerodynamic guidance, in particular into your specific derived class of <a class="reference internal" href="#AerodynamicGuidance" title="AerodynamicGuidance"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicGuidance</span></code></a> (see above). As an example, consider the following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FlightConditionsBasedAerodynamicExtendedGuidance</span><span class="o">:</span> <span class="k">public</span> <span class="n">AerodynamicGuidance</span>
<span class="p">{</span>
    <span class="n">FlightConditionsBasedAerodynamicExtendedGuidance</span><span class="p">(</span>
            <span class="k">const</span> <span class="n">NamedBodyMap</span><span class="o">&amp;</span> <span class="n">bodyMap</span><span class="p">,</span>
            <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">vehicleName</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">vehicleFlightConditions_</span> <span class="o">=</span>
           <span class="n">std</span><span class="o">::</span><span class="n">dynamic_pointer_cast</span><span class="o">&lt;</span> <span class="n">AtmosphericFlightConditions</span> <span class="o">&gt;</span><span class="p">(</span>
              <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="n">vehicleName</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getFlightConditions</span><span class="p">(</span> <span class="p">)</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span> <span class="o">==</span> <span class="k">nullptr</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span> <span class="s">&quot;Error in FlightConditionsBasedAerodynamicGuidance, expected AtmosphericFlightConditions&quot;</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="n">vehicleSystems_</span> <span class="o">=</span> <span class="n">bodyMap</span><span class="p">.</span><span class="n">at</span><span class="p">(</span> <span class="n">vehicleName</span> <span class="p">)</span><span class="o">-&gt;</span><span class="n">getVehicleSystems</span><span class="p">(</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">updateGuidance</span><span class="p">(</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">currentTime</span> <span class="p">);</span>

<span class="k">private</span><span class="o">:</span>

    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">AtmosphericFlightConditions</span> <span class="o">&gt;</span> <span class="n">vehicleFlightConditions_</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span> <span class="n">system_models</span><span class="o">::</span><span class="n">VehicleSystems</span> <span class="o">&gt;</span> <span class="n">vehicleSystems_</span><span class="p">;</span>

<span class="p">};</span>
</pre></div>
</div>
<p>Compared to the <code class="xref py py-class docutils literal notranslate"><span class="pre">FlightConditionsBasedAerodynamicGuidance</span></code> class defined above, you can see that it has been extended with the ability to access the <code class="xref py py-class docutils literal notranslate"><span class="pre">VehicleSystems</span></code> member of the associated body. In the implementation of the <code class="docutils literal notranslate"><span class="pre">updateGuidance</span></code> function, the control surface deflections may now be incorporated as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">FlightConditionsBasedAerodynamicExtendedGuidance</span><span class="o">::</span><span class="n">updateGuidance</span><span class="p">(</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">currentTime</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mf">60.0E3</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="mf">35.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">25.0E3</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">currentAngleOfAttack_</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">5.0</span> <span class="o">+</span> <span class="mf">30.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">-</span> <span class="mf">25.0E3</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">35.0E3</span> <span class="p">)</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>

    <span class="p">}</span>

    <span class="n">currentAngleOfSideslip_</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentMachNumber</span><span class="p">(</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentBankAngle_</span> <span class="o">=</span> <span class="mf">80.0</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">currentBankAngle_</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">double</span> <span class="n">elevonDeflection</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">-</span> <span class="mf">25.0E3</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">35.0E3</span> <span class="p">)</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">aileron1Deflection</span> <span class="o">=</span> <span class="p">(</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="mf">7.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">-</span> <span class="mf">25.0E3</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">35.0E3</span> <span class="p">)</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">aileron2Deflection</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="mf">7.0</span> <span class="o">*</span> <span class="p">(</span> <span class="n">vehicleFlightConditions_</span><span class="o">-&gt;</span><span class="n">getCurrentAltitude</span><span class="p">(</span> <span class="p">)</span> <span class="o">-</span> <span class="mf">25.0E3</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">35.0E3</span> <span class="p">)</span> <span class="o">*</span> <span class="n">mathematical_constants</span><span class="o">::</span><span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>

    <span class="n">vehicleSystems_</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="s">&quot;Elevon&quot;</span><span class="p">,</span> <span class="n">elevonDeflection</span> <span class="p">);</span>
    <span class="n">vehicleSystems_</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="s">&quot;Aileron1&quot;</span><span class="p">,</span> <span class="n">aileron1Deflection</span> <span class="p">);</span>
    <span class="n">vehicleSystems_</span><span class="o">-&gt;</span><span class="n">setCurrentControlSurfaceDeflection</span><span class="p">(</span> <span class="s">&quot;Aileron2&quot;</span><span class="p">,</span> <span class="n">aileron2Deflection</span> <span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<p>As with the previous examples, the values to which the control surface deflections are set are quite arbitrary and not based on any particularly realistic model. They are defined for illustration purposes only. A key difference between the manner in which the aerodynamic angles and the control surface deflections are handled by the guidance object is that the angles are computed but not set by the object (the angles are retrieved and set in the body model by the <a class="reference internal" href="#AerodynamicAngleCalculator" title="AerodynamicAngleCalculator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AerodynamicAngleCalculator</span></code></a>). The control surface deflections on the other hand are both computed and set by the guidance object.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="thrustModels.html" class="btn btn-neutral float-right" title="2.5. Thrust Guidance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="massModel.html" class="btn btn-neutral" title="2.3. Mass Rate Model Set-up" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Delft University of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header .arrow").click(function() {
            $(this).closest('.toggle').children().not(".header").toggle(400);
            $(this).toggleClass("open");
            // $(this).html() == "More" ? $(this).html('Less') : $(this).html('More');
        });
        $(".showall").click(function() {
            $(".toggle > *").show(400);
            $(".toggle .header .arrow").addClass("open");
        });
        $(".hideall").click(function() {
            $(".toggle > *").hide(400);
            $(".toggle .header").show(400);
            $(".toggle .header .arrow").removeClass("open");
        });
    });
</script>


</body>
</html>