

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Multiple propagations &mdash; TU Delft Astrodynamic Toolbox  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="TU Delft Astrodynamic Toolbox  documentation" href="../../../index.html"/>
        <link rel="up" title="Tutorials: Input-Output" href="index.html"/>
        <link rel="next" title="Troubleshooting" href="../../troubleshooting/index.html"/>
        <link rel="prev" title="Modular input files" href="modularInputFiles.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> TU Delft Astrodynamic Toolbox
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Start Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Tutorials and Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../applicationWalkthroughs/index.html">Application Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tudatFeatures/index.html">Tudat Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basics/index.html">Tudat Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jsonInterface/index.html">JSON Interface</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">MATLAB Interface</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorialsSeamless/index.html">Tutorials: Seamless</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Tutorials: Input-Output</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="basicPropagation.html">Unperturbed Earth-orbiting Satellite</a></li>
<li class="toctree-l4"><a class="reference internal" href="modularInputFiles.html">Modular input files</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Multiple propagations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference external" href="http://doxygen.tudat.tudelft.nl">Doxygen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../FAQ/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developerGuide/index.html">Developer Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TU Delft Astrodynamic Toolbox</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Tutorials and Documentation</a> &raquo;</li>
        
          <li><a href="../index.html">MATLAB Interface</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials: Input-Output</a> &raquo;</li>
        
      <li>Multiple propagations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/tutorials/matlabInterface/tutorialsInputOutput/multiplePropagations.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="multiple-propagations">
<span id="matlabinterface-tutorialsinputoutput-multiplepropagations"></span><h1>Multiple propagations<a class="headerlink" href="#multiple-propagations" title="Permalink to this headline">Â¶</a></h1>
<p>This tutorial describes how to use the MATLAB Interface to generate multiple JSON files that are then provided to the <code class="docutils literal notranslate"><span class="pre">json_interface</span></code> application to solve an optimisation process (or run several cases sharing a large part of the settings). The code for this example can be found at:</p>
<div class="highlight-txt notranslate"><div class="highlight"><pre><span></span>tudatBundle/matlabInterface/Examples/InputOutput/MultiplePropagations/generateInput.m
</pre></div>
</div>
<p>The first part of the script sets up the <code class="xref py py-class docutils literal notranslate"><span class="pre">Simulation</span></code> object. This is identical to the initial part of <a class="reference internal" href="../tutorialsSeamless/multiplePropagations.html#matlabinterface-tutorialsseamless-multiplepropagations"><span class="std std-ref">Multiple propagations</span></a>, so it is not repeated here.</p>
<p>Once that all the settings have been defined, instead of calling <code class="docutils literal notranslate"><span class="pre">simulatinon.run()</span></code>, we export the <code class="xref py py-class docutils literal notranslate"><span class="pre">Simulation</span></code> object to a JSON file. However, we have to specify first the results to be exported to output files:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">simulation</span><span class="p">.</span><span class="n">addResultsToExport</span><span class="p">(</span><span class="nb">fullfile</span><span class="p">(</span><span class="s">&#39;..&#39;</span><span class="p">,</span><span class="s">&#39;output&#39;</span><span class="p">,</span><span class="s">&#39;${ROOT_FILE_STEM}.txt&#39;</span><span class="p">),{</span><span class="s">&#39;independent&#39;</span><span class="p">,</span><span class="s">&#39;state&#39;</span><span class="p">,</span><span class="n">altitude</span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>Here, the <code class="docutils literal notranslate"><span class="pre">fullfile</span></code> function is used to build a platform-dependent path (using <code class="docutils literal notranslate"><span class="pre">/</span></code> on Unix systems and <code class="docutils literal notranslate"><span class="pre">\</span></code> on Windows). We defined request the variables <code class="docutils literal notranslate"><span class="pre">independent</span></code>, <code class="docutils literal notranslate"><span class="pre">state</span></code> and <code class="docutils literal notranslate"><span class="pre">altitude</span></code> to be saved to a file located at <code class="docutils literal notranslate"><span class="pre">../output/results.txt</span></code>. The JSON files will be located inside a <code class="docutils literal notranslate"><span class="pre">input</span></code> directory, so the output files will be generated inside <code class="docutils literal notranslate"><span class="pre">matlabInterface/Examples/InputOutput/MultiplePropagations/output</span></code> since the provided file is relative to the file in which it will be declared. We use the special string <code class="docutils literal notranslate"><span class="pre">${ROOT_FILE_STEM}</span></code>, which, during run-time, will be replaced by the filename (without extension) of the JSON file that is being used as input argument for the <code class="docutils literal notranslate"><span class="pre">json_interface</span></code> application (e.g. when running <code class="docutils literal notranslate"><span class="pre">json_interface</span> <span class="pre">mass200.json</span></code>, the <code class="docutils literal notranslate"><span class="pre">${ROOT_FILE_STEM}</span></code> of is <code class="docutils literal notranslate"><span class="pre">mass200</span></code>).</p>
<p>Then, since we are not running the propagations from MATLAB, we cannot use <code class="docutils literal notranslate"><span class="pre">fprintf</span></code> to print a message when each propagation starts/terminate. Thus, we set the option:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">simulation</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">notifyOnPropagationTermination</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>to print a message on the Terminal window when each propagation ends.</p>
<p>Now we have defined all the settings that are shared amongst all the propagations. Thus, we can generate a JSON file containing these shared settings:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">json</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span><span class="nb">fullfile</span><span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">,</span><span class="s">&#39;shared.json&#39;</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>Now, we generate the input files in which the values of the mass and reference area of the body <code class="docutils literal notranslate"><span class="pre">satellite</span></code> are defined, after including the contents of <code class="docutils literal notranslate"><span class="pre">shared.json</span></code>.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">masses</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">200</span><span class="p">:</span><span class="mi">100</span><span class="p">:</span><span class="mi">800</span><span class="p">;</span><span class="w"></span>
<span class="n">referenceAreas</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">masses</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">masses</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">referenceAreas</span><span class="p">(</span><span class="nb">i</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">filePath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">,</span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;mass%i.json&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">fileContents</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">json</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="s">&#39;$(shared.json)&#39;</span><span class="p">,</span><span class="s">&#39;bodies.satellite.mass&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="s">&#39;bodies.satellite.referenceArea&#39;</span><span class="p">,</span><span class="n">A</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">json</span><span class="p">.</span><span class="n">export</span><span class="p">(</span><span class="n">fileContents</span><span class="p">,</span><span class="n">filePath</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<p>The <a href="#id1"><span class="problematic" id="id2">:liteal:`json.merge`</span></a> function returns an array in which the first element is the object passed as first argument to the function, and in which the second element is a map/object containing a set of key-value pairs. For instance, one the file generated in the first iteration of the loop is:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal notranslate"><span class="pre">matlabInterface/Examples/InputOutput/MultiplePropagations/output/mass200.json</span></code></span><a class="headerlink" href="#id3" title="Permalink to this code">Â¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="s2">&quot;$(shared.json)&quot;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nt">&quot;bodies.satellite.mass&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="nt">&quot;bodies.satellite.referenceArea&quot;</span><span class="p">:</span> <span class="mi">8</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<p>Now that all the input files have been generated, we can run each of them, e.g. <code class="docutils literal notranslate"><span class="pre">json_interface</span> <span class="pre">mass200.json</span></code> (we must not run the file <code class="docutils literal notranslate"><span class="pre">shared.json</span></code>). We can also use <a class="reference external" href="https://www.gnu.org/software/parallel/">GNU Parallel</a> and write:</p>
<div class="highlight-txt notranslate"><div class="highlight"><pre><span></span>parallel json_interface ::: input/mass*.json
</pre></div>
</div>
<p>We will get the following output in Terminal:</p>
<div class="highlight-txt notranslate"><div class="highlight"><pre><span></span>FAILURE: propagation of file &quot;~/tudatBundle/matlabInterface/Examples/InputOutput/MultiplePropagations/input/mass200.json&quot; terminated with errors.
Minimum step size exceeded.
Error, propagation terminated at t=141762.97465721529, returning propagation data up to current time
SUCCESS: propagation of file &quot;~/tudatBundle/matlabInterface/Examples/InputOutput/MultiplePropagations/input/mass300.json&quot; terminated with no errors.
SUCCESS: propagation of file &quot;~/tudatBundle/matlabInterface/Examples/InputOutput/MultiplePropagations/input/mass400.json&quot; terminated with no errors.
SUCCESS: propagation of file &quot;~/tudatBundle/matlabInterface/Examples/InputOutput/MultiplePropagations/input/mass500.json&quot; terminated with no errors.
SUCCESS: propagation of file &quot;~/tudatBundle/matlabInterface/Examples/InputOutput/MultiplePropagations/input/mass600.json&quot; terminated with no errors.
SUCCESS: propagation of file &quot;~/tudatBundle/matlabInterface/Examples/InputOutput/MultiplePropagations/input/mass700.json&quot; terminated with no errors.
SUCCESS: propagation of file &quot;~/tudatBundle/matlabInterface/Examples/InputOutput/MultiplePropagations/input/mass800.json&quot; terminated with no errors.
</pre></div>
</div>
<p>As you can see, the first propagation fails, so it is terminated before reaching the termination condition. This was done on purpose to showcase the propagation failure handling capabilities of the MATLAB and JSON interfaces.</p>
<p>The directory tree looks like this after generating the results:</p>
<div class="highlight-txt notranslate"><div class="highlight"><pre><span></span>MultiplePropagations
|
| input
|     |
|     | mass200.json
|     | ...
|     | mass800.json
|     | shated.json
|
| output
|      |
|      | mass200.txt
|      | ...
|      | mass800.txt
|
| generateInput.m
| processOutput.m
</pre></div>
</div>
<p>The script <code class="docutils literal notranslate"><span class="pre">processOutput.m</span></code> can be used to generate a plot using the results file. This script uses the <code class="docutils literal notranslate"><span class="pre">[results,failure]</span> <span class="pre">=</span> <span class="pre">import.results</span></code> function from the MATLAB Interface. In this way, it can be known whether one of the generated output files corresponds to a propagation that terminated before reaching the termination conditions, due to a propagation error. This is possible because the file <code class="docutils literal notranslate"><span class="pre">mass200.txt</span></code> has a header indicating that a failure took place:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><code class="xref py py-class docutils literal notranslate"><span class="pre">matlabInterface/Examples/InputOutput/MultiplePropagations/output/mass200.txt</span></code></span><a class="headerlink" href="#id4" title="Permalink to this code">Â¶</a></div>
<div class="highlight-txt notranslate"><div class="highlight"><pre><span></span>FAILURE
  0                 4667617.77873914  2333808.88936957  4042275.57154398  -5494.76025754408  2747.38012877204  4758.6019707383   230000.00000205
  20                4556442.06802713  2388104.54009974  4136317.49487142  -5622.29470046153  2681.9360346687   4645.15892336866  230001.407005601
...
</pre></div>
</div>
</div>
<p>In order to disable this functionality (i.e. tagging output files with the <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> header when the propagation fails), one can write:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">simulation</span><span class="p">.</span><span class="n">options</span><span class="p">.</span><span class="n">tagOutputFilesIfPropagationFails</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../troubleshooting/index.html" class="btn btn-neutral float-right" title="Troubleshooting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="modularInputFiles.html" class="btn btn-neutral" title="Modular input files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Delft University of Technology.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header .arrow").click(function() {
            $(this).closest('.toggle').children().not(".header").toggle(400);
            $(this).toggleClass("open");
            // $(this).html() == "More" ? $(this).html('Less') : $(this).html('More');
        });
        $(".showall").click(function() {
            $(".toggle > *").show(400);
            $(".toggle .header .arrow").addClass("open");
        });
        $(".hideall").click(function() {
            $(".toggle > *").hide(400);
            $(".toggle .header").show(400);
            $(".toggle .header .arrow").removeClass("open");
        });

        var nav_top_height = Math.round($(".wy-side-nav-search").outerHeight())+2;
        $(".wy-nav-content-wrap").prepend("<div id='announcement'><p>â ï¸ This website is now mostly outdated! â ï¸</p><p>Please visit <a href='https://tudat-space.readthedocs.io/en/latest'>tudat-space.readthedocs.io</a> instead.</p></div>");
        $("#announcement").css("height", String(nav_top_height) + "px");
        $(".rst-content").css("margin-top", String(nav_top_height) + "px");
    });
</script>


</body>
</html>